var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();!function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.events||(i.events={}),o=function(){function e(e){this._type=e}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),e}(),n.DefaultViewerEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function e(e,t){var i=n.call(this,t)||this;return i.component=e,i}return __extends(e,n),e}(e.viewer.widgets.events.DefaultViewerEvent),n.MyCoReImageViewerEvent=o}(mycore||(mycore={}));var VIEWER_COMPONENTS=IVIEW_COMPONENTS||[];function addViewerComponent(e){VIEWER_COMPONENTS.push(e)}function viewerClearTextSelection(){window.getSelection&&(window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges())}function addIviewComponent(e){console.warn("addIviewComponent shouldnt be used anymore!"),VIEWER_COMPONENTS.push(e)}var ArrayIterator=function(){function e(e){this._array=e,this.iterator=0}return e.prototype.hasPrevious=function(){return 0!=this.iterator},e.prototype.hasNext=function(){return this.iterator+1<this._array.length},e.prototype.previous=function(){return this._array[--this.iterator]},e.prototype.next=function(){return this._array[++this.iterator]},e.prototype.current=function(){return this._array[this.iterator]},e.prototype.reset=function(){this.iterator=0},e}(),Position2D=function(){function o(e,t){this._x=e,this._y=t}return o.prototype.toString=function(){return this.x+":"+this.y},o.prototype.move=function(e){return new o(this._x+e.x,this._y+e.y)},o.prototype.roundDown=function(){return new o(Math.floor(this.x),Math.floor(this.y))},o.prototype.roundUp=function(){return new o(Math.ceil(this.x),Math.ceil(this.y))},o.prototype.scale=function(e){return new o(this._x*e,this._y*e)},o.prototype.copy=function(){return new o(this.x,this.y)},o.fromString=function(e){var t=e.split(":");return new o(parseInt(t[0],10),parseInt(t[1],10))},Object.defineProperty(o.prototype,"x",{get:function(){return this._x},set:function(e){throw"x of position is unmodifyable!"},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"y",{get:function(){return this._y},set:function(e){throw"y of position is unmodifyable!"},enumerable:!0,configurable:!0}),o.prototype.rotate=function(e){var t=this._x,i=this._y;switch(e){case 90:var n=t;t=-i,i=n;case 180:n=t;t=-i,i=n;case 270:n=t;t=-1*i,i=n}return new o(t,i)},o.prototype.rotateAround=function(e,t){t*=-1;var i=this.x-e.x,n=this.y-e.y;return new o(e.x+i*Math.cos(t)-n*Math.sin(t),e.y+i*Math.sin(t)+n*Math.cos(t))},o.prototype.toPosition3D=function(e){return new Position3D(this.x,this.y,e)},o.prototype.equals=function(e){return"x"in e&&"y"in e&&(e.x==this.x&&e.y==this.y)},o.prototype.min=function(e,t){return new o(Math.min(this.x,e),Math.min(this.y,t))},o.prototype.max=function(e,t){return new o(Math.max(this.x,e),Math.max(this.y,t))},o}(),MoveVector=function(i){function e(e,t){return i.call(this,e,t)||this}return __extends(e,i),e}(Position2D),Position3D=function(){function e(e,t,i){this.x=e,this.y=t,this.z=i}return e.prototype.toString=function(){return this.z+":"+this.x+":"+this.y},e.prototype.toPosition2D=function(){return new Position2D(this.x,this.y)},e}(),Size2D=function(){function t(e,t){this.width=e,this.height=t}return t.prototype.toString=function(){return this.width+":"+this.height},t.prototype.roundUp=function(){return new t(Math.ceil(this.width),Math.ceil(this.height))},t.prototype.scale=function(e){return new t(this.width*e,this.height*e)},t.prototype.copy=function(){return new t(this.width,this.height)},t.prototype.getRotated=function(e){return 0==e||180==e?this.copy():new t(this.height,this.width)},t.prototype.maxSide=function(){return Math.max(this.width,this.height)},t.prototype.getSurface=function(){return this.width*this.height},t.prototype.roundDown=function(){return new t(Math.floor(this.width),Math.floor(this.height))},t}(),Rect=function(){function c(e,t){this.pos=e,this.size=t}return c.prototype.getPoints=function(){return{upperLeft:this.pos,upperRight:new Position2D(this.pos.x+this.size.width,this.pos.y),lowerLeft:new Position2D(this.pos.x,this.pos.y+this.size.height),lowerRight:new Position2D(this.pos.x+this.size.width,this.pos.y+this.size.height)}},c.prototype.getX=function(){return this.pos.x},c.prototype.getY=function(){return this.pos.y},c.prototype.getWidth=function(){return this.size.width},c.prototype.getHeight=function(){return this.size.height},c.prototype.scale=function(e){return new c(this.pos.scale(e),this.size.scale(e))},c.prototype.getIntersection=function(e){var t=this,i=Math.max(t.pos.x,e.pos.x),n=t.pos.x+t.size.width,o=e.pos.x+e.size.width,r=Math.min(n,o);if(i<r){var a=Math.max(t.pos.y,e.pos.y),s=t.pos.y+t.size.height,l=e.pos.y+e.size.height,h=Math.min(s,l);if(a<h)return new c(new Position2D(i,a),new Size2D(r-i,h-a))}return null},c.prototype.intersects=function(e){return this.intersectsHorizontal(e.x)&&this.intersectsVertical(e.y)},c.prototype.intersectsArea=function(e){return this.getX()<e.getX()+e.getWidth()&&e.getX()<this.getX()+this.getWidth()&&this.getY()<e.getY()+e.getHeight()&&e.getY()<this.getY()+this.getHeight()},c.prototype.intersectsVertical=function(e){return e<this.pos.y+this.size.height&&e>this.pos.y},c.prototype.intersectsHorizontal=function(e){return e<this.pos.x+this.size.width&&e>this.pos.x},c.prototype.rotate=function(e){return new c(this.pos.rotate(e),this.size.getRotated(e))},c.prototype.flipX=function(){var e=this.pos.x+this.size.width,t=-this.size.width;return new c(new Position2D(e,this.pos.y),new Size2D(t,this.size.height))},c.prototype.flipY=function(){var e=this.pos.y+this.size.height,t=-this.size.height;return new c(new Position2D(this.pos.x,e),new Size2D(this.size.width,t))},c.prototype.flip=function(e){return 90==e?this.flipX():180==e?this.flipX().flipY():270==e?this.flipY():this.copy()},c.prototype.equals=function(e){if(e instanceof c||"pos"in e&&"size"in e&&"_x"in e.pos&&"_y"in e.pos&&"width"in e.size&&"height"in e.size)return e.pos.x==this.pos.x&&e.pos.y==this.pos.y&&e.size.width==this.size.width&&e.size.height==this.size.height},c.prototype.contains=function(e){return e.getX()>=this.getX()&&e.getY()>=this.getY()&&e.getX()+e.getWidth()<=this.getX()+this.getWidth()&&e.getY()+e.getHeight()<=this.getY()+this.getHeight()},c.prototype.getMiddlePoint=function(){return new Position2D(this.pos.x+this.size.width/2,this.pos.y+this.size.height/2)},c.prototype.toString=function(){return this.pos.toString()+" - "+this.size.toString()},c.prototype.getRotated=function(e){var t=this.getMiddlePoint(),i=this.size.getRotated(e);return new c(new Position2D(t.x-i.width/2,t.y-i.height/2),i)},c.prototype.maximize=function(e,t,i,n){var o=this.pos.x+this.size.width,r=e+i,a=this.pos.y+this.size.height,s=t+n,l=e<this.pos.x?e:this.pos.x,h=t<this.pos.y?t:this.pos.y,u=Math.max(o,r)-l,p=Math.max(a,s)-h;return c.fromXYWH(l,h,u,p)},c.prototype.maximizeRect=function(e){return this.maximize(e.getX(),e.getY(),e.getWidth(),e.getHeight())},c.prototype.increase=function(e){var t=this.pos.x-e,i=this.pos.y-e,n=this.size.width+2*e,o=this.size.height+2*e;return c.fromXYWH(t,i,n,o)},c.prototype.difference=function(e){var t=this,i=c.diff(this,e);return i=i.filter(function(e){return 0!=e.getWidth()&&0!=e.getHeight()}).filter(function(e){return t.contains(e)})},c.prototype.copy=function(){return new c(this.pos.copy(),this.size.copy())},c.fromXYWH=function(e,t,i,n){return new c(new Position2D(e,t),new Size2D(i,n))},c.fromULLR=function(e,t){return new c(new Position2D(e.x,e.y),new Size2D(t.x-e.x,t.y-e.y))},c.getBounding=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=Math.pow(2,31),n=i,o=i,r=-i,a=-i;return e.forEach(function(e){n=Math.min(n,e.pos.y),r=Math.max(r,e.pos.y+e.size.height),o=Math.min(o,e.pos.x),a=Math.max(a,e.pos.x+e.size.width)}),c.fromULLR(new Position2D(o,n),new Position2D(a,r))},c.diff=function(e,t){var i=Math.min(e.getX(),t.getX()),n=Math.max(e.getX(),t.getX()),o=Math.min(e.getX()+e.getWidth(),t.getX()+t.getWidth()),r=Math.max(e.getX()+e.getWidth(),t.getX()+t.getWidth()),a=Math.min(e.getY(),t.getY()),s=Math.max(e.getY(),t.getY()),l=Math.min(e.getY()+e.getHeight(),t.getY()+t.getHeight()),h=Math.max(e.getY()+e.getHeight(),t.getY()+t.getHeight()),u=[];return u[0]=c.fromULLR(new Position2D(i,a),new Position2D(n,s)),u[1]=c.fromULLR(new Position2D(n,a),new Position2D(o,s)),u[2]=c.fromULLR(new Position2D(o,a),new Position2D(r,s)),u[3]=c.fromULLR(new Position2D(i,s),new Position2D(n,l)),u[4]=c.fromULLR(new Position2D(o,s),new Position2D(r,l)),u[5]=c.fromULLR(new Position2D(i,l),new Position2D(n,h)),u[6]=c.fromULLR(new Position2D(n,l),new Position2D(o,h)),u[7]=c.fromULLR(new Position2D(o,l),new Position2D(r,h)),u},c}(),Utils=function(){function a(){}return a.canvasToImage=function(e){var t=document.createElement("img");return t.src=e.toDataURL(),t},a.getVar=function(e,t,i,n){if(void 0===i&&(i=null),void 0===n&&(n=function(e){return!0}),t in e&&n(e[t]))return e[t];var o=t.indexOf(".");-1==o&&(o=t.length);var r=t.substring(0,o);if(r in e&&null!=e[r]&&void 0!==e[r]){if(o!=t.length)return a.getVar(e[r],t.substring(r.length+1),i,n);if(n(e[r]))return e[r]}return i},a.synchronize=function(e,i){return function(t){e.filter(function(e){return e(t)}).length==e.length&&i(t)}},a.createRandomId=function(){return"nnnnnn-nnnn-nnnn-nnnnnnnn".split("n").map(function(e){return e+Math.ceil(15*Math.random()).toString(36)}).join("")},a.hash=function(e){for(var t=0,i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return t},a.selectElementText=function(e){e.select()},a.LOG_HALF=Math.log(.5),a.stopPropagation=function(e){e.stopImmediatePropagation()},a}(),MyCoReMap=function(){function o(e){if(this.keyMap={},this.valueMap={},this.keyToHashFunction=o.BASE_KEY_TO_HASH_FUNCTION,void 0!==e)for(var t in e)this.set(t,e[t])}return o.prototype.set=function(e,t){var i=this.getHash(e);this.keyMap[i]=e,this.valueMap[i]=t},o.prototype.get=function(e){return this.valueMap[this.getHash(e)]},o.prototype.setKeyToHashFunction=function(e){this.keyToHashFunction=e},o.prototype.hasThen=function(e,t){this.has(e)&&t(this.get(e))},Object.defineProperty(o.prototype,"keys",{get:function(){var e=[];for(var t in this.keyMap)e.push(this.keyMap[t]);return e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"values",{get:function(){var e=[];for(var t in this.valueMap)e.push(this.valueMap[t]);return e},enumerable:!0,configurable:!0}),o.prototype.has=function(e){if(void 0===e||null==e)return!1;var t=this.valueMap[this.getHash(e)];return void 0!==t&&null!=t},o.prototype.forEach=function(t){var i=this;this.keys.forEach(function(e){t(e,i.get(e))})},o.prototype.filter=function(i){var n=new o;return this.forEach(function(e,t){i(e,t)&&n.set(e,t)}),n},o.prototype.copy=function(){var i=new o;return this.forEach(function(e,t){i.set(e,t)}),i},o.prototype.remove=function(e){var t=this.getHash(e);delete this.keyMap[t],delete this.valueMap[t]},o.prototype.clear=function(){this.keyMap={},this.valueMap={}},o.prototype.mergeIn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this;for(var n in e){e[n].forEach(function(e,t){i.set(e,t)})}},o.prototype.isEmpty=function(){return Object.keys(this.keyMap).length<=0},o.prototype.getHash=function(e){return o.KEY_PREFIX+this.keyToHashFunction(e)},o.BASE_KEY_TO_HASH_FUNCTION=function(e){return e.toString()},o.KEY_PREFIX="MyCoReMap.",o}(),ViewerError=function(){function e(e,t){void 0===t&&(t=null),this.informations=new MyCoReMap,this.informations.set("message",e),this.informations.set("error",t),this.informations.set("callee",arguments.callee),console.log(this.toString()),console.trace()}return e.prototype.toString=function(){return this.informations.get("message")},e}(),ViewerProperty=function(){function e(e,t,i){void 0===i&&(i=null),this._from=e,this._name=t,this._value=i,this.propertyChanging=!1,this.observerArray=new Array}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){var t=this.clone();this._value=e,this.notifyPropertyChanged(t,this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"from",{get:function(){return this._from},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._from,this.name,this.value)},e.prototype.removeAllObserver=function(){for(;this.observerArray.pop(););},e.prototype.removeObserver=function(e){var t=this.observerArray.indexOf(e);this.observerArray.splice(t,1)},e.prototype.addObserver=function(e){this.observerArray.push(e)},e.prototype.notifyPropertyChanged=function(t,i){var n=this;this.propertyChanging=!0,this.observerArray.forEach(function(e){n.propertyChanging&&e.propertyChanged(t,i)}),this.propertyChanging=!1},e}();function ViewerFormatString(e,t){var i,n,o,r=e;for(var a in t)i=r,o=t[n=a],r=i.replace("{"+n+"}",o);return r}var viewerRequestAnimationFrame=function(e){return void 0===e&&(e=window),window.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(window),viewerCancelRequestAnimationFrame=function(e){return void 0===e&&(e=window),window.cancelAnimationFrame||e.webkitCancelRequestAnimationFrame||e.mozCancelRequestAnimationFrame||function(e){window.clearTimeout(e)}}(window),ViewerUserSettingStore=function(){function e(){if(null!=e._INSTANCE)throw new ViewerError("Its a Singleton use instance instead!");this._browserStorageSupport="undefined"!=typeof Storage,this.browserStorageSupport||(this._sessionMap=new MyCoReMap)}return e.getInstance=function(){return void 0!==e._INSTANCE&&null!=e._INSTANCE||(e._INSTANCE=new e),e._INSTANCE},e.prototype.getValue=function(e){return this.browserStorageSupport?window.localStorage.getItem(e):this._sessionMap.get(e)},e.prototype.setValue=function(e,t){this.browserStorageSupport?window.localStorage.setItem(e,t):this._sessionMap.set(e,t)},e.prototype.hasValue=function(e){return this.browserStorageSupport?null!==window.localStorage.getItem(e):this._sessionMap.has(e)},Object.defineProperty(e.prototype,"browserStorageSupport",{get:function(){return this._browserStorageSupport},enumerable:!0,configurable:!0}),e.LOCK=!1,e}();function isFullscreen(){var e=document;return null!=e.fullscreenElement||null!=e.webkitFullscreenElement}var viewerDeviceSupportTouch="ontouchstart"in window;function viewerCrossBrowserWheel(h,u){var e=function(e){e.preventDefault();var t=e.clientX-jQuery(h).offset().left,i=e.clientY-jQuery(h).offset().top,n=new Position2D(t,i).scale(window.devicePixelRatio);if("deltaX"in e)u({deltaX:e.deltaX,deltaY:e.deltaY,orig:e,pos:n,altKey:e.altKey,ctrlKey:e.ctrlKey});else{var o=e.shiftKey;if("axis"in e&&(o=1==e.axis,"detail"in e)){var r=e.detail,a={deltaX:0,deltaY:0,orig:e,pos:n,altKey:e.altKey,ctrlKey:e.ctrlKey};return o?a.deltaX=r:a.deltaY=r,void u(a)}if("wheelDelta"in e){var s=-e.wheelDelta,l=e.shiftKey?{deltaX:s,deltaY:0}:{deltaX:0,deltaY:s};l.orig=e,l.pos=n,l.altKey=e.altKey,u(l)}}};h.addEventListener&&(h.addEventListener("mousewheel",e,!1),h.addEventListener("MozMousePixelScroll",e,!1))}var ViewerPromise=function(){function t(){this._result=null,this._rejectReason=null,this._then=t.DEFAULT,this._onReject=t.DEFAULT}return t.prototype.then=function(e){this._then=e,null!=this._result&&e(this._result)},t.prototype.onreject=function(e){this._onReject=e,null!=this._rejectReason&&this._onReject(this._rejectReason)},t.prototype.reject=function(e){this._rejectReason=e,this._onReject!=t.DEFAULT&&this._onReject(e)},t.prototype.resolve=function(e){this._result=e,this._then!=t.DEFAULT&&this._then(e)},t.DEFAULT=function(e){},t}(),ViewerParameterMap=function(e){function a(){return e.call(this)||this}return __extends(a,e),a.prototype.toParameterString=function(){var i=new Array;this.forEach(function(e,t){i.push(e+"="+t)});var e=i.join("&");return 0<e.length?"?"+e:""},a.fromCurrentUrl=function(){return a.fromUrl(window.location.href)},a.fromUrl=function(e){var t=new a,i=e.split("?")[1];if(void 0!==i){i.split("#")[0];var n=i.split("&");for(var o in n){var r=n[o].split("=");t.set(r[0],decodeURIComponent(r[1]))}}return t},a}(MyCoReMap);function singleSelectShim(e,t,i){if("evaluate"in document){return e.evaluate(t,e.documentElement,function(e){return i.get(e)},XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}var n=new ActiveXObject("Msxml2.DOMDocument.6.0");n.async=!1,n.load(e);var o="";return i.keys.forEach(function(e){var t="xmlns:"+e+'="'+i.get(e)+'" ';o+=t}),n.setProperty("SelectionNamespaces",o),n.setProperty("SelectionLanguage","XPath"),n.documentElement.selectSingleNode(t)}function getNodesShim(e,t,i,n,o,r){if("evaluate"in document){for(var a=e.evaluate(t,i,function(e){return n.get(e)},o,r),s=[],l=void 0;null!=(l=a.iterateNext());)s.push(l);return s}var h=new ActiveXObject("Msxml2.DOMDocument.6.0");h.async=!1,h.load(e);var u="";n.keys.forEach(function(e){var t="xmlns:"+e+'="'+n.get(e)+'" ';u+=t}),h.setProperty("SelectionNamespaces",u),h.setProperty("SelectionLanguage","XPath");a=h.documentElement.selectNodes(t),s=[];for(var p=0;p<a.length;p++)s.push(a.nextNode());return s}var XMLUtil=function(){function n(){}var e;return n.iterateChildNodes=function(e,t){for(var i=e.childNodes,n=0;n<i.length;n++)t(i.item(n))},n.nodeListToNodeArray=function(e){for(var t=new Array,i=0;i<e.length;i++)t.push(e.item(i));return t},n.getOneChild=function(e,t){var i=e.childNodes;return n.getOneOf(i,t)},n.getOneOf=function(e,t){for(var i=0;i<e.length;i++){var n=e.item(i);if(t(n))return n}return null},n.METS_NAMESPACE_URI="http://www.loc.gov/METS/",n.XLINK_NAMESPACE_URI="http://www.w3.org/1999/xlink",n.NS_MAP=((e=new MyCoReMap).set("mets",n.METS_NAMESPACE_URI),e.set("xlink",n.XLINK_NAMESPACE_URI),e),n}(),ClassDescriber=function(){function i(){}return i.getName=function(e){var t=/function (.{1,})\(/.exec(e.constructor.toString());return t&&1<t.length?t[1]:""},i.ofEqualClass=function(e,t){return i.getName(e)==i.getName(t)},i}(),Debounce=function(){function e(e,t){this.time=e,this.handler=t,this._timeout=null}return e.prototype.call=function(e){var t=this;null!==this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),this._timeout=window.setTimeout(function(){t._timeout=null,t.handler(e)},this.time)},e}();!function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function e(){this._currentAnimation=null,this._lastAnimTime=-1,this.positionProperty=new ViewerProperty(this,"_position",new Position2D(0,0)),this.sizeProperty=new ViewerProperty(this,"_position",new Size2D(0,0)),this.rotationProperty=new ViewerProperty(this,"_rotation",0),this.scaleProperty=new ViewerProperty(this,"_scale",1)}return Object.defineProperty(e.prototype,"scale",{get:function(){return this.scaleProperty.value},set:function(e){if(0==e||void 0===e||null==e||isNaN(e))throw new ViewerError("The scale of viewport is not valid!",e);this.scaleProperty.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.rotationProperty.value},set:function(e){if(0!=e&&90!=e&&180!=e&&270!=e)throw new ViewerError("The rotation of viewport is not valid!",e);this.rotationProperty.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.sizeProperty.value},set:function(e){if(void 0===e||null==e||isNaN(e.width)||isNaN(e.height))throw new ViewerError("The size of viewport is not valid!",e);this.sizeProperty.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.positionProperty.value},set:function(e){if(void 0===e||null==e||isNaN(e.x)||isNaN(e.y))throw new ViewerError("The position of viewport is not valid!",e);this.positionProperty.value=e},enumerable:!0,configurable:!0}),e.prototype.asRectInArea=function(){var e=this.size.getRotated(this.rotation).scale(1/this.scale);return new Rect(new Position2D(this.position.x-e.width/2,this.position.y-e.height/2),e)},e.prototype.startAnimation=function(e){this._currentAnimation=e,this._lastAnimTime=(new Date).valueOf(),this.scale=this.scale},e.prototype.getAbsolutePosition=function(e){var t=this.asRectInArea().getPoints(),i=t.upperLeft;switch(this.rotation){case 90:i=t.lowerLeft;break;case 180:i=t.lowerRight;break;case 270:i=t.upperRight}var n=e.scale(1/this.scale).rotate(this.rotation);return new Position2D(i.x+n.x,i.y+n.y)},e.prototype.stopAnimation=function(){this._currentAnimation=null},e.prototype.updateAnimation=function(){if(null!=this._currentAnimation){var e=(new Date).valueOf();this._currentAnimation.updateAnimation(e-this._lastAnimTime)?this._currentAnimation=null:this._lastAnimTime=(new Date).valueOf()}},Object.defineProperty(e.prototype,"currentAnimation",{get:function(){return this._currentAnimation},enumerable:!0,configurable:!0}),e.prototype.setRect=function(e){0<this.size.width&&0<this.size.height&&(this.scale=Math.min(this.size.width/e.size.width,this.size.height/e.size.height)),this.position=e.getMiddlePoint()},e}(),n.Viewport=o}(mycore||(mycore={})),function(e){var t,i;t=e.viewer||(e.viewer={}),function(e){var t=function(){function e(){this._pages=new Array,this._pageAreaInformationMap=new MyCoReMap,this._updateCallback=null}return Object.defineProperty(e.prototype,"updateCallback",{get:function(){return null==this._updateCallback?function(){}:this._updateCallback},set:function(e){this._updateCallback=e},enumerable:!0,configurable:!0}),e.prototype.addPage=function(e,t){this.setPageAreaInformation(e,t),this._pages.push(e),this.registerPageAreaInformationEvents(t),this.updateCallback()},e.prototype.removePage=function(e){this._pages.splice(this._pages.indexOf(e),1);var t=this._pageAreaInformationMap.get(e);this._pageAreaInformationMap.remove(e),this.unregisterPageAreaInformationEvents(t),this.updateCallback()},e.prototype.propertyChanged=function(e,t){this._updateCallback()},e.prototype.setPageAreaInformation=function(e,t){this._pageAreaInformationMap.set(e,t)},e.prototype.getPages=function(){return this._pages},e.prototype.getPagesInViewport=function(t){var i=this,e=this._pages,n=new Array;return e.forEach(function(e){i.pageIntersectViewport(e,t)&&n.push(e)}),n},e.prototype.getPageInformation=function(e){return this._pageAreaInformationMap.get(e)},e.prototype.pageIntersectViewport=function(e,t){var i=this._pageAreaInformationMap.get(e),n=e.size.getRotated(i.rotation).scale(i.scale),o=new Position2D(i.position.x-n.width/2,i.position.y-n.height/2),r=new Rect(o,n),a=t.asRectInArea();return null!=r.getIntersection(a)},e.prototype.registerPageAreaInformationEvents=function(e){e.positionProperty.addObserver(this),e.rotationProperty.addObserver(this),e.scaleProperty.addObserver(this)},e.prototype.unregisterPageAreaInformationEvents=function(e){e.positionProperty.removeObserver(this),e.rotationProperty.removeObserver(this),e.scaleProperty.removeObserver(this)},e}();e.PageArea=t;var i=function(){function e(){this._positionProperty=new ViewerProperty(this,"position",new Position2D(0,0)),this._scaleProperty=new ViewerProperty(this,"scale",1),this._rotationProperty=new ViewerProperty(this,"rotation",0)}return Object.defineProperty(e.prototype,"positionProperty",{get:function(){return this._positionProperty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationProperty",{get:function(){return this._rotationProperty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleProperty",{get:function(){return this._scaleProperty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotationProperty.value},set:function(e){this.rotationProperty.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.scaleProperty.value},set:function(e){this.scaleProperty.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.positionProperty.value},set:function(e){this.positionProperty.value=e},enumerable:!0,configurable:!0}),e}();e.PageAreaInformation=i}((i=t.widgets||(t.widgets={})).canvas||(i.canvas={}))}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function a(){}return a.centerViewportOnPage=function(e,t){e.position=t.position},a.fitViewportOverPage=function(i,n,o){if(0!=i.size.width&&0!=i.size.height){a.centerViewportOnPage(i,n);var e=i.size.getRotated(i.rotation);i.scale=Math.min(e.width/o.size.width,e.height/o.size.height)}else{var r={propertyChanged:function(e,t){a.fitViewportOverPage(i,n,o),i.sizeProperty.removeObserver(r)}};i.sizeProperty.addObserver(r)}},a.fitViewportOverPageWidth=function(e,t,i){if(0!=e.size.width&&0!=e.size.height){var n=i.size.getRotated(e.rotation).scale(t.scale);e.scale=e.size.width/n.width,e.size.getRotated(e.rotation);var o=0==e.rotation||180==e.rotation?e.position:new Position2D(e.position.y,e.position.x),r=Math.max(o.y,t.position.y-n.height/2+e.size.scale(1/e.scale).height/2);r=Math.min(r,t.position.y+n.height/2-e.size.scale(1/e.scale).height/2),e.size.height>n.scale(e.scale).width&&(r=0),0==e.rotation||180==e.rotation?e.position=new Position2D(t.position.x,r):e.position=new Position2D(r,t.position.x)}},a}(),n.ViewportTools=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function e(){this.isRunning=!1,this.isFinished=!1,this.isPaused=!1,this.totalElapsedTime=0}return e.prototype.updateAnimation=function(e){return this.isPaused||this.isFinished||(this.isRunning||(e=0,this.totalElapsedTime=0),this.totalElapsedTime+=e,this.isFinished=this.update(e),this.isRunning=!this.isFinished),this.isFinished},e.prototype.pause=function(){this.isPaused=!0},e.prototype.continue=function(){this.isPaused=!1},e}(),n.StatefulAnimation=o}(mycore||(mycore={})),function(e){var t,i;t=e.viewer||(e.viewer={}),function(e){var t=function(r){function e(e,t,i,n){void 0===n&&(n=a);var o=r.call(this)||this;return o.duration=e,o.from=t,o.to=i,o.interpolationFunction=n,o.value=o.from,o}return __extends(e,r),e.prototype.update=function(e){if(this.totalElapsedTime>=this.duration)return this.totalElapsedTime=this.duration,this.value=this.to,!0;var t=this.totalElapsedTime/this.duration;return this.value=this.interpolationFunction(this.from,this.to,t),!1},e}(e.StatefulAnimation);function a(e,t,i){return e+(t-e)*i}e.InterpolationAnimation=t}((i=t.widgets||(t.widgets={})).canvas||(i.canvas={}))}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function e(e,t,i){this._vp=e,this._area=t,this._view=i,this._addedPages=new Array,this._pageElementCache=new MyCoReMap,this._idPageMap=new MyCoReMap,this._addedContentMap=new MyCoReMap,this.htmlContainer=document.createElement("div"),this.htmlContainer.setAttribute("class","textContainer"),this._view.container[0].appendChild(this.htmlContainer)}return e.prototype.update=function(){var o=this,t=this._area.getPagesInViewport(this._vp);t.forEach(function(n){if(o._idPageMap.has(n.id)||o._idPageMap.set(n.id,n),-1==o._addedPages.indexOf(n)&&o.addPage(n),!o._addedContentMap.has(n)&&"getHTMLContent"in n){var e=n.getHTMLContent();o._addedContentMap.set(n,e);var t={propertyChanged:function(e,t){if(null!=t.value){var i=o._pageElementCache.get(n).querySelector("div div");i.innerHTML="",i.appendChild(t.value)}}};e.addObserver(t),t.propertyChanged(null,e)}o.updatePage(n)}),this._addedPages.forEach(function(e){-1==t.indexOf(e)&&o.removePage(e)})},e.prototype.updatePage=function(e){var t=this._area.getPageInformation(e),i=e.size.scale(t.scale),n=i.scale(.5),o=new Rect(new Position2D(t.position.x-n.width,t.position.y-n.height),i),r=this._vp.asRectInArea(),a=window.devicePixelRatio||1,s=new Position2D(o.pos.x-r.pos.x,o.pos.y-r.pos.y).scale(this._vp.scale/a),l=this._pageElementCache.get(e),h=i.scale(1/t.scale);l.style.cssText="\n                position: absolute;\n                transform-origin : 0% 0%;\n                width : "+h.width+"px;\n                height : "+h.height+"px;\n                transform : translate("+Math.round(s.x)+"px,"+Math.round(s.y)+"px) scale("+t.scale*this._vp.scale/a+");\n                ",l.children[0].style.cssText="transform : rotate("+t.rotation+"deg);width: "+h.width+"px;height: "+h.height+"px;background-color : transparent;"},e.prototype.addPage=function(e){this._pageElementCache.has(e)||this.createPageElement(e);var t=this._pageElementCache.get(e);this._addedPages.push(e),this.htmlContainer.appendChild(t)},e.prototype.createPageElement=function(e){var t=document.createElement("div"),i=t.cloneNode();t.appendChild(i),this._pageElementCache.set(e,t)},e.prototype.removePage=function(e){this._addedPages.splice(this._addedPages.indexOf(e),1);var t=this._pageElementCache.get(e);t.parentElement.removeChild(t)},e}(),n.HtmlRenderer=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function e(e,t,i,n,o){this._vp=e,this._area=t,this._view=i,this._textContentProvider=n,this.pageLinkClicked=o,this._contentCache=new MyCoReMap,this._callbackRunning=new MyCoReMap,this._addedPages=new Array,this._elementCache=new MyCoReMap,this._pageElementCache=new MyCoReMap,this._lineElementMap=new MyCoReMap,this._highlightWordMap=null,this._idPageMap=new MyCoReMap,this._mesureCanvas=document.createElement("canvas").getContext("2d"),this.textContainer=document.createElement("div"),this.textContainer.style.cssText="line-height: 1;white-space: pre;font-family: sans-serif",this.textContainer.setAttribute("class","textContainer"),this._view.container[0].appendChild(this.textContainer)}return e.prototype.update=function(){var i=this,t=this._area.getPagesInViewport(this._vp);t.forEach(function(t){i._idPageMap.has(t.id)||i._idPageMap.set(t.id,t),-1==i._addedPages.indexOf(t)&&i.addPage(t),i._contentCache.has(t)||i._callbackRunning.has(t)?i._contentCache.has(t)&&i.updatePage(t):(i._textContentProvider(t,function(e){i._contentCache.set(t,e),i.addPageParts(t,e)}),i._callbackRunning.set(t,!0))}),this._addedPages.forEach(function(e){-1==t.indexOf(e)&&i.removePage(e)})},e.prototype.updatePage=function(e){var t=this._area.getPageInformation(e),i=e.size.scale(t.scale),n=i.scale(.5),o=new Rect(new Position2D(t.position.x-n.width,t.position.y-n.height),i),r=this._vp.asRectInArea(),a=window.devicePixelRatio||1,s=new Position2D(o.pos.x-r.pos.x,o.pos.y-r.pos.y).scale(this._vp.scale/a),l=this._pageElementCache.get(e),h=i.scale(1/t.scale);l.style.cssText="transform-origin : 0% 0%;position : absolute;left : "+s.x+"px;top : "+s.y+"px;width : "+h.width+"px;height : "+h.height+"px;transform : scale("+t.scale*this._vp.scale/a+");z-index: 5;",l.children[0].style.cssText="transform : rotate("+t.rotation+"deg);width: "+h.width+"px;height: "+h.height+"px;"},e.prototype.addPage=function(e){this._pageElementCache.has(e)||this.createPageElement(e);var t=this._pageElementCache.get(e);this._addedPages.push(e),this.textContainer.appendChild(t)},e.prototype.createPageElement=function(e){var t=document.createElement("div"),i=t.cloneNode();t.appendChild(i),this._pageElementCache.set(e,t),t.style.display="none"},e.prototype.removePage=function(e){this._addedPages.splice(this._addedPages.indexOf(e),1);var t=this._pageElementCache.get(e);t.parentElement.removeChild(t)},e.prototype.addPageParts=function(n,e){var o=this,r=document.createDocumentFragment();e.content.forEach(function(e){var t=e.pos.toString()+e.text;if(!o._elementCache.has(t)){var i=o.createContentPart(n,e);r.appendChild(i)}}),e.links.forEach(function(e){var t=e.rect.toString()+e.url;if(!o._elementCache.has(t)){var i=document.createElement("a");i.setAttribute("href",e.url),i.style.left=e.rect.getX()+"px",i.style.top=e.rect.getY()+"px",i.style.width=e.rect.getWidth()+"px",i.style.height=e.rect.getHeight()+"px",i.style.display="block",i.style.position="fixed",i.style.zIndex="8",i.setAttribute("target","_blank"),o._elementCache.set(t,i),r.appendChild(i)}}),e.internLinks.forEach(function(e){var t=e.rect.toString()+"DEST";if(!o._elementCache.has(t)){var i=document.createElement("a");i.style.left=e.rect.getX()+"px",i.style.top=e.rect.getY()+"px",i.style.width=e.rect.getWidth()+"px",i.style.height=e.rect.getHeight()+"px",i.style.display="block",i.style.position="fixed",i.style.zIndex="8",i.style.cursor="pointer",i.addEventListener("click",function(){e.pageNumberResolver(function(e){o.pageLinkClicked(e)})}),o._elementCache.set(t,i),r.appendChild(i)}});var t=this._pageElementCache.get(n).children[0];t.appendChild(r),"none"==t.style.display&&(t.style.display="block")},e.prototype.removeContentPart=function(e){var t=this._lineElementMap.get(e);t.parentElement.removeChild(t),this._lineElementMap.remove(e)},e.prototype.createContentPart=function(e,t){var i=window.document.createElement("div");i.textContent=t.text,i.setAttribute("class","line");var n=function(e){e.stopPropagation()};i.addEventListener("mousedown",n),i.addEventListener("mouseup",n),i.addEventListener("mousemove",n),i.addEventListener("mouseenter",function(){"mouseenter"in t&&"function"==typeof t.mouseenter&&t.mouseenter()}),i.addEventListener("mouseleave",function(){"mouseleave"in t&&"function"==typeof t.mouseleave&&t.mouseleave()});var o=e.size,r=t.pos.toString()+t.text;this._elementCache.set(r,i),this._mesureCanvas.save(),this._mesureCanvas.font=t.fontSize+"px "+t.fontFamily;var a=this._mesureCanvas.measureText(t.text).width;this._mesureCanvas.restore();var s=t.size.width/a;this._lineElementMap.set(t,i);var l="fromBottomLeft"in t&&!t.fromBottomLeft?t.pos.y:o.height-t.pos.y;return i.style.cssText="left : "+t.pos.x+"px;top : "+l+"px;font-family : "+t.fontFamily+";font-size : "+t.fontSize+"px;transform-origin : 0% 0%;transform : scalex("+s+");",i},e}(),n.TextRenderer=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function r(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this.drawImage=e,this.drawHTML=t,this.container=jQuery("<div></div>"),this.drawCanvas=null,this.markCanvas=null;var i=e&&t?"grayscale(1) contrast(1000%)":null;this.drawCanvas=r.createCanvas(1,i),this.markCanvas=r.createCanvas(4),jQuery(this.drawCanvas).appendTo(this.container),jQuery(this.markCanvas).appendTo(this.container),this.container.css({position:"absolute",top:"0px",left:"0px",bottom:"0px",right:"0px",overflow:"hidden"});var n=this.drawCanvas.getContext("2d"),o=this.markCanvas.getContext("2d");"imageSmoothingEnabled"in n&&(n.imageSmoothingEnabled=!1,o.imageSmoothingEnabled=!1)}return r.createCanvas=function(e,t){void 0===e&&(e=1);var i=document.createElement("canvas");return i.style.transform="scale(1.0)",i.style.position="absolute",i.style.zIndex=e+"",t&&(i.style.filter=t),i},r}(),n.PageView=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function e(e){var r=this;this._horizontal=e,this._areaSize=null,this._viewSize=null,this._position=null,this._mouseDown=-1,this._scrollhandler=null,this._cachedScrollbarElementSize=null,this._cacheTime=-1,this.initElements();var t=jQuery(document.body),i=function(e){if(-1!=r._mouseDown){var t=(r._horizontal?e.clientX-r._scrollbarElement.offset().left:e.clientY-r._scrollbarElement.offset().top)-r._mouseDown,i=((r._horizontal?r._scrollbarElement.width():r._scrollbarElement.height())-30)/r._areaSize;r._position=t/i,r.update(),null!=r.scrollHandler&&r.scrollHandler(),e.preventDefault()}},n=function(e){(r._mouseDown=-1)!=o&&(window.clearInterval(o),o=-1,e.preventDefault()),t.unbind("mousemove",i)};this._slider.mousedown(function(e){r._mouseDown=r._horizontal?e.clientX-r._slider.offset().left:e.clientY-r._slider.offset().top,t.bind("mousemove",i),t.bind("mouseup",n),e.preventDefault()}),this._scrollbarElement.mousedown(function(e){if(!jQuery(e.target).hasClass("slider")){var t=r._horizontal?e.clientX-r._scrollbarElement.offset().left:e.clientY-r._scrollbarElement.offset().top,i=(r._horizontal?r._scrollbarElement.width():r._scrollbarElement.height())-30,n=i/r._areaSize,o=Math.min(Math.max(20,r._viewSize*n),i);r._position=(t-o/2)/n,r.update(),null!=r.scrollHandler&&r.scrollHandler()}});var o=-1;this._startButton.mousedown(function(e){r._position-=200,r.scrollHandler(),e.preventDefault(),e.stopImmediatePropagation(),o=window.setInterval(function(){r._position-=200,r.scrollHandler()},111)}),this._endButton.mousedown(function(e){r._position+=200,r.scrollHandler(),e.preventDefault(),e.stopImmediatePropagation(),o=window.setInterval(function(){r._position+=200,r.scrollHandler()},111)}),jQuery(document.body).mousemove(function(e){if(-1!=r._mouseDown){var t=(r._horizontal?e.clientX-r._scrollbarElement.offset().left:e.clientY-r._scrollbarElement.offset().top)-r._mouseDown,i=((r._horizontal?r._scrollbarElement.width():r._scrollbarElement.height())-30)/r._areaSize;r._position=t/i,r.update(),null!=r.scrollHandler&&r.scrollHandler()}}),jQuery(document.body).mouseup(function(e){(r._mouseDown=-1)!=o&&(window.clearInterval(o),o=-1)})}return e.prototype.clearRunning=function(){this._mouseDown=-1},e.prototype.initElements=function(){this._className=this._horizontal?"horizontal":"vertical",this._scrollbarElement=jQuery("<div></div>"),this._scrollbarElement.addClass(this._className+"Bar"),this._slider=jQuery("<div></div>"),this._slider.addClass("slider"),this._startButton=jQuery("<div></div>"),this._startButton.addClass("startButton"),this._endButton=jQuery("<div></div>"),this._endButton.addClass("endButton"),this._startButton.appendTo(this._scrollbarElement),this._slider.appendTo(this._scrollbarElement),this._endButton.appendTo(this._scrollbarElement)},Object.defineProperty(e.prototype,"viewSize",{get:function(){return this._viewSize},set:function(e){this._viewSize=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"areaSize",{get:function(){return this._areaSize},set:function(e){this._areaSize=e,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this.update()},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(null!=this._areaSize&&null!=this._viewSize&&null!=this._position){var e=this.getScrollbarElementSize.call(this),t=(this._horizontal?e.width:e.height)-30,i=t/this._areaSize,n=Math.min(Math.max(20,this._viewSize*i),t),o={};o[this._horizontal?"width":"height"]=n+"px",this._slider.css(o),i=(t-(n-this._viewSize*i))/this._areaSize;var r=Math.min(Math.max(this._position*i+15,15),this.areaSize*i-n)+15,a={};a[this._horizontal?"left":"top"]=r+"px",this._slider.css(a)}},e.prototype.getScrollbarElementSize=function(){var e=(new Date).getTime();if(null==this._cachedScrollbarElementSize||e-1e3>this._cacheTime){var t=this._scrollbarElement.height(),i=this._scrollbarElement.width();this._cachedScrollbarElementSize=new Size2D(i,t),this._cacheTime=(new Date).getTime()}return this._cachedScrollbarElementSize},e.prototype.resized=function(){this._cachedScrollbarElementSize=null},Object.defineProperty(e.prototype,"scrollbarElement",{get:function(){return this._scrollbarElement},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollHandler",{get:function(){return this._scrollhandler},set:function(e){this._scrollhandler=e},enumerable:!0,configurable:!0}),e}(),n.Scrollbar=o}(mycore||(mycore={})),function(e){var t,i,o,n;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),o=i.canvas||(i.canvas={}),n=function(n){function e(e,t){void 0===t&&(t=new Size2D(250,250));var i=n.call(this,!0,!1)||this;return i.vp=e,i._maxOverviewSize=t,i.overviewViewport=new o.Viewport,i.container.addClass("overview"),i.container.attr("style",""),i.container.css("z-index","6"),jQuery(i.markCanvas).detach(),i}return __extends(e,n),e.prototype.updateOverviewSize=function(e){e=e.roundUp(),this.container[0].style.width=e.width+"px",this.container[0].style.height=e.height+"px",this.drawCanvas.width==e.width&&this.drawCanvas.height==e.height&&this.markCanvas.width==e.width&&this.markCanvas.height==e.height||(this.drawCanvas.width=e.width,this.drawCanvas.height=e.height,this.markCanvas.width=e.width,this.markCanvas.height=e.height),this.overviewViewport.size=e},Object.defineProperty(e.prototype,"overviewRect",{get:function(){return this.overviewViewport.asRectInArea()},set:function(e){this.overviewViewport.position=e.getMiddlePoint();var t,i=this.overviewViewport.scale=Math.min(this._maxOverviewSize.width/e.size.width,this._maxOverviewSize.height/e.size.height);if(this._maxOverviewSize.width/e.size.width==i){var n=e.size.width/e.size.height;t=new Size2D(this._maxOverviewSize.width,this._maxOverviewSize.height/n)}else n=e.size.height/e.size.width,t=new Size2D(this._maxOverviewSize.width/n,this._maxOverviewSize.height);this.updateOverviewSize(t),this._overviewRect=e},enumerable:!0,configurable:!0}),e.prototype.drawRect=function(){var e=this.drawCanvas.getContext("2d"),t=this.overviewViewport.asRectInArea(),i=this.vp.asRectInArea(),n=new Position2D(i.pos.x-t.pos.x,i.pos.y-t.pos.y);n=n.scale(this.overviewViewport.scale);var o=this.vp.asRectInArea().size.scale(this.overviewViewport.scale);e.save(),e.lineWidth=500,e.strokeStyle="rgba(0,0,0,0.5)",e.translate(-250,-250),e.strokeRect(n.x,n.y,o.width+500,o.height+500),e.restore()},e.prototype.initEventHandler=function(){var a=this,t=function(e){e.preventDefault();var t=e.clientX+window.pageXOffset-jQuery(e.target).offset().left,i=e.clientY+window.pageYOffset-jQuery(e.target).offset().top,n=new Position2D(t,i).scale(1/a.overviewViewport.scale),o=a.overviewViewport.asRectInArea().getPoints().upperLeft,r=new Position2D(n.x+o.x,n.y+o.y);a.vp.position=r,e.stopImmediatePropagation()};jQuery(this.drawCanvas).mousedown(function(e){jQuery(a.drawCanvas).bind("mousemove",t)}),jQuery(this.drawCanvas).mouseup(function(e){jQuery(a.drawCanvas).unbind("mousemove",t)}),jQuery(this.drawCanvas).mouseout(function(e){jQuery(a.drawCanvas).unbind("mousemove",t)})},e}(o.PageView),o.Overview=n}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function e(e){var t=this;void 0===e&&(e=!1),this.miniOverview=e,this._lastSize=new Size2D(0,0),this._requestRunning=!1,this._nextRequested=!1,this._pageArea=new n.PageArea,this._viewport=new n.Viewport,this._views=new Array,this._viewHTMLRendererMap=new MyCoReMap,this._textRenderer=null,this._canvasPageLayers=new MyCoReMap,this._lastAnimationTime=null,this._animations=new Array,this._overview=null,this._pageArea.updateCallback=function(){t.update()},this._updateSizeIfChanged(),this._registerViewport()}return e.prototype._updateSizeIfChanged=function(){var n=this;this._views.forEach(function(e){var t=Math.round(e.container.width()*(window.devicePixelRatio||1)),i=Math.round(e.container.height()*(window.devicePixelRatio||1));e.drawCanvas.width==t&&e.drawCanvas.height==i&&e.markCanvas.width==t&&e.markCanvas.height==i||n._updateSize(e)})},e.prototype._updateSize=function(e){e.drawCanvas.width=e.container.width()*(window.devicePixelRatio||1),e.drawCanvas.height=e.container.height()*(window.devicePixelRatio||1),e.markCanvas.width=e.container.width()*(window.devicePixelRatio||1),e.markCanvas.height=e.container.height()*(window.devicePixelRatio||1),this._lastSize=new Size2D(e.drawCanvas.width,e.drawCanvas.height),this._viewport.size=new Size2D(e.drawCanvas.width,e.drawCanvas.height)},e.prototype._unregisterViewport=function(){null!=this._viewport&&(this._viewport.sizeProperty.removeAllObserver(),this._viewport.positionProperty.removeAllObserver(),this._viewport.scaleProperty.removeAllObserver(),this._viewport.rotationProperty.removeAllObserver())},e.prototype._registerViewport=function(){var i=this,e={propertyChanged:function(e,t){i.update()}};this._viewport.sizeProperty.addObserver(e),this._viewport.positionProperty.addObserver(e),this._viewport.scaleProperty.addObserver(e),this._viewport.rotationProperty.addObserver(e)},e.prototype.update=function(){var i=this;this._nextRequested||(this._nextRequested=!0,this._requestRunning||(this._requestRunning=!0,viewerRequestAnimationFrame(function(){i._nextRequested=!1,i._updateSizeIfChanged(),i.updateAnimations(),i._views.forEach(function(e){var t;e.drawHTML&&(i._viewHTMLRendererMap.has(e)?t=i._viewHTMLRendererMap.get(e):(t=new n.HtmlRenderer(i._viewport,i._pageArea,e),i._viewHTMLRendererMap.set(e,t)),t.update()),i.drawOnView(e,i.viewport,!e.drawImage)}),null!=i._textRenderer&&i._textRenderer.update(),null!=i._overview&&(i.drawOnView(i._overview,i._overview.overviewViewport),i._overview.drawRect())}),this._requestRunning=!1))},e.prototype.drawOnView=function(t,i,n){var o=this;if(void 0===i&&(i=this._viewport),void 0===n&&(n=!1),null!=t&&null!=i){t.drawCanvas.width=t.drawCanvas.width,t.markCanvas.width=t.markCanvas.width;var e=i.size.getRotated(i.rotation),r=t.drawCanvas.getContext("2d"),a=t.markCanvas.getContext("2d");r.save(),a.save(),r.translate(i.size.width/2,i.size.height/2),r.rotate(i.rotation*Math.PI/180),r.translate(-e.width/2,-e.height/2),a.translate(i.size.width/2,i.size.height/2),a.rotate(i.rotation*Math.PI/180),a.translate(-e.width/2,-e.height/2),this._pageArea.getPagesInViewport(i).forEach(function(e){o.drawPage(e,o._pageArea.getPageInformation(e),i.asRectInArea(),i.scale,i!=o._viewport,t,n)}),r.restore(),a.restore()}},e.prototype.drawPage=function(t,e,i,n,o,r,a){void 0===a&&(a=!1);var s=t.size.getRotated(e.rotation).scale(e.scale),l=new Rect(new Position2D(e.position.x-s.width/2,e.position.y-s.height/2),s),h=i.getIntersection(l),u=new Rect(new Position2D(Math.max(0,h.pos.x-l.pos.x),Math.max(0,h.pos.y-l.pos.y)),h.size),p=function(e,t,i){if(0==e)return t;var n=t.pos.y,o=i.width-t.pos.x-t.size.width,r=new Rect(new Position2D(n,o),t.size.getRotated(90));return 90==e?r:p(e-90,r,i.getRotated(90))},c=p(e.rotation,u,s),d=t.size.scale(e.scale),v=r.drawCanvas.getContext("2d"),g=r.markCanvas.getContext("2d");v.save(),g.save(),v.translate(Math.floor((-i.pos.x+e.position.x)*n),Math.floor((-i.pos.y+e.position.y)*n)),v.rotate(e.rotation*Math.PI/180),v.translate(Math.floor((-d.width/2+c.pos.x)*n),Math.floor((-d.height/2+c.pos.y)*n)),g.translate(Math.floor((-i.pos.x+e.position.x)*n),Math.floor(-i.pos.y+e.position.y)*n),g.rotate(e.rotation*Math.PI/180),g.translate((Math.floor(-d.width/2)+c.pos.x)*n,Math.floor(-d.height/2+c.pos.y)*n);var f=c.scale(1/e.scale);f=new Rect(f.pos.roundDown(),f.size.roundDown()),a||t.draw(v,f,n*e.scale,o),g.translate(-f.pos.x*n*e.scale,-f.pos.y*n*e.scale),o||(g.scale(n*e.scale,n*e.scale),this.getCanvasPageLayersOrdered().forEach(function(e){e.draw(g,t.id,t.size,r.drawHTML)}),g.scale(1/n*e.scale,1/n*e.scale)),v.restore(),g.restore()},e.prototype.updateAnimations=function(){var t=this;if(this._viewport.updateAnimation(),0!=this._animations.length){null==this._lastAnimationTime&&(this._lastAnimationTime=(new Date).valueOf());for(var e=(new Date).valueOf()-this._lastAnimationTime,i=[],n=0,o=this._animations;n<o.length;n++){var r=o[n];r.updateAnimation(e)&&i.push(r)}i.forEach(function(e){t.removeAnimation(e)}),0!=this._animations.length?setTimeout(function(){t.update()},0):this._lastAnimationTime=null}else this._lastAnimationTime=null},e.prototype.addAnimation=function(e){this._animations.push(e)},e.prototype.removeAnimation=function(e){var t=this._animations.indexOf(e);0<=t&&this._animations.splice(t,1)},Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"views",{get:function(){return this._views},enumerable:!0,configurable:!0}),e.prototype.addPage=function(e,t){var i=this;e.refreshCallback=function(){i.update()},this._pageArea.addPage(e,t)},e.prototype.removePage=function(e){e.refreshCallback=function(){},e.clear(),this._pageArea.removePage(e)},e.prototype.getPages=function(){return this._pageArea.getPages()},e.prototype.setPageAreaInformation=function(e,t){this._pageArea.setPageAreaInformation(e,t)},e.prototype.getPageAreaInformation=function(e){return this._pageArea.getPageInformation(e)},e.prototype.addCanvasPageLayer=function(e,t){this._canvasPageLayers.set(e,t)},e.prototype.getCanvasPageLayers=function(){return this._canvasPageLayers},e.prototype.getCanvasPageLayersOrdered=function(){var t=this;if(null==this._canvasPageLayers||this._canvasPageLayers.isEmpty())return[];var i=[];return this._canvasPageLayers.keys.sort().forEach(function(e){i.push(t._canvasPageLayers.get(e))}),i},e.prototype.getPageArea=function(){return this._pageArea},Object.defineProperty(e.prototype,"textRenderer",{get:function(){return this._textRenderer},set:function(e){this._textRenderer=e},enumerable:!0,configurable:!0}),e}(),n.PageController=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.events||(i.events={}),o=function(){function e(){this._callBackArray=new Array}return e.prototype.bind=function(e){this._callBackArray.push(e)},e.prototype.trigger=function(e){for(var t in this._callBackArray)(0,this._callBackArray[t])(e)},e.prototype.unbind=function(e){var t=this._callBackArray.lastIndexOf(e);this._callBackArray.splice(t,1)},e}(),n.ViewerEventManager=o}(mycore||(mycore={})),function(e){var t,i;t=e.viewer||(e.viewer={}),(i=t.widgets||(t.widgets={})).toolbar||(i.toolbar={})}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.toolbar||(i.toolbar={}),o=function(){function e(e){this._properties=new MyCoReMap,this.addProperty(new ViewerProperty(this,"id",e))}return Object.defineProperty(e.prototype,"id",{get:function(){return this.getProperty("id").value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"PropertyNames",{get:function(){return this._properties.keys},enumerable:!0,configurable:!0}),e.prototype.addProperty=function(e){this._properties.set(e.name,e)},e.prototype.getProperty=function(e){return this._properties.get(e)},e.prototype.hasProperty=function(e){return this._properties.has(e)},e}(),n.ToolbarComponent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.toolbar||(i.toolbar={}),o=function(){function e(e,t,i){void 0===i&&(i=!1),this._name=e,this._order=t,this._right=i,this._idComponentMap=new MyCoReMap,this._observerArray=new Array}return e.prototype.getComponentById=function(e){return this._idComponentMap.get(e)},e.prototype.addComponent=function(e){var t=e.getProperty("id").value;if(this._idComponentMap.has(t))throw new Error(t+" already exist in "+this.name);this._idComponentMap.set(t,e),this.notifyObserverChildAdded(this,e)},e.prototype.removeComponent=function(e){var t=e.getProperty("id").value;if(!this._idComponentMap.has(t))throw new Error(t+" doesnt exist in "+this.name);this._idComponentMap.remove(t),this.notifyObserverChildRemoved(this,e)},e.prototype.getComponentIDs=function(){return this._idComponentMap.keys},e.prototype.getComponents=function(){return this._idComponentMap.values},e.prototype.addObserver=function(e){this._observerArray.push(e)},e.prototype.removeObserver=function(e){var t=this._observerArray.indexOf(e);this._observerArray.splice(t,1)},Object.defineProperty(e.prototype,"observer",{get:function(){return this._observerArray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._right?"right":"left"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"order",{get:function(){return this._order},set:function(e){this._order=e},enumerable:!0,configurable:!0}),e.prototype.notifyObserverChildAdded=function(t,i){this._observerArray.forEach(function(e){e.childAdded(t,i)})},e.prototype.notifyObserverChildRemoved=function(t,i){this._observerArray.forEach(function(e){e.childRemoved(t,i)})},e}(),n.ToolbarGroup=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.toolbar||(i.toolbar={}),o=function(i){function e(e){var t=i.call(this,e,0)||this;return t._children=new MyCoReMap,t._groupObserverArray=new Array,t}return __extends(e,i),e.prototype.addGroup=function(e){if(this._children.has(e.name))throw new Error("Group : "+e.name+" already exists in "+this.name);this._children.set(e.name,e),e.addObserver(this),this.notifyGroupAdded(this,e)},e.prototype.removeGroup=function(e){if(!this._children.has(e.name))throw new Error("Group : "+e.name+" doesnt exists in "+this.name);this._children.remove(e.name),e.removeObserver(this),this.notifyGroupRemoved(this,e)},e.prototype.getGroup=function(e){return this._children.get(e)},e.prototype.getGroupIDs=function(){return this._children.keys},e.prototype.getGroups=function(){return this._children.values},e.prototype.childAdded=function(e,t){this.notifyObserverChildAdded(e,t)},e.prototype.childRemoved=function(e,t){this.notifyObserverChildRemoved(e,t)},e.prototype.addGroupObserver=function(e){this._groupObserverArray.push(e)},e.prototype.removeGroupObserver=function(e){var t=this._groupObserverArray.indexOf(e);this._groupObserverArray.splice(t,1)},e.prototype.notifyGroupAdded=function(t,i){this._groupObserverArray.forEach(function(e){e.childAdded(t,i)})},e.prototype.notifyGroupRemoved=function(t,i){this._groupObserverArray.forEach(function(e){e.childRemoved(t,i)})},e.prototype.addComponent=function(e){throw"Not added jet"},e.prototype.removeComponent=function(e){throw"Not added jet"},e}(i.toolbar.ToolbarGroup),n.ToolbarModel=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.toolbar||(i.toolbar={}),o=function(l){function e(e,t,i,n,o,r,a){void 0===i&&(i=t),void 0===n&&(n=null),void 0===o&&(o="default"),void 0===r&&(r=!1),void 0===a&&(a=!1);var s=l.call(this,e)||this;return s.addProperty(new ViewerProperty(s,"label",t)),s.addProperty(new ViewerProperty(s,"tooltip",i)),s.addProperty(new ViewerProperty(s,"icon",n)),s.addProperty(new ViewerProperty(s,"buttonClass",o)),s.addProperty(new ViewerProperty(s,"disabled",!1)),s.addProperty(new ViewerProperty(s,"active",!1)),s}return __extends(e,l),Object.defineProperty(e.prototype,"label",{get:function(){return this.getProperty("label").value},set:function(e){this.getProperty("label").value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tooltip",{get:function(){return this.getProperty("tooltip").value},set:function(e){this.getProperty("tooltip").value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){return this.getProperty("icon").value},set:function(e){this.getProperty("icon").value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buttonClass",{get:function(){return this.getProperty("buttonClass").value},set:function(e){this.getProperty("buttonClass").value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disabled",{get:function(){return this.getProperty("disabled").value},set:function(e){this.getProperty("disabled").value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"active",{get:function(){return this.getProperty("active").value},set:function(e){this.getProperty("active").value=e},enumerable:!0,configurable:!0}),e}(n.ToolbarComponent),n.ToolbarButton=o}(mycore||(mycore={})),function(e){var t,i,n,o,r;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.toolbar||(i.toolbar={}),o=n.events||(n.events={}),r=function(n){function o(e,t){void 0===t&&(t=o.TYPE);var i=n.call(this,t)||this;return i._button=e,i}return __extends(o,n),Object.defineProperty(o.prototype,"button",{get:function(){return this._button},enumerable:!0,configurable:!0}),o.TYPE="ButtonPressedEvent",o}(e.viewer.widgets.events.DefaultViewerEvent),o.ButtonPressedEvent=r}(mycore||(mycore={})),function(n){var e,t,g,i;e=n.viewer||(n.viewer={}),t=e.widgets||(e.widgets={}),g=t.toolbar||(t.toolbar={}),i=function(){function e(e,t,i){this._groupMap=e,this._buttonViewMap=t,this._mobile=i,this._eventManager=new n.viewer.widgets.events.ViewerEventManager}return Object.defineProperty(e.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),e.prototype.childAdded=function(e,t){var i=e,n=this._groupMap.get(i.name),o=t.getProperty("id").value,r=t,a=r.getProperty("label"),s=r.getProperty("icon"),l=t.getProperty("tooltip"),h=r.getProperty("buttonClass"),u=r.getProperty("active"),p=r.getProperty("disabled");a.addObserver(this),s.addObserver(this),l.addObserver(this),h.addObserver(this),u.addObserver(this),p.addObserver(this);var c=this.createButtonView(r);c.updateButtonTooltip(l.value),c.updateButtonLabel(a.value),c.updateButtonClass(h.value),c.updateButtonActive(u.value),c.updateButtonDisabled(p.value);var d=this;c.getElement().bind("click",function(e){d._eventManager.trigger(new g.events.ButtonPressedEvent(r))});var v=s.value;null!=v&&c.updateButtonIcon(v),n.addChild(c.getElement()),this._buttonViewMap.set(o,c)},e.prototype.childRemoved=function(e,t){var i=t.getProperty("id").value;this._buttonViewMap.get(i).getElement().remove(),t.getProperty("label").removeObserver(this),t.getProperty("icon").removeObserver(this),t.getProperty("tooltip").removeObserver(this),t.getProperty("buttonClass").removeObserver(this),t.getProperty("active").removeObserver(this),t.getProperty("disabled").removeObserver(this)},e.prototype.createButtonView=function(e){return g.ToolbarViewFactoryImpl.createButtonView(e.id)},e.prototype.propertyChanged=function(e,t){var i=t.from.getProperty("id").value;"label"!=e.name||"label"!=t.name?"icon"!=e.name||"icon"!=t.name?"tooltip"!=e.name||"tooltip"!=t.name?"buttonClass"!=e.name||"buttonClass"!=t.name?"active"!=e.name||"active"!=t.name?"disabled"!=e.name||"disabled"!=t.name||this._buttonViewMap.get(i).updateButtonDisabled(t.value):this._buttonViewMap.get(i).updateButtonActive(t.value):this._buttonViewMap.get(i).updateButtonClass(t.value):this._buttonViewMap.get(i).updateButtonTooltip(t.value):this._buttonViewMap.get(i).updateButtonIcon(t.value):this._buttonViewMap.get(i).updateButtonLabel(t.value)},e}(),g.ButtonController=i}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.toolbar||(i.toolbar={}),o=function(h){function e(e,t,i,n,o,r,a,s){void 0===n&&(n=null),void 0===o&&(o=!1),void 0===r&&(r="default"),void 0===a&&(a=!1),void 0===s&&(s=!1);var l=h.call(this,e,t,null,n,r,a,s)||this;return l.addProperty(new ViewerProperty(l,"children",i)),l.addProperty(new ViewerProperty(l,"largeContent",o)),l}return __extends(e,h),Object.defineProperty(e.prototype,"children",{get:function(){return this.getProperty("children").value},set:function(e){this.getProperty("children").value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"largeContent",{get:function(){return this.getProperty("largeContent").value},set:function(e){this.getProperty("largeContent").value=e},enumerable:!0,configurable:!0}),e}(n.ToolbarButton),n.ToolbarDropdownButton=o}(mycore||(mycore={})),function(e){var t,i,n,o,r;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.toolbar||(i.toolbar={}),o=n.events||(n.events={}),r=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i._childId=t,i}return __extends(o,n),Object.defineProperty(o.prototype,"childId",{get:function(){return this._childId},enumerable:!0,configurable:!0}),o.TYPE="DropdownButtonPressedEvent",o}(o.ButtonPressedEvent),o.DropdownButtonPressedEvent=r}(mycore||(mycore={})),function(e){var t,i,a,n;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),a=i.toolbar||(i.toolbar={}),n=function(r){function e(e,t,i){void 0===i&&(i=!1);var n=r.call(this,e,t,i)||this;return n._dropdownButtonViewMap=t,n.__mobile=i,n}return __extends(e,r),e.prototype.childAdded=function(e,t){r.prototype.childAdded.call(this,e,t);var i=t,n=t.getProperty("id").value,o=i.getProperty("children");o.addObserver(this),this._dropdownButtonViewMap.get(n).updateChilds(o.value),this.updateChildEvents(i,o.value)},e.prototype.updateChildEvents=function(n,e){var t=this._dropdownButtonViewMap.get(n.id),o=this;if(n.largeContent||this.__mobile)t.getElement().bind("change",function(e){var t=jQuery(e.target),i=t.find(":selected");o.__mobile&&t.val([]),o.eventManager.trigger(new a.events.DropdownButtonPressedEvent(n,i.attr("data-id")))});else{var i=e;for(var r in i)t.getChildElement(i[r].id).bind("click",function(e){return function(){o.eventManager.trigger(new a.events.DropdownButtonPressedEvent(n,e.id))}}(i[r]))}},e.prototype.childRemoved=function(e,t){r.prototype.childRemoved.call(this,e,t)},e.prototype.propertyChanged=function(e,t){"children"==t.name?(this._dropdownButtonViewMap.get(t.from.getProperty("id").value).updateChilds(t.value),this.updateChildEvents(t.from,t.value)):r.prototype.propertyChanged.call(this,e,t)},e.prototype.createButtonView=function(e){return!this.__mobile&&e.largeContent?a.ToolbarViewFactoryImpl.createLargeDropdownView(e.id):a.ToolbarViewFactoryImpl.createDropdownView(e.id)},e}(a.ButtonController),a.DropdownButtonController=n}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.toolbar||(i.toolbar={}),o=function(n){function e(e,t){var i=n.call(this,e)||this;return i.addProperty(new ViewerProperty(i,"href",t)),i}return __extends(e,n),Object.defineProperty(e.prototype,"href",{get:function(){return this.getProperty("href").value},set:function(e){this.getProperty("href").value=e},enumerable:!0,configurable:!0}),e}(n.ToolbarComponent),n.ToolbarImage=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.toolbar||(i.toolbar={}),o=function(){function e(e,t){this._groupMap=e,this._textViewMap=t}return e.prototype.childAdded=function(e,t){var i=e,n=this._groupMap.get(i.name),o=t.getProperty("id").value,r=t,a=this.createImageView(o),s=r.getProperty("href");s.addObserver(this),a.updateHref(s.value),n.addChild(a.getElement()),this._textViewMap.set(o,a)},e.prototype.childRemoved=function(e,t){var i=t.getProperty("id").value;this._textViewMap.get(i).getElement().remove(),t.getProperty("href").removeObserver(this)},e.prototype.propertyChanged=function(e,t){var i=t.from.getProperty("id").value;"href"==e.name&&"href"==t.name&&this._textViewMap.get(i).updateHref(t.value)},e.prototype.createImageView=function(e){return n.ToolbarViewFactoryImpl.createImageView(e)},e}(),n.ImageController=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.toolbar||(i.toolbar={}),o=function(n){function e(e,t){var i=n.call(this,e)||this;return i.addProperty(new ViewerProperty(i,"text",t)),i}return __extends(e,n),Object.defineProperty(e.prototype,"text",{get:function(){return this.getProperty("text").value},set:function(e){this.getProperty("text").value=e},enumerable:!0,configurable:!0}),e}(n.ToolbarComponent),n.ToolbarText=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.toolbar||(i.toolbar={}),o=function(){function e(e,t,i){this._groupMap=e,this._textViewMap=t,this._mobile=i}return e.prototype.childAdded=function(e,t){var i=e,n=this._groupMap.get(i.name),o=t.getProperty("id").value,r=t,a=this.createTextView(o),s=r.getProperty("text");s.addObserver(this),a.updateText(s.value),n.addChild(a.getElement()),this._textViewMap.set(o,a)},e.prototype.childRemoved=function(e,t){var i=t.getProperty("id").value;this._textViewMap.get(i).getElement().remove(),t.getProperty("text").removeObserver(this)},e.prototype.propertyChanged=function(e,t){var i=t.from.getProperty("id").value;"text"==e.name&&"text"==t.name&&this._textViewMap.get(i).updateText(t.value)},e.prototype.createTextView=function(e){return n.ToolbarViewFactoryImpl.createTextView(e)},e}(),n.TextController=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.toolbar||(i.toolbar={}),o=function(o){function e(e,t,i){var n=o.call(this,e)||this;return n.addProperty(new ViewerProperty(n,"value",t)),n.addProperty(new ViewerProperty(n,"placeHolder",i)),n}return __extends(e,o),Object.defineProperty(e.prototype,"value",{get:function(){return this.getProperty("value").value},set:function(e){this.getProperty("value").value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"placeHolder",{get:function(){return this.getProperty("placeHolder").value},set:function(e){this.getProperty("placeHolder").value=e},enumerable:!0,configurable:!0}),e}(n.ToolbarComponent),n.ToolbarTextInput=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.toolbar||(i.toolbar={}),o=function(){function e(e,t){this._groupMap=e,this._textInputViewMap=t}return e.prototype.childAdded=function(e,t){var i=e,n=this._groupMap.get(i.name),o=t.getProperty("id").value,r=t,a=this.createTextInputView(o),s=r.getProperty("value");s.addObserver(this),a.updateValue(s.value);var l=r.getProperty("placeHolder");l.addObserver(this),a.updatePlaceholder(l.value),n.addChild(a.getElement()),a.onChange=function(){a.getValue()!=s.value&&(s.value=a.getValue())},this._textInputViewMap.set(o,a)},e.prototype.childRemoved=function(e,t){var i=t.getProperty("id").value;this._textInputViewMap.get(i).getElement().remove(),t.getProperty("value").removeObserver(this),t.getProperty("placeHolder").removeObserver(this)},e.prototype.propertyChanged=function(e,t){var i=t.from.getProperty("id").value,n=this._textInputViewMap.get(i);"value"==e.name&&"value"==t.name&&n.getValue()!=t.value&&n.updateValue(t.value),"placeHolder"==e.name&&"placeHolder"==t.name&&n.getValue()!=t.value&&n.updatePlaceholder(t.value)},e.prototype.createTextInputView=function(e){return n.ToolbarViewFactoryImpl.createTextInputView(e)},e}(),n.TextInputController=o}(mycore||(mycore={})),function(o){var e,t,r,i;e=o.viewer||(o.viewer={}),t=e.widgets||(e.widgets={}),r=t.toolbar||(t.toolbar={}),i=function(){function e(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=new r.ToolbarModel("default")),this._container=e,this._mobile=t,this._model=i,this._idViewMap=new MyCoReMap,this._idGroupViewMap=new MyCoReMap,this._eventManager=new o.viewer.widgets.events.ViewerEventManager,this._model.addGroupObserver(this),this._model.addObserver(this),this._buttonController=new r.ButtonController(this._idGroupViewMap,this._idViewMap,t),this._dropdownController=new r.DropdownButtonController(this._idGroupViewMap,this._idViewMap,t),this._textController=new r.TextController(this._idGroupViewMap,this._idViewMap,t),this._imageController=new r.ImageController(this._idGroupViewMap,this._idViewMap),this._textInputController=new r.TextInputController(this._idGroupViewMap,this._idViewMap);var n=this;this._buttonController.eventManager.bind(function(e){n.eventManager.trigger(e)}),this._dropdownController.eventManager.bind(function(e){n.eventManager.trigger(e)}),this._createView()}return Object.defineProperty(e.prototype,"model",{get:function(){return this._model},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),e.prototype._createView=function(){this._toolbarView=this.createToolbarView(),this._toolbarElement=this._toolbarView.getElement(),this._toolbarElement.appendTo(this._container);var e=this._model.getGroups();for(var t in e){var i=e[t];this.childAdded(this._model,i)}this._mobile&&this._toolbarView.getElement().trigger("create")},e.prototype.childAdded=function(e,t){if(e instanceof r.ToolbarModel){var i=t,n=this.createGroupView(i.name,i.order,i.align);this._idGroupViewMap.set(i.name,n),this._toolbarView.addChild(n.getElement()),i.getComponents().forEach(function(e){i.notifyObserverChildAdded(i,e)})}else if(e instanceof r.ToolbarGroup){if(t instanceof r.ToolbarDropdownButton)return void this._dropdownController.childAdded(e,t);if(t instanceof r.ToolbarButton)return void this._buttonController.childAdded(e,t);if(t instanceof r.ToolbarText)return void this._textController.childAdded(e,t);if(t instanceof r.ToolbarTextInput)return void this._textInputController.childAdded(e,t);if(t instanceof r.ToolbarImage){if(this._mobile)throw new ViewerError("Mobile Toolbar doesnt support Image!");return void this._imageController.childAdded(e,t)}}},e.prototype.createToolbarView=function(){return r.ToolbarViewFactoryImpl.createToolbarView()},e.prototype.createGroupView=function(e,t,i){return r.ToolbarViewFactoryImpl.createGroupView(e,t,i)},e.prototype.childRemoved=function(e,t){t instanceof r.ToolbarDropdownButton?this._dropdownController.childRemoved(e,t):t instanceof r.ToolbarButton?this._buttonController.childRemoved(e,t):t instanceof r.ToolbarText?this._textController.childRemoved(e,t):t instanceof r.ToolbarImage?this._imageController.childRemoved(e,t):t instanceof r.ToolbarTextInput?this._textInputController.childRemoved(e,t):t instanceof r.ToolbarGroup&&this._idGroupViewMap.get(t.name).getElement().remove()},e.prototype.getView=function(e){if(e instanceof r.ToolbarComponent)var t=e.getProperty("id").value;else{if("string"!=typeof e)return this._toolbarView;t=e}return this._idViewMap.get(t)},e}(),r.IviewToolbar=i}(mycore||(mycore={})),function(e){var t,i,n;t=e.viewer||(e.viewer={}),i=t.model||(t.model={}),n=function(){function e(e){this._keyTranslationMap=e}return e.prototype.getTranslation=function(e){return this._keyTranslationMap.has(e)?this._keyTranslationMap.get(e):"???"+e+"???"},e.prototype.getFormatedTranslation=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return this._keyTranslationMap.has(e)?ViewerFormatString(this._keyTranslationMap.get(e),t):"???"+e+"??? "+t.join(" ")},e.prototype.hasTranslation=function(e){return this._keyTranslationMap.has(e)},e.prototype.translate=function(e){var i=this;e.find("[data-i18n]").each(function(){var e=$(this),t=e.data("i18n");i.hasTranslation(t)&&e.html(i.getTranslation(t))})},e}(),i.LanguageModel=n}(mycore||(mycore={})),function(e){var t,i,n;t=e.viewer||(e.viewer={}),i=t.model||(t.model={}),n=function(i){function e(e){var t=i.call(this,e)||this;return t._dropdownChildren=new Array,t.initComponents(),t.addComponents(),t}return __extends(e,i),e.prototype.initComponents=function(){this._sidebarControllGroup=new t.widgets.toolbar.ToolbarGroup("SidebarControllGroup",10),this._sidebarControllDropdownButton=new t.widgets.toolbar.ToolbarDropdownButton("SidebarControllDropdownButton","",[],"bars"),this._imageOverviewDropdownChild={id:"imageOverview",label:"Bildbersicht"},this._chapterOverviewDropdownChild={id:"chapterOverview",label:"Strukturbersicht"},this._dropdownChildren.push(this._imageOverviewDropdownChild),this._dropdownChildren.push(this._chapterOverviewDropdownChild),this._sidebarControllDropdownButton.children=this._dropdownChildren,this._sidebarControllGroup.addComponent(this._sidebarControllDropdownButton),this._imageChangeControllGroup=new t.widgets.toolbar.ToolbarGroup("ImageChangeControllGroup",45),this._previousImageButton=new t.widgets.toolbar.ToolbarButton("PreviousImageButton","","previous-image","arrow-left"),this._pageSelect=new t.widgets.toolbar.ToolbarDropdownButton("PageSelect","",[],null,!0),this._pageSelectChildren=new Array,this._pageSelect.children=this._pageSelectChildren,this._nextImageButton=new t.widgets.toolbar.ToolbarButton("NextImageButton","","next-image","arrow-right"),this._imageChangeControllGroup.addComponent(this._previousImageButton),this._imageChangeControllGroup.addComponent(this._pageSelect),this._imageChangeControllGroup.addComponent(this._nextImageButton),this._zoomControllGroup=new t.widgets.toolbar.ToolbarGroup("ZoomControllGroup",20),this._zoomInButton=new t.widgets.toolbar.ToolbarButton("ZoomInButton","","zoom-in","search-plus"),this._zoomOutButton=new t.widgets.toolbar.ToolbarButton("ZoomOutButton","","zoom-out","search-minus"),this._zoomWidthButton=new t.widgets.toolbar.ToolbarButton("ZoomWidthButton","","zoom-width","arrows-alt-h"),this._zoomFitButton=new t.widgets.toolbar.ToolbarButton("ZoomFitButton","","zoom-fit-in","expand-arrows-alt"),this._rotateButton=new t.widgets.toolbar.ToolbarButton("RotateButton","","Rotate","redo"),this._zoomControllGroup.addComponent(this._zoomInButton),this._zoomControllGroup.addComponent(this._zoomOutButton),this._zoomControllGroup.addComponent(this._zoomWidthButton),this._zoomControllGroup.addComponent(this._zoomFitButton),this._zoomControllGroup.addComponent(this._rotateButton),this._layoutControllGroup=new t.widgets.toolbar.ToolbarGroup("LayoutControllGroup",30),this._layoutDropdownButtonChilds=[],this._layoutDropdownButton=new t.widgets.toolbar.ToolbarDropdownButton("LayoutDropdownButton","",this._layoutDropdownButtonChilds,"book",!1),this._layoutControllGroup.addComponent(this._layoutDropdownButton),this._actionControllGroup=new t.widgets.toolbar.ToolbarGroup("ActionControllGroup",60),this._shareButton=new t.widgets.toolbar.ToolbarButton("ShareButton","","share","share"),this._actionControllGroup.addComponent(this._shareButton),this._searchGroup=new t.widgets.toolbar.ToolbarGroup("SearchGroup",80,!0),this._closeViewerGroup=new t.widgets.toolbar.ToolbarGroup("CloseViewerGroup",100,!0),this._closeViewerButton=new t.widgets.toolbar.ToolbarButton("CloseViewerButton","","close-viewer","power-off"),this._closeViewerGroup.addComponent(this._closeViewerButton)},e.prototype.addComponents=function(){},e.prototype.i18n=function(e){this._previousImageButton.tooltip=e.getTranslation("toolbar.backward"),this._nextImageButton.tooltip=e.getTranslation("toolbar.forward"),this._zoomInButton.tooltip=e.getTranslation("toolbar.zoomIn"),this._zoomOutButton.tooltip=e.getTranslation("toolbar.zoomOut"),this._zoomWidthButton.tooltip=e.getTranslation("toolbar.toWidth"),this._zoomFitButton.tooltip=e.getTranslation("toolbar.toScreen"),this._shareButton.tooltip=e.getTranslation("toolbar.permalink"),this._closeViewerButton.tooltip=e.getTranslation("toolbar.normalView"),this._rotateButton.tooltip=e.getTranslation("toolbar.rotate"),this._imageOverviewDropdownChild.label=e.getTranslation("toolbar.openThumbnailPanel"),this._chapterOverviewDropdownChild.label=e.getTranslation("toolbar.openChapter"),this._sidebarControllDropdownButton.children=this._sidebarControllDropdownButton.children},e}(t.widgets.toolbar.ToolbarModel),i.MyCoReBasicToolbarModel=n}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i.eventType=t,i}return __extends(o,n),o.TYPE="WaitForEvent",o}(n.MyCoReImageViewerEvent),n.WaitForEvent=o}(mycore||(mycore={})),function(e){var t,n,i;t=e.viewer||(e.viewer={}),n=t.components||(t.components={}),i=function(t){function e(){var e=t.call(this)||this;return e._eventCache=new MyCoReMap,e}return __extends(e,t),e.prototype.init=function(){console.info("Warning: IviewComponent doesnt implements init "+this)},Object.defineProperty(e.prototype,"handlesEvents",{get:function(){return[]},enumerable:!0,configurable:!0}),e.prototype._handle=function(e){if(e instanceof n.events.WaitForEvent){var t=e;if(this._eventCache.has(t.eventType)){var i=this._eventCache.get(t.eventType);t.component.handle(i)}}this.handle(e)},e.prototype.handle=function(e){},e.prototype.trigger=function(e){this._eventCache.set(e.type,e),t.prototype.trigger.call(this,e)},e}(e.viewer.widgets.events.ViewerEventManager),n.ViewerComponent=i}(mycore||(mycore={})),function(e){var t,i;t=e.viewer||(e.viewer={}),i=function(){function e(){}return e.normalize=function(e){ViewerParameterMap.fromCurrentUrl();return void 0!==e.filePath&&null!=e.filePath&&"/"==e.filePath.charAt(0)&&(e.filePath=e.filePath.substring(1)),void 0!==e.derivateURL&&null!=e.derivateURL&&"/"!=e.derivateURL.charAt(e.derivateURL.length-1)&&(e.derivateURL+="/"),e.filePath=encodeURI(e.filePath),0<e.filePath.indexOf("_derivate_")&&(e.filePath=e.filePath.replace("/","%2F")),"undefined"!==e.webApplicationBaseURL&&e.webApplicationBaseURL.lastIndexOf("/")===e.webApplicationBaseURL.length-1&&(e.webApplicationBaseURL=e.webApplicationBaseURL.substring(0,e.webApplicationBaseURL.length-1)),e},e}(),t.MyCoReViewerSettings=i}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.layout||(i.layout={}),o=function(){function a(e,t,i){for(var n in this._parent=e,this._horizontalStronger=t,this._containerMap=new MyCoReMap,this._descriptionMap=new MyCoReMap,i){var o=i[n];this._descriptionMap.set(o.direction,o)}for(var n in i)o=i[n],this._initContainer(o);var r=this;window.onresize=function(){r.updateSizes()},this._initCenter()}return a.prototype._initCenter=function(){var e=jQuery("<div></div>");e.addClass(this.getDirectionDescription(a.DIRECTION_CENTER));var t=this._updateCenterCss();this._parent.append(e),e.css(t),this._containerMap.set(a.DIRECTION_CENTER,e)},a.prototype._updateCenterCss=function(){var e={position:"absolute"};return e.left=this.getContainerSize(a.DIRECTION_WEST)+"px",e.top=this.getContainerSize(a.DIRECTION_NORTH)+"px",e.bottom=this.getContainerSize(a.DIRECTION_SOUTH)+"px",e.right=this.getContainerSize(a.DIRECTION_EAST)+"px",e},a.prototype._initContainer=function(e){var t=jQuery("<div></div>");t.addClass(this.getDirectionDescription(e.direction)),void 0===e.resizeable&&(e.resizeable=!1),e.resizeable&&this._initContainerResizeable(t,e),this._correctDescription(e);var i=this._updateCssDescription(e);t.css(i),this._parent.append(t),this._containerMap.set(e.direction,t)},a.prototype._correctDescription=function(e){"minSize"in e&&!isNaN(e.minSize)&&(e.minSize,e.size=Math.max(e.minSize,e.size))},a.prototype._updateCssDescription=function(e){var t={position:"absolute",right:"0px",top:"0px",bottom:"0px",left:"0px"};switch(t.display=0!==e.size?"block":"none",e.direction){case a.DIRECTION_EAST:delete t.left;break;case a.DIRECTION_WEST:delete t.right;break;case a.DIRECTION_SOUTH:delete t.top;break;case a.DIRECTION_NORTH:delete t.bottom}return e.direction==a.DIRECTION_NORTH||e.direction==a.DIRECTION_SOUTH?(this.hasContainer(a.DIRECTION_WEST)&&this.horizontalStronger&&(t.left=this.getContainerSizeDescription(a.DIRECTION_WEST)+"px"),this.hasContainer(a.DIRECTION_EAST)&&this.horizontalStronger&&(t.right=this.getContainerSizeDescription(a.DIRECTION_EAST)+"px"),t.height=e.size+"px"):(this.hasContainer(a.DIRECTION_NORTH)&&!this.horizontalStronger&&(t.top=this.getContainerSizeDescription(a.DIRECTION_NORTH)+"px"),this.hasContainer(a.DIRECTION_SOUTH)&&!this.horizontalStronger&&(t.bottom=this.getContainerSizeDescription(a.DIRECTION_SOUTH)+"px"),t.width=e.size+"px"),t},a.prototype.updateSizes=function(){var e=this._descriptionMap.values;for(var t in e){var i=e[t],n=this._containerMap.get(i.direction);this._correctDescription(i),n.css(this._updateCssDescription(i)),n.delay(10).children().trigger("iviewResize")}(n=this._containerMap.get(a.DIRECTION_CENTER)).css(this._updateCenterCss()),n.delay(10).children().trigger("iviewResize")},a.prototype._initContainerResizeable=function(e,o){var t=jQuery("<span></span>");t.addClass("resizer");var r=this;t.bind("mousedown",function(e){var i=new Position2D(e.clientX,e.clientY),n=o.size;e.preventDefault(),jQuery(r._parent).bind("mousemove",function(e){var t=new Position2D(e.clientX,e.clientY);o.size=r._getNewSize(i,t,n,o.direction),e.preventDefault(),r.updateSizes()}),jQuery(r._parent).bind("mouseup",function(e){new Position2D(e.clientX,e.clientY),r._parent.unbind("mousemove"),r._parent.unbind("mouseup")})});var i={position:"absolute"};o.direction!=a.DIRECTION_NORTH&&a.DIRECTION_SOUTH!=o.direction||(i.cursor="row-resize",i.left="0px",i.height="6px",i.right="0px",o.direction==a.DIRECTION_NORTH?i.bottom="-3px":i.top="-3px"),o.direction!=a.DIRECTION_WEST&&a.DIRECTION_EAST!=o.direction||(i.cursor="col-resize",i.top="0px",i.bottom="0px",i.width="6px",o.direction==a.DIRECTION_WEST?i.right="-3px":i.left="-3px"),t.css(i),t.appendTo(e)},a.prototype._getNewSize=function(e,t,i,n){var o;if(n==a.DIRECTION_EAST||n==a.DIRECTION_WEST){var r=e.x-t.x;o=n==a.DIRECTION_EAST?i+r:i-r}return n!=a.DIRECTION_NORTH&&n!=a.DIRECTION_SOUTH||(r=e.y-t.y,o=n==a.DIRECTION_SOUTH?i+r:i-r),o},a.prototype.hasContainer=function(e){return this._descriptionMap.has(e)||this._containerMap.has(e)},a.prototype.getContainer=function(e){return this._containerMap.has(e)?this._containerMap.get(e):null},Object.defineProperty(a.prototype,"horizontalStronger",{get:function(){return this._horizontalStronger},enumerable:!0,configurable:!0}),a.prototype.getContainerSizeDescription=function(e){return this._descriptionMap.get(e).size},a.prototype.getContainerDescription=function(e){return this._descriptionMap.get(e)},a.prototype.getContainerSize=function(e){if(this.hasContainer(e)){var t=this.getContainer(e);return e==a.DIRECTION_EAST||e==a.DIRECTION_WEST?t.width():e==a.DIRECTION_NORTH||e==a.DIRECTION_SOUTH?t.height():t.width()}return 0},a.prototype.getDirectionDescription=function(e){return["center","east","south","west","north"][e]},a.DIRECTION_CENTER=0,a.DIRECTION_EAST=1,a.DIRECTION_SOUTH=2,a.DIRECTION_WEST=3,a.DIRECTION_NORTH=4,a}(),n.IviewBorderLayout=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(t){function i(e){return t.call(this,e,i.TYPE)||this}return __extends(i,t),i.TYPE="ComponentInitializedEvent",i}(n.MyCoReImageViewerEvent),n.ComponentInitializedEvent=o}(mycore||(mycore={})),function(e){var t,i;t=e.viewer||(e.viewer={}),i=function(e,t,i,n,o,r,a,s,l,h,u){void 0===s&&(s=new MyCoReMap),this.type=e,this.id=t,this.order=i,this.orderLabel=n,this.href=o,this.mimetype=r,this.requestImgdataUrl=a,this.additionalHrefs=s,this.width=h,this.height=u,this.uniqueIdentifier=void 0===l||null==l||""==l?null:l},(t.model||(t.model={})).StructureImage=i}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i._image=t,i}return __extends(o,n),Object.defineProperty(o.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),o.TYPE="ImageChangedEvent",o}(n.MyCoReImageViewerEvent),n.ImageChangedEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i._image=t,i}return __extends(o,n),Object.defineProperty(o.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),o.TYPE="ImageSelectedEvent",o}(n.MyCoReImageViewerEvent),n.ImageSelectedEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(a){function s(e,t,i,n,o){void 0===n&&(n=300),void 0===o&&(o=null);var r=a.call(this,e,s.TYPE)||this;return r.content=t,r.containerDirection=i,r.size=n,r.text=o,r}return __extends(s,a),s.DIRECTION_CENTER=0,s.DIRECTION_EAST=1,s.DIRECTION_SOUTH=2,s.DIRECTION_WEST=3,s.DIRECTION_NORTH=4,s.TYPE="ShowContentEvent",s}(n.MyCoReImageViewerEvent),n.ShowContentEvent=o}(mycore||(mycore={})),function(h){var i,u,e;i=h.viewer||(h.viewer={}),u=i.components||(i.components={}),e=function(o){function l(e,t,i){void 0===i&&(i=jQuery("<div></div>"));var n=o.call(this)||this;return n._settings=e,n._container=t,n._contentContainer=i,n._lastSizeMap=new MyCoReMap,n}return __extends(l,o),l.prototype.init=function(){var e=this;this._container.append(this._contentContainer),this._container.css({overflow:"hidden"}),jQuery(this._contentContainer).css({left:"0px",bottom:"0px",right:"0px",position:"absolute"});var t=[];this._settings.mobile||(t=[{direction:l.SIDEBAR_DIRECTION,resizeable:!0,size:0,minSize:0},{direction:l.INFORMATION_BAR_DIRECTION,resizeable:!1,size:30},{direction:h.viewer.widgets.layout.IviewBorderLayout.DIRECTION_EAST,resizeable:!0,size:0}]),this._layout=new h.viewer.widgets.layout.IviewBorderLayout(this._contentContainer,!1,t),this._content=this._layout.getContainer(l.CONTENT_DIRECTION),this._settings.mobile||(this._sidebar=this._layout.getContainer(l.SIDEBAR_DIRECTION),this._informationBar=this._layout.getContainer(l.INFORMATION_BAR_DIRECTION),this._sidebar.addClass("card sidebar"),this._informationBar=this._layout.getContainer(l.INFORMATION_BAR_DIRECTION),this._layout.getContainer(i.widgets.layout.IviewBorderLayout.DIRECTION_EAST).addClass("card sidebar"),this._container.bind("iviewResize",function(){e.correctToToolbarSize()}))},l.prototype.correctToToolbarSize=function(){var e=this._container.parent().find(".navbar.navbar-light"),t=e.outerHeight(!1);e.siblings().css({top:t+"px"})},l.prototype.handle=function(e){var t=this;if(e.type,u.events.ComponentInitializedEvent.TYPE,e.type==u.events.ShowContentEvent.TYPE){var i=e,n=this._layout.getContainer(i.containerDirection);if(this._clearOldContent(n),n.append(i.content),null!=i.text&&!this._settings.mobile){var o=jQuery("<div></div>");o.addClass("card-header");var r=jQuery("<button></button>");r.attr("type","button"),r.addClass("close");var a=jQuery('<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>');r.append(a),o.prepend(i.text),o.append(r),n.prepend(o),r.click(function(){i.component=t,i.size=0,t.trigger(i)})}if(i.containerDirection!=l.CONTENT_DIRECTION){var s=this._layout.getContainerDescription(i.containerDirection);-1!=i.size?0==i.size?(n.css({display:"none"}),this._lastSizeMap.set(s.direction,s.size),s.size=0):(n.css({display:"block"}),s.size=i.size):(n.css({display:"block"}),0==s.size&&this._lastSizeMap.has(s.direction)?s.size=this._lastSizeMap.get(s.direction):0<s.size?s.size=s.size:s.size=300),this._layout.updateSizes()}this.correctToToolbarSize()}e.type==h.viewer.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE&&"close"==e.childId&&this._closeSidebar(),e.type==h.viewer.widgets.toolbar.events.ButtonPressedEvent.TYPE&&"CloseViewerButton"==e.button.id&&("function"!=typeof this._settings.onClose||null==this._settings.onClose?1<window.history.length?window.history.back():window.close():this._settings.onClose.apply(window))},l.prototype._closeSidebar=function(){var e=this._layout.getContainerDescription(l.SIDEBAR_DIRECTION);e.size=0,e.minSize=0,this._clearOldContent(this._layout.getContainer(l.SIDEBAR_DIRECTION)),this._layout.updateSizes()},l.prototype._clearOldContent=function(e){e.children().not(".resizer").detach()},Object.defineProperty(l.prototype,"handlesEvents",{get:function(){return[h.viewer.widgets.toolbar.events.ButtonPressedEvent.TYPE,h.viewer.components.events.ShowContentEvent.TYPE,u.events.ImageSelectedEvent.TYPE]},enumerable:!0,configurable:!0}),l.SIDEBAR_DIRECTION=h.viewer.widgets.layout.IviewBorderLayout.DIRECTION_WEST,l.CONTENT_DIRECTION=h.viewer.widgets.layout.IviewBorderLayout.DIRECTION_CENTER,l.INFORMATION_BAR_DIRECTION=h.viewer.widgets.layout.IviewBorderLayout.DIRECTION_SOUTH,l}(u.ViewerComponent),u.MyCoReViewerContainerComponent=e}(mycore||(mycore={})),function(e){var t,i,n;t=e.viewer||(e.viewer={}),i=t.model||(t.model={}),n=function(){function e(e,t,i,n,o,r,a){void 0===o&&(o=new Array),void 0===r&&(r=new MyCoReMap),void 0===a&&(a=function(){return null}),this._parent=e,this._type=t,this._id=i,this._label=n,this._chapter=o,this._additional=r,this._destinationResolver=a}return Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chapter",{get:function(){return this._chapter},set:function(e){this._chapter=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"additional",{get:function(){return this._additional},enumerable:!0,configurable:!0}),e.prototype.resolveDestination=function(e){if(null===this._destinationResolver)return null;this._destinationResolver(e)},e}(),i.StructureChapter=n}(mycore||(mycore={})),function(e){var t,i,n;t=e.viewer||(e.viewer={}),i=t.model||(t.model={}),n=function(){function e(e,t,i,n,o,r){this._rootChapter=e,this._imageList=t,this._chapterToImageMap=i,this._imageToChapterMap=n,this._imageHrefImageMap=o,this._textContentPresent=r}return Object.defineProperty(e.prototype,"rootChapter",{get:function(){return this._rootChapter},set:function(e){this._rootChapter=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageList",{get:function(){return this._imageList},set:function(e){this._imageList=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chapterToImageMap",{get:function(){return this._chapterToImageMap},set:function(e){this._chapterToImageMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageToChapterMap",{get:function(){return this._imageToChapterMap},set:function(e){this._imageToChapterMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHrefImageMap",{get:function(){return this._imageHrefImageMap},set:function(e){this._imageHrefImageMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isTextContentPresent",{get:function(){return this._textContentPresent},set:function(e){this._textContentPresent=e},enumerable:!0,configurable:!0}),e}(),i.StructureModel=n}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i._structureModel=t,i}return __extends(o,n),Object.defineProperty(o.prototype,"structureModel",{get:function(){return this._structureModel},enumerable:!0,configurable:!0}),o.TYPE="StructureModelLoadedEvent",o}(n.MyCoReImageViewerEvent),n.StructureModelLoadedEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(t){function i(e){return t.call(this,e,i.TYPE)||this}return __extends(i,t),i.TYPE="CanvasTapedEvent",i}(n.MyCoReImageViewerEvent),n.CanvasTapedEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i._languageModel=t,i}return __extends(o,n),Object.defineProperty(o.prototype,"languageModel",{get:function(){return this._languageModel},enumerable:!0,configurable:!0}),o.TYPE="LanguageModelLoadedEvent",o}(n.MyCoReImageViewerEvent),n.LanguageModelLoadedEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i.model=t,i}return __extends(o,n),o.TYPE="ProvideToolbarModelEvent",o}(n.MyCoReImageViewerEvent),n.ProvideToolbarModelEvent=o}(mycore||(mycore={})),function(g){var e,f,t;e=g.viewer||(g.viewer={}),f=e.components||(e.components={}),t=function(n){function e(e,t){var i=n.call(this)||this;return i._settings=e,i._container=t,i._sync=Utils.synchronize([function(e){return null!=e._toolbarModel&&null!=e._imageIdMap}],function(e){e.trigger(new f.events.WaitForEvent(i,f.events.ImageChangedEvent.TYPE))}),i._imageIdMap=null,i._toolbarModel=null,i}return __extends(e,n),e.prototype.init=function(){this.trigger(new f.events.WaitForEvent(this,f.events.ProvideToolbarModelEvent.TYPE))},e.prototype.handle=function(e){if(e.type==f.events.ProvideToolbarModelEvent.TYPE){this._toolbarModel=e.model,this._toolbarController=new g.viewer.widgets.toolbar.IviewToolbar(this._container,this._settings.mobile,this._toolbarModel);var t=this;this._toolbarController.eventManager.bind(function(e){t.trigger(e)}),this.trigger(new f.events.WaitForEvent(this,f.events.LanguageModelLoadedEvent.TYPE)),this.trigger(new f.events.WaitForEvent(this,f.events.StructureModelLoadedEvent.TYPE))}if(null!=this._toolbarModel){if(e.type==f.events.LanguageModelLoadedEvent.TYPE){var i=e;this._toolbarModel.i18n(i.languageModel),this._sync(this)}if(e.type==f.events.StructureModelLoadedEvent.TYPE){if(!this._settings.mobile){var n=e.structureModel._imageList,o=this._toolbarModel.getGroup("ImageChangeControllGroup");if(null!=o||void 0!==o){var r=o.getComponentById("PageSelect");this._imageIdMap=new MyCoReMap;for(var a=new Array,s=0,l=n;s<l.length;s++){var h=l[s];this._imageIdMap.set(h.id,h);var u={id:h.id,label:"["+h.order+"]"+(null!=h.orderLabel?" - "+h.orderLabel:"")};a.push(u)}r.children=a}}return void this._sync(this)}if(e.type==g.viewer.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE){var p=e;if("PageSelect"==p.button.id){var c=p.childId,d=this._imageIdMap.get(c);this.trigger(new f.events.ImageSelectedEvent(this,d))}return}if(e.type==f.events.ImageChangedEvent.TYPE){var v=e;return void(null!=v.image&&(this._settings.mobile||this._toolbarController.getView("PageSelect").getElement().val(v.image.id)))}if(e.type==f.events.CanvasTapedEvent.TYPE)return void this._toolbarController.getView(null).getElement().slideToggle()}},Object.defineProperty(e.prototype,"handlesEvents",{get:function(){var e=new Array;return e.push(f.events.StructureModelLoadedEvent.TYPE),e.push(f.events.ProvideToolbarModelEvent.TYPE),e.push(g.viewer.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE),e.push(f.events.ImageChangedEvent.TYPE),e.push(f.events.CanvasTapedEvent.TYPE),e.push(f.events.LanguageModelLoadedEvent.TYPE),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toolbar",{get:function(){return this._toolbarController},enumerable:!0,configurable:!0}),e}(f.ViewerComponent),f.MyCoReToolbarComponent=t}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.thumbnail||(i.thumbnail={}),o=function(){function e(e){void 0===e&&(e=new Array),this.thumbnails=e,this._idThumbnailMap=new MyCoReMap,this.tilesInsertedMap=new MyCoReMap,this.fillIdThumbnailMap(),this.fillTilesInsertedMap(),this.currentPosition=new Position2D(0,0)}return e.prototype.fillTilesInsertedMap=function(){for(var e in this.thumbnails){var t=this.thumbnails[e];this.tilesInsertedMap.set(t.id,!1)}},e.prototype.fillIdThumbnailMap=function(){for(var e in this.thumbnails){var t=this.thumbnails[e];this._idThumbnailMap.set(t.id,t)}},e.prototype.getThumbnailById=function(e){return this._idThumbnailMap.get(e)},e}(),n.ThumbnailOverviewModel=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.thumbnail||(i.thumbnail={}),o=function(){function e(e,t,i,n){this._container=e,this._scrollHandler=t,this._resizeHandler=i,this._inputHandler=n,this._gap=0,this._spacer=jQuery("<div></div>"),this._spacer.appendTo(this._container);var o={position:"relative","overflow-y":"scroll","overflow-x":"hidden","-webkit-overflow-scrolling":"touch"};this._container.css(o),this._lastViewPortSize=this.getViewportSize();var r=this,a=function(){var e=new Position2D(r._container.scrollLeft(),r._container.scrollTop());r._scrollHandler.scrolled(e)};this._container.bind("scroll",a),jQuery(this._container).bind("iviewResize",function(){var e=r.getViewportSize();r._lastViewPortSize!=e&&(r._resizeHandler.resized(e),r._lastViewPortSize=r.getViewportSize(),a())})}return Object.defineProperty(e.prototype,"gap",{get:function(){return this._gap},set:function(e){this._gap=e},enumerable:!0,configurable:!0}),e.prototype.setContainerSize=function(e){this._spacer.css({width:e.width,height:e.height})},e.prototype.setContainerScrollPosition=function(e){this._container.scrollLeft(e.x),this._container.scrollTop(e.y)},e.prototype.setThumnailSelected=function(e,t){var i=this._container.find("[data-id='"+CSS.escape(e)+"']");t?i.addClass("selected"):i.removeClass("selected")},e.prototype.injectTile=function(e,t,i){var n=jQuery("<img />");n.attr("alt",i);var o=jQuery("<div>"+i+"</div>");o.addClass("caption");var r=jQuery("<div></div>");r.addClass("imgSpacer"),r.append(n);var a=jQuery("<div/>");a.attr("data-id",e),a.toggleClass("iviewThumbnail"),a.addClass("thumbnail"),a.prepend(r),a.append(o),a.css({left:this.gap+t.x,top:t.y}),this._inputHandler.addedThumbnail(e,a),this._container.append(a)},e.prototype.updateTileHref=function(e,t){this._container.find("div[data-id='"+CSS.escape(e)+"'] img").attr("src",t)},e.prototype.removeTile=function(e){this._container.find("div[data-id='"+CSS.escape(e)+"']").remove()},e.prototype.updateTilePosition=function(e,t){this._container.find("div[data-id='"+e+"']").css({left:this.gap+t.x,top:t.y})},e.prototype.getViewportSize=function(){return new Size2D(this._container.width(),this._container.height())},e.prototype.jumpToThumbnail=function(e){this._container.scrollTop(e)},e}(),n.ThumbnailOverviewView=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.thumbnail||(i.thumbnail={}),o=function(){function e(e,t,i,n){void 0===i&&(i={addedThumbnail:function(e,t){}}),void 0===n&&(n=new Size2D(255,255)),this._thumbnails=e,this._container=t,this._inputHandler=i,this._maxThumbnailSize=n}return Object.defineProperty(e.prototype,"thumbnails",{get:function(){return this._thumbnails},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxThumbnailSize",{get:function(){return this._maxThumbnailSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputHandler",{get:function(){return this._inputHandler},enumerable:!0,configurable:!0}),e}(),n.DefaultThumbnailOverviewSettings=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.thumbnail||(i.thumbnail={}),o=function(){function e(e){this._settings=e,this._model=new n.ThumbnailOverviewModel(this._settings.thumbnails),this._view=new n.ThumbnailOverviewView(this._settings.container,this,this,this._settings.inputHandler),this._settings.container.css({"min-width":this._settings.maxThumbnailSize.width+"px","min-height":this._settings.maxThumbnailSize.height+"px"}),this.update(!0)}return e.prototype.setThumbnailSelected=function(e){void 0!==this._model.selectedThumbnail&&null!=this._model.selectedThumbnail&&this._view.setThumnailSelected(this._model.selectedThumbnail.id,!1),this._model.selectedThumbnail=this._model.getThumbnailById(e)||null,this._view.setThumnailSelected(e,!0)},e.prototype.jumpToThumbnail=function(e){var t=this._view.getViewportSize(),i=this._settings.maxThumbnailSize,n=this._model.currentPosition,o=Math.floor(t.width/i.width),r=this._model.getThumbnailById(e),a=this._model.thumbnails.indexOf(r),s=Math.floor(a/o)*this._settings.maxThumbnailSize.height,l=this._model.currentPosition.y>s,h=this._model.currentPosition.y+this._view.getViewportSize().height<s+this._settings.maxThumbnailSize.height;if(l);else{if(!h)return;s=s-this._view.getViewportSize().height+this._settings.maxThumbnailSize.height}this._model.currentPosition.move(new MoveVector(0,s-n.y)),this.update(),this._view.jumpToThumbnail(s)},e.prototype.update=function(e){var i=this;void 0===e&&(e=!1);var t,n,o=this._view.getViewportSize(),r=(t=this._settings.container.parent().children(),n=0,t.each(function(e,t){i._settings.container[0]!=t&&"absolute"!=jQuery(t).css("position")&&(n+=jQuery(t).outerHeight())}),n);if(this._settings.container.css({height:this._settings.container.parent().height()-r}),0!=o.width&&0!=o.height){var a=o.width%this._settings.maxThumbnailSize.width/2;this._view.gap=a;var s=this._settings.maxThumbnailSize,l=this._model.currentPosition,h=Math.floor(o.width/s.width),u=Math.ceil(o.height/s.height);e&&(this._view.setContainerSize(new Size2D(o.width,Math.ceil(this._model.thumbnails.length/Math.max(h,1))*s.height)),this.updateThumbnails(0,Math.ceil(this._model.thumbnails.length/h),e));var p=Math.floor(l.y/s.height),c=Math.ceil(l.y/s.height+u);this.updateThumbnails(p,c,!1)}},e.prototype.updateThumbnails=function(e,t,i){for(var n=this._view.getViewportSize(),o=this._settings.maxThumbnailSize,r=Math.floor(n.width/o.width),a=new MyCoReMap,s=this,l=e||0;l<t;l++)for(var h=0;h<r;h++){var u=l*r+h,p=new Position2D(h*o.width,l*o.height),c=this._model.thumbnails[u];if(void 0!==c){var d=this._model.tilesInsertedMap.get(c.id);d||i?d&&this._view.updateTilePosition(c.id,p):(this._model.tilesInsertedMap.set(c.id,!0),this._view.injectTile(c.id,p,c.label),c.requestImgdataUrl(function(t){return function(e){s._view.updateTileHref(t,e)}}(c.id)),null!=this._model.selectedThumbnail&&this._model.selectedThumbnail.id===c.id&&this.setThumbnailSelected(c.id)),a.set(c.id,!1)}}(s=this)._model.tilesInsertedMap.forEach(function(e,t){a.has(e)||0==a.get(e)||s.removeThumbnail(e)})},e.prototype.removeThumbnail=function(e){this._model.tilesInsertedMap.remove(e),this._view.removeTile(e)},e.prototype.scrolled=function(e){this._model.currentPosition=e,this.update(!1)},e.prototype.resized=function(e){this.update(!0),null!=this._model.selectedThumbnail&&this.jumpToThumbnail(this._model.selectedThumbnail.id)},e}(),n.IviewThumbnailOverview=o}(mycore||(mycore={})),function(l){var e,h,t;e=l.viewer||(l.viewer={}),h=e.components||(e.components={}),t=function(i){function e(e){var t=i.call(this)||this;return t._settings=e,t._sidebarLabel=jQuery("<span>Bildbersicht</span>"),t._currentImageId=null,t._spinner=null,t._enabled=Utils.getVar(t._settings,"imageOverview.enabled",!0),t}return __extends(e,i),e.prototype.init=function(){if(this._enabled){this._container=jQuery("<div></div>"),this._idMetsImageMap=new MyCoReMap,this.trigger(new h.events.WaitForEvent(this,h.events.StructureModelLoadedEvent.TYPE)),this.trigger(new h.events.WaitForEvent(this,h.events.LanguageModelLoadedEvent.TYPE));var e="imageOverview"==Utils.getVar(this._settings,"leftShowOnStart","chapterOverview");if(0==this._settings.mobile&&e){this._spinner=jQuery("<div class='spinner'><img src='"+this._settings.webApplicationBaseURL+"/modules/iview2/img/spinner.gif'></div>"),this._container.append(this._spinner);var t=this._settings.mobile?h.events.ShowContentEvent.DIRECTION_CENTER:h.events.ShowContentEvent.DIRECTION_WEST;this.trigger(new h.events.ShowContentEvent(this,this._container,t,300,this._sidebarLabel))}}else this.trigger(new h.events.WaitForEvent(this,h.events.ProvideToolbarModelEvent.TYPE))},Object.defineProperty(e.prototype,"content",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"handlesEvents",{get:function(){var e=new Array;return this._enabled?(e.push(h.events.StructureModelLoadedEvent.TYPE),e.push(h.events.ImageChangedEvent.TYPE),e.push(l.viewer.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE),e.push(h.events.ShowContentEvent.TYPE),e.push(h.events.LanguageModelLoadedEvent.TYPE)):e.push(h.events.ProvideToolbarModelEvent.TYPE),e},enumerable:!0,configurable:!0}),e.prototype.handle=function(e){if(e.type==h.events.ProvideToolbarModelEvent.TYPE){var t=e;t.model._sidebarControllDropdownButton.children=t.model._sidebarControllDropdownButton.children.filter(function(e){return"imageOverview"!=e.id})}if(e.type==l.viewer.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE&&"imageOverview"==e.childId){var i=this._settings.mobile?h.events.ShowContentEvent.DIRECTION_CENTER:h.events.ShowContentEvent.DIRECTION_WEST;this.trigger(new h.events.ShowContentEvent(this,this._container,i,-1,this._sidebarLabel)),this._overview.update(!0),this._overview.jumpToThumbnail(this._currentImageId)}if(e.type==h.events.StructureModelLoadedEvent.TYPE){var n=e.structureModel._imageList,o=this._settings.tileProviderPath+this._settings.derivate+"/";this._overviewSettings=new l.viewer.widgets.thumbnail.DefaultThumbnailOverviewSettings(this.prepareModel(n,o),this._container,this),this._overview=new l.viewer.widgets.thumbnail.IviewThumbnailOverview(this._overviewSettings);var r=0==this._settings.filePath.indexOf("/")?this._settings.filePath.substr(1):this._settings.filePath;this._overview.jumpToThumbnail(r),this._overview.setThumbnailSelected(r),this._currentImageId=r,null!=this._spinner&&this._spinner.detach(),this.trigger(new h.events.ComponentInitializedEvent(this))}if(e.type==h.events.ImageChangedEvent.TYPE){var a=e;void 0!==this._overview&&(this._overview.jumpToThumbnail(a.image.id),this._overview.setThumbnailSelected(a.image.id),this._currentImageId=a.image.id)}if(e.type==h.events.LanguageModelLoadedEvent.TYPE){var s=e;this._sidebarLabel.text(s.languageModel.getTranslation("sidebar.imageOverview"))}},e.prototype.prepareModel=function(e,t){var i=new Array;for(var n in e){var o=e[n],r=""+(o.orderLabel||o.order),a=o.id;this._idMetsImageMap.set(a,o),i.push({id:a,label:r,requestImgdataUrl:o.requestImgdataUrl})}return i},e.prototype.addedThumbnail=function(e,t){var i=this;jQuery(t).bind("click",function(){i.trigger(new h.events.ImageSelectedEvent(i,i._idMetsImageMap.get(e)))})},e}(h.ViewerComponent),h.MyCoReImageOverviewComponent=t}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.chaptertree||(i.chaptertree={}),o=function(){function e(e,t){this.root=e,this.chapterLabelMap=t,this.chapterVisible=new MyCoReMap,this.idElementMap=new MyCoReMap,this.initChapter(this.root),this.selected=null}return e.prototype.initChapter=function(e){for(var t in this.idElementMap.set(e.id,e),this.chapterVisible.set(e.id,!0),e.chapter){var i=e.chapter[t];this.initChapter(i)}},e}(),n.ChapterTreeModel=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.chaptertree||(i.chaptertree={}),o=function(){function e(){}return e.prototype.register=function(e){this._ctrl=e},e.prototype.registerNode=function(e,t){var i=this;e.click(function(){var e=i._ctrl.getChapterById(t);i._ctrl.setChapterSelected(e)})},e.prototype.registerExpander=function(e,t){var i=this;e.click(function(){var e=i._ctrl.getChapterById(t);i._ctrl.setChapterExpanded(e,!i._ctrl.getChapterExpanded(e))})},e}(),n.DefaultChapterTreeInputHandler=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.chaptertree||(i.chaptertree={}),o=function(){function l(e,t,i){void 0===i&&(i="chapterTreeDesktop"),this._container=e,this._inputHandler=t,this.list=jQuery("<ol><ol>"),this.list.addClass(i),this.list.addClass("list-group"),this._container.append(this.list)}return l.prototype.addNode=function(e,t,i,n,o){var r=this.getParent(e);i===n&&(n="");var a=this.createNode(t,i,n,o);r.append(a)},l.prototype.getParent=function(e){var t;if(null!=e){if(0==(t=this.list.find("ol[data-id='"+CSS.escape(e)+"']")).length){t=this.list.find("li[data-id='"+CSS.escape(e)+"']");var i=jQuery("<ol></ol>");i.attr("data-id",e),i.attr("data-opened",!0),i.insertAfter(t),t=i}}else t=this.list;return t},l.prototype.createNode=function(e,t,i,n){var o=jQuery("<li></li>"),r=jQuery("<a title='"+t+"'></a>").text(t),a=jQuery("<span>"+i+"</span>");if(a.addClass("childLabel"),o.append(r),o.append(a),o.addClass("list-group-item"),o.attr("data-id",e),o.attr("data-opened",!0),this._inputHandler.registerNode(r,e),n){var s=jQuery('<span class="expander fas '+l.OPEN_ICON_CLASS+'"></span>');o.prepend(s),this._inputHandler.registerExpander(s,e)}return o},l.prototype.setOpened=function(e,t){var i=CSS.escape(e),n=(this.list.find("li[data-id='"+i+"']").attr("data-opened",t.toString()),this.list.find("ol[data-id='"+i+"']").attr("data-opened",t.toString()),this.list.find("li[data-id='"+i+"'] span.expander"));t?(n.removeClass(l.CLOSE_ICON_CLASS),n.addClass(l.OPEN_ICON_CLASS)):(n.removeClass(l.OPEN_ICON_CLASS),n.addClass(l.CLOSE_ICON_CLASS))},l.prototype.setSelected=function(e,t){this.list.find("li[data-id='"+CSS.escape(e)+"']").attr("data-selected",t.toString())},l.prototype.jumpTo=function(e){var t=this.list.find("li[data-id='"+CSS.escape(e)+"']");t.addClass("blink"),setTimeout(function(){t.removeClass("blink")},500);var i=t.position().top-this._container.position().top,n=0;if(i<0)n=i-10;else{var o=this._container.height(),r=t.height();if(!(o<i+r+10))return;n=i-o+r+10}this._container.scrollTop(this._container.scrollTop()+n)},l.CLOSE_ICON_CLASS="fa-chevron-right",l.OPEN_ICON_CLASS="fa-chevron-down",l}(),n.DesktopChapterTreeView=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.chaptertree||(i.chaptertree={}),o=function(){function e(e,t,i){void 0===i&&(i="chapterTreeDesktop"),this._container=e,this._inputHandler=t,this.list=jQuery("<ul></ul>"),this.list.addClass("mobileListview"),this.levelMap=new MyCoReMap,this.list.appendTo(e)}return e.prototype.addNode=function(e,t,i,n,o){i===n&&(n="");var r=jQuery("<li></li>"),a=jQuery("<a></a>");a.addClass("label"),a.text(i),a.attr("data-id",t),a.appendTo(r);var s=jQuery("<a></a>");s.text(n),s.addClass("childLabel"),s.appendTo(r),r.attr("data-id",t);var l=0;null!=e&&this.levelMap.has(e)&&(l=this.levelMap.get(e)+1),this.levelMap.set(t,l),a.css({"padding-left":15*l+"px"}),this.list.append(r),this._inputHandler.registerNode(r,t)},e.prototype.setOpened=function(e,t){},e.prototype.setSelected=function(e,t){},e.prototype.jumpTo=function(e){},e.LEVEL_MARGIN=15,e}(),n.MobileChapterTreeView=o}(mycore||(mycore={})),function(e){var t,i,r,n;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),r=i.chaptertree||(i.chaptertree={}),n=function(){function e(e,t,i,n,o){void 0===i&&(i=null),void 0===n&&(n=!1),void 0===o&&(o=new r.DefaultChapterTreeInputHandler),this._container=e,this._chapterLabelMap=t,this._chapter=i,this.mobile=n,this._inputHandler=o}return Object.defineProperty(e.prototype,"chapter",{get:function(){return this._chapter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chapterLabelMap",{get:function(){return this._chapterLabelMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewFactory",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputHandler",{get:function(){return this._inputHandler},enumerable:!0,configurable:!0}),e.prototype.createChapterTeeView=function(){return this.mobile?new r.MobileChapterTreeView(this.container,this.inputHandler):new r.DesktopChapterTreeView(this.container,this.inputHandler)},e}(),r.DefaultChapterTreeSettings=n}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.chaptertree||(i.chaptertree={}),o=function(){function e(e){this._settings=e,this._model=new n.ChapterTreeModel(e.chapter,this._settings.chapterLabelMap),this._view=e.viewFactory.createChapterTeeView(),this._settings.inputHandler.register(this),this.init()}return e.prototype.setChapterSelected=function(e){null!=this._model.selected&&this._view.setSelected(this._model.selected.id,!1),null!=e&&(this._model.selected=e,this._view.setSelected(this._model.selected.id,!0))},e.prototype.getSelectedChapter=function(){return this._model.selected},e.prototype.setChapterExpanded=function(e,t){null!=e&&(this._model.chapterVisible.set(e.id,t),this._view.setOpened(e.id,t))},e.prototype.getChapterExpanded=function(e){return this._model.chapterVisible.get(e.id)},e.prototype.getChapterById=function(e){return this._model.idElementMap.get(e)},e.prototype.init=function(){this.insertChapterView(this._model.root)},e.prototype.jumpToChapter=function(e){null!=e&&this._view.jumpTo(e.id)},e.prototype.insertChapterView=function(e){for(var t in this._view.addNode((e.parent||{id:null}).id,e.id,e.label,this._model.chapterLabelMap.get(e.id)||"",0<e.chapter.length),e.chapter){var i=e.chapter[t];this.insertChapterView(i)}},e}(),n.IviewChapterTree=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i._chapter=t,i}return __extends(o,n),Object.defineProperty(o.prototype,"chapter",{get:function(){return this._chapter},enumerable:!0,configurable:!0}),o.TYPE="ChapterChangedEvent",o}(n.MyCoReImageViewerEvent),n.ChapterChangedEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(o){function r(e,t,i){void 0===i&&(i=!0);var n=o.call(this,e,r.TYPE)||this;return n.stateMap=t,n.deepState=i,n}return __extends(r,o),r.TYPE="RequestStateEvent",r}(n.MyCoReImageViewerEvent),n.RequestStateEvent=o}(mycore||(mycore={})),function(d){var e,v,t;e=d.viewer||(d.viewer={}),v=e.components||(e.components={}),t=function(i){function e(e){var t=i.call(this)||this;return t._settings=e,t._spinner=null,t._currentChapter=null,t._initialized=!1,t._sidebarLabel=jQuery("<span>strukturbersicht</span>"),t._chapterToActivate=null,t._autoPagination=!0,t._idImageMap=new MyCoReMap,t._enabled=Utils.getVar(t._settings,"chapter.enabled",!0),t}return __extends(e,i),e.prototype.init=function(){var e=this;if(this._enabled){this._container=jQuery("<div></div>"),this._container.css({overflowY:"scroll"}),this._container.bind("iviewResize",function(){e.updateContainerSize()}),this.trigger(new v.events.WaitForEvent(this,v.events.StructureModelLoadedEvent.TYPE)),this.trigger(new v.events.WaitForEvent(this,v.events.LanguageModelLoadedEvent.TYPE));var t=Utils.getVar(this._settings,"chapter.showOnStart",1200<=window.innerWidth),i="chapterOverview"==Utils.getVar(this._settings,"leftShowOnStart",t?"chapterOverview":"none");if(0==this._settings.mobile&&i){this._spinner=jQuery("<div class='spinner'><img src='"+this._settings.webApplicationBaseURL+"/modules/iview2/img/spinner.gif'></div>"),this._container.append(this._spinner);var n=this._settings.mobile?v.events.ShowContentEvent.DIRECTION_CENTER:v.events.ShowContentEvent.DIRECTION_WEST;this.trigger(new v.events.ShowContentEvent(this,this._container,n,300,this._sidebarLabel))}}else this.trigger(new v.events.WaitForEvent(this,v.events.ProvideToolbarModelEvent.TYPE))},e.prototype.updateContainerSize=function(){this._container.css({height:this._container.parent().height()-this._sidebarLabel.parent().outerHeight()+"px"})},Object.defineProperty(e.prototype,"handlesEvents",{get:function(){var e=new Array;return this._enabled?(e.push(v.events.StructureModelLoadedEvent.TYPE),e.push(v.events.ImageChangedEvent.TYPE),e.push(v.events.ShowContentEvent.TYPE),e.push(d.viewer.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE),e.push(v.events.LanguageModelLoadedEvent.TYPE),e.push(v.events.RequestStateEvent.TYPE),e.push(v.events.RestoreStateEvent.TYPE),e.push(v.events.ChapterChangedEvent.TYPE)):e.push(v.events.ProvideToolbarModelEvent.TYPE),e},enumerable:!0,configurable:!0}),e.prototype.handle=function(e){var t=this;if(e.type===v.events.ProvideToolbarModelEvent.TYPE){var i=e;i.model._sidebarControllDropdownButton.children=i.model._sidebarControllDropdownButton.children.filter(function(e){return"chapterOverview"!==e.id})}if(e.type===d.viewer.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE&&"chapterOverview"==e.childId){var n=this._settings.mobile?v.events.ShowContentEvent.DIRECTION_CENTER:v.events.ShowContentEvent.DIRECTION_WEST;this.trigger(new v.events.ShowContentEvent(this,this._container,n,-1,this._sidebarLabel)),this.updateContainerSize()}if(e.type===v.events.StructureModelLoadedEvent.TYPE){var o=e,r=o.structureModel._rootChapter;this._structureModel=o.structureModel,this._structureModel._imageList.forEach(function(e){t._idImageMap.set(e.id,e),"orderLabel"in e&&null!==e.orderLabel&&(t._autoPagination=!1)});var a=this.createChapterLabelMap(this._structureModel);this._chapterWidgetSettings=new d.viewer.widgets.chaptertree.DefaultChapterTreeSettings(this._container,a,r,this._settings.mobile,this),this._chapterWidget=new d.viewer.widgets.chaptertree.IviewChapterTree(this._chapterWidgetSettings),this._initialized=!0,this.trigger(new v.events.ComponentInitializedEvent(this)),null!=this._spinner&&this._spinner.detach(),null!=this._chapterToActivate&&this.setChapter(this._chapterToActivate)}if(e.type===v.events.ImageChangedEvent.TYPE){if(void 0===this._structureModel||this._structureModel._imageToChapterMap.isEmpty())return;var s=e;if(null!=s.image&&this._initialized&&(null==this._chapterWidget.getSelectedChapter()||this._structureModel.chapterToImageMap.get(this._chapterWidget.getSelectedChapter().id)!=s.image)){var l=this._structureModel._imageToChapterMap.get(s.image.id);null!=l&&(this._chapterWidget.setChapterExpanded(l,!0),this._chapterWidget.jumpToChapter(l))}}if(e.type===v.events.LanguageModelLoadedEvent.TYPE){var h=e;this._sidebarLabel.text(h.languageModel.getTranslation("sidebar.chapterOverview"))}if(e.type===v.events.RequestStateEvent.TYPE){var u=e;null!=this._currentChapter&&u.stateMap.set("logicalDiv",this.persistChapterToString(this._currentChapter))}if(e.type===v.events.RestoreStateEvent.TYPE){var p=function(e){t._initialized?t.setChapter(e):t._chapterToActivate=e};(u=e).restoredState.hasThen("logicalDiv",p),u.restoredState.hasThen("div",p)}if(e.type===v.events.ChapterChangedEvent.TYPE){var c=e;if(null==c||null==c.chapter)return;this._chapterWidget.setChapterExpanded(c.chapter,!0),this._chapterWidget.jumpToChapter(c.chapter)}},e.prototype.persistChapterToString=function(e){return e.id},e.prototype.createChapterLabelMap=function(e){var i=this,n=new MyCoReMap;return e.chapterToImageMap.forEach(function(e,t){n.set(e,t.orderLabel||(i._autoPagination?t.order.toString(10):""))}),n},e.prototype.register=function(){},e.prototype.registerNode=function(e,t){var i=this;e.click(function(){i.setChapter(t,!0,e)})},e.prototype.setChapter=function(e,t,i,n){var o=this;if(void 0===t&&(t=!0),void 0===n&&(n=!0),null==this._currentChapter||this._currentChapter.id!=e){var r=this._chapterWidget.getChapterById(e);if(null!=r){var a=function(e){o._currentChapter=r,o._chapterWidget.setChapterExpanded(r,!0),o._chapterWidget.setChapterSelected(r),o._chapterWidget.jumpToChapter(r),n&&o.trigger(new v.events.ChapterChangedEvent(o,r)),null!=e&&t&&o.trigger(new v.events.ImageSelectedEvent(o,e))};if(this._structureModel._chapterToImageMap.has(e)){var s=this._structureModel._chapterToImageMap.get(e);a(s)}else{if(void 0!==i){var l=i.css("cursor");i.css("cursor","wait")}r.resolveDestination(function(e){void 0!==i&&i.css("cursor",l),a(null!==e?o._idImageMap.get(e):null)})}}}},e.prototype.registerExpander=function(e,t){var i=this;e.click(function(){var e=i._chapterWidget.getChapterById(t);i._chapterWidget.setChapterExpanded(e,!i._chapterWidget.getChapterExpanded(e))})},Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),e}(v.ViewerComponent),v.MyCoReChapterComponent=t}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.modal||(i.modal={}),o=function(){function e(e,t,i){void 0===i&&(i=document.body),this._mobile=e;var n=this;this._wrapper=jQuery("<div></div>"),this._wrapper.addClass("modal fade bs-modal-sm"),this._wrapper.attr("tabindex","-1"),this._wrapper.attr("role","dialog"),this._wrapper.attr("aria-labeleby","permalinkLabel"),this._wrapper.attr("aria-hidden","true"),this._wrapper.on("click",function(e){e.target==n._wrapper[0]&&n.hide()}),this._box=jQuery("<div></div>"),this._box.addClass("modal-dialog modal-sm"),this._box.appendTo(this._wrapper),this._content=jQuery("<div></div>"),this._content.addClass("modal-content"),this._content.appendTo(this._box),this._header=jQuery("<div><h4 class='modal-title' data-i18n='"+t+"'>"+t+"</h4></div>"),this._header.addClass("modal-header"),this._header.appendTo(this._content),this._body=jQuery("<div></div>"),this._body.addClass("modal-body"),this._body.appendTo(this._content),this._footer=jQuery("<div></div>"),this._footer.addClass("modal-footer"),this._footer.appendTo(this._content),this._close=jQuery("<button data-i18n='modal.close'>Close</button>"),this._close.attr("type","button"),this._close.addClass("btn btn-secondary"),this._close.appendTo(this._footer),this._close.click(function(){n.hide()}),this._mobile?this.hide():this._wrapper.modal({show:!1}),jQuery(i).prepend(this._wrapper)}return Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wrapper",{get:function(){return this._wrapper},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"modalContent",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"modalHeader",{get:function(){return this._header},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"modalBody",{get:function(){return this._body},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"modalFooter",{get:function(){return this._footer},enumerable:!0,configurable:!0}),e.prototype.show=function(){this._mobile?this._wrapper.show():this._wrapper.modal("show")},e.prototype.hide=function(){this._mobile?this._wrapper.hide():this._wrapper.modal("hide")},Object.defineProperty(e.prototype,"closeButton",{get:function(){return this._close},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closeLabel",{set:function(e){this._close.text(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"title",{get:function(){return this._header.find(".modal-title").text()},set:function(e){this._header.find(".modal-title").text(e)},enumerable:!0,configurable:!0}),e.prototype.updateI18n=function(e){return e.translate(this._wrapper),this},e}(),n.IviewModalWindow=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.modal||(i.modal={}),o=function(n){function e(e){var t=n.call(this,e,"Permalink")||this,i=t;return t._textArea=jQuery("<textarea></textarea>"),t._textArea.addClass("form-control"),t._textArea.appendTo(t.modalBody),t._textArea.on("click",function(){i._textArea.select()}),t}return __extends(e,n),Object.defineProperty(e.prototype,"permalink",{set:function(e){this._textArea.text(e)},enumerable:!0,configurable:!0}),e}(n.IviewModalWindow),n.ViewerPermalinkModalWindow=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i.restoredState=t,i}return __extends(o,n),o.TYPE="RestoreStateEvent",o}(n.MyCoReImageViewerEvent),n.RestoreStateEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(t){function i(e){return t.call(this,e,i.TYPE)||this}return __extends(i,t),i.TYPE="UpdateURLEvent",i}(n.MyCoReImageViewerEvent),n.UpdateURLEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i.callback=t,i}return __extends(o,n),o.TYPE="RequestPermalinkEvent",o}(n.MyCoReImageViewerEvent),n.RequestPermalinkEvent=o}(mycore||(mycore={})),function(t){var s,l,e;s=t.viewer||(t.viewer={}),l=s.components||(s.components={}),e=function(i){function e(e){var t=i.call(this)||this;return t._settings=e,t._currentState=new ViewerParameterMap,t._enabled=Utils.getVar(t._settings,"permalink.enabled",!0),t}return __extends(e,i),e.prototype.init=function(){if(this.trigger(new l.events.ComponentInitializedEvent(this)),this._enabled){this._modalWindow=new t.viewer.widgets.modal.ViewerPermalinkModalWindow(this._settings.mobile),this.trigger(new l.events.WaitForEvent(this,l.events.LanguageModelLoadedEvent.TYPE));var e=ViewerParameterMap.fromCurrentUrl();e.isEmpty()||this.trigger(new l.events.RestoreStateEvent(this,e))}else this.trigger(new l.events.WaitForEvent(this,l.events.ProvideToolbarModelEvent.TYPE))},e.prototype.handle=function(e){if(e.type==l.events.ProvideToolbarModelEvent.TYPE){var t=e,i=t.model.getGroup(t.model._actionControllGroup.name);void 0!==i&&null!=i&&t.model.getGroup(t.model._actionControllGroup.name).removeComponent(t.model._shareButton)}if(e.type==l.events.LanguageModelLoadedEvent.TYPE){var n=e;this._modalWindow.closeLabel=n.languageModel.getTranslation("permalink.close"),this._modalWindow.title=n.languageModel.getTranslation("permalink.title")}if(e.type==s.widgets.toolbar.events.ButtonPressedEvent.TYPE&&"ShareButton"==e.button.id){var o=new ViewerParameterMap;this.trigger(new l.events.RequestStateEvent(this,o,!0));var r=this.buildPermalink(o);this._modalWindow.permalink=r,this._modalWindow.show()}if(e.type==l.events.RequestPermalinkEvent.TYPE){var a=e;o=new ViewerParameterMap,this.trigger(new l.events.RequestStateEvent(this,o,!0)),r=this.buildPermalink(o),a.callback(r)}e.type==l.events.ImageChangedEvent.TYPE&&void 0!==e.image&&this.updateHistory(),e.type==l.events.UpdateURLEvent.TYPE&&this.updateHistory()},e.prototype.updateHistory=function(){var e=Utils.getVar(this._settings,"permalink.updateHistory",!0),t=new ViewerParameterMap;this.trigger(new l.events.RequestStateEvent(this,t,!1)),e&&window.history.replaceState({},"",this.buildPermalink(t))},e.prototype.buildPermalink=function(e){var t;"mets"===this._settings.doctype||"manifest"===this._settings.doctype?(t=e.get("page"),e.remove("page")):t=this._settings.filePath;var i=this.getBaseURL(t);return e.remove("derivate"),i+e.toParameterString()},e.prototype.getBaseURL=function(e){var t=0<location.href.indexOf("/iiif/")?"iiif/":"";return ViewerFormatString(Utils.getVar(this._settings,"permalink.viewerLocationPattern","{baseURL}/rsc/viewer/"+t+"{derivate}{file}",function(e){return null!=e}),{baseURL:this._settings.webApplicationBaseURL,derivate:0<e.indexOf("_derivate_")?"":this._settings.derivate+"/",file:e})},Object.defineProperty(e.prototype,"handlesEvents",{get:function(){var e=new Array;return this._enabled?(e.push(s.widgets.toolbar.events.ButtonPressedEvent.TYPE),e.push(l.events.LanguageModelLoadedEvent.TYPE),e.push(l.events.RequestPermalinkEvent.TYPE),e.push(l.events.ImageChangedEvent.TYPE),e.push(l.events.UpdateURLEvent.TYPE)):e.push(l.events.ProvideToolbarModelEvent.TYPE),e},enumerable:!0,configurable:!0}),e}(l.ViewerComponent),l.MyCoRePermalinkComponent=e}(mycore||(mycore={})),function(e){var r,t,i,n;r=e.viewer||(e.viewer={}),t=r.widgets||(r.widgets={}),i=t.i18n||(t.i18n={}),n=function(){function o(){}return o.prototype.getLanguage=function(e,t,n){void 0===n&&(n=o.DEFAULT_ERROR_CALLBACK);var i={url:e,success:function(e){t(new r.model.LanguageModel(new MyCoReMap(e)))},error:function(e,t,i){n(i)}};jQuery.ajax(i)},o.DEFAULT_ERROR_CALLBACK=function(e){console.log(e)},o}(),i.XMLI18NProvider=n,i.I18NPROVIDER=new n}(mycore||(mycore={})),function(i){var a;(function(n){var e=function(){function r(){}return r.prototype.getLanguage=function(e,o,n){void 0===n&&(n=r.DEFAULT_ERROR_CALLBACK);var t={url:e,dataType:"json",success:function(e){var t=[];for(var i in e){var n=0;0==i.indexOf(r.VIEWER_PREFIX)?n=r.VIEWER_PREFIX.length:0==i.indexOf(r.METS_PREFIX)&&(n=r.METS_PREFIX.length),t[i.substr(n)]=e[i]}o(new a.model.LanguageModel(new MyCoReMap(t)))},error:function(e,t,i){n(i),o(new a.model.LanguageModel(new MyCoReMap))}};jQuery.ajax(t)},r.DEFAULT_ERROR_CALLBACK=function(e){console.log(e)},r.VIEWER_PREFIX="component.viewer.",r.METS_PREFIX="component.mets.",r}();n.MyCoReI18NProvider=e,i.viewer.widgets.i18n.I18NPROVIDER=new e;var t=function(i){function e(e){var t=i.call(this)||this;return t._settings=e,t._language="lang"in t._settings?t._settings.lang:"en",t._loadI18N(),t}return __extends(e,i),e.prototype._loadI18N=function(){var i=this;if(void 0===this._settings.i18nURL||null==this._settings.i18nURL)throw new ViewerError("i18nURL is not specified in settings!");a.widgets.i18n.I18NPROVIDER.getLanguage(ViewerFormatString(this._settings.i18nURL,{lang:this._language}),function(e){var t=new n.events.LanguageModelLoadedEvent(i,e);i.trigger(t)})},e}(n.ViewerComponent);n.MyCoReI18NComponent=t})((a=i.viewer||(i.viewer={})).components||(a.components={}))}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(o){function r(e,t,i){var n=o.call(this,e,r.TYPE)||this;return n._href=t,n._onResolve=i,n}return __extends(r,o),r.TYPE="RequestTextContentEvent",r}(n.MyCoReImageViewerEvent),n.RequestTextContentEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function e(){this._insertedPages=new Array}return e.prototype.init=function(e,t,i,n,o,r){this._model=e,this._pageController=t,this._pageDimension=i,this._originalPageDimension=i,this._horizontalScrollbar=n,this._verticalScrollbar=o,this._pageLoader=r},e.prototype.getPageController=function(){return this._pageController},e.prototype.updatePage=function(e){var t=this.checkShouldBeInserted(e),i=this.isImageInserted(e);if(t&&!i&&this._model.children.has(e)){var n=this._model.children.get(e);this._insertedPages.push(e),this._pageController.addPage(n,this.calculatePageAreaInformation(e))}!t&&i&&this._model.children.has(e)&&(n=this._model.children.get(e),this._insertedPages.splice(this._insertedPages.indexOf(e)),this._pageController.removePage(n))},e.prototype.getRealPageDimension=function(e){if(-1!=e&&this._model.children.has(e)){var t=this._model.children.get(e),i=this._pageController.getPageAreaInformation(t);if(void 0!==i)return t.size.scale(i.scale).getRotated(this.getCurrentPageRotation())}return this._pageDimension.getRotated(this.getCurrentPageRotation())},e.prototype.syncronizePages=function(){throw"should be implemented"},e.prototype.clear=function(){throw"should be implemented"},e.prototype.checkShouldBeInserted=function(e){throw"should be implemented"},e.prototype.calculatePageAreaInformation=function(e){throw"should be implemented"},e.prototype.getImageMiddle=function(e){throw"should be implemented"},e.prototype.fitToScreen=function(){throw"should be implemented"},e.prototype.fitToWidth=function(e){throw void 0===e&&(e=!1),"should be implemented"},e.prototype.getCurrentPage=function(){throw"should be implemented"},e.prototype.jumpToPage=function(e){throw"should be implemented"},e.prototype.isImageInserted=function(e){return this._model.children.has(e)&&-1!=this._pageController.getPages().indexOf(this._model.children.get(e))},e.prototype.scrollhandler=function(){throw"should be implemented"},e.prototype.rotate=function(e){throw"should be implemented"},e.prototype.getLabelKey=function(){throw"should be implemented"},e.prototype.getCurrentOverview=function(){throw"should be implemented"},e.prototype.next=function(){throw"should be implemented"},e.prototype.previous=function(){throw"should be implemented"},e.prototype.getCurrentPageRotation=function(){throw"should be implemented"},e.prototype.setCurrentPageZoom=function(e){throw"should be implemented"},e.prototype.getCurrentPageZoom=function(){throw"should be implemented"},e.prototype.getCurrentPositionInPage=function(){var e=this._pageController.viewport.asRectInArea().pos,t=this.getCurrentPage(),i=this._pageDimension,n=this.getImageMiddle(t),o=e.x-(n.x-i.width/2),r=e.y-(n.y-i.height/2);return new Position2D(o,r)},e.prototype.setCurrentPositionInPage=function(e){throw"should be implemented"},e.prototype.getPositionInArea=function(e){var t=this._pageController.viewport,i=t.asRectInArea(),n=i.pos.x+i.size.width*(e.x/t.size.width),o=i.pos.y+i.size.height*(e.y/t.size.height);return new Position2D(n,o)},e.prototype.getPageHitInfo=function(e){for(var t=this._pageController.viewport,i=this._pageController.getPageArea(),n=this.getPositionInArea(e),o=0,r=i.getPagesInViewport(t);o<r.length;o++){var a=r[o],s=this._model.hrefImageMap.get(a.id);if(null!=s){var l=i.getPageInformation(a),h=a.size.getRotated(l.rotation).scale(l.scale),u=new Rect(new Position2D(l.position.x-h.width/2,l.position.y-h.height/2),h);if(u.intersects(n)){var p=u.flip(l.rotation).pos.rotate(l.rotation),c=n.rotate(l.rotation),d=new Position2D(Math.abs(c.x-p.x),Math.abs(c.y-p.y));return{id:a.id,order:s.order,pageAreaInformation:l,hit:d}}}}return{id:null,order:null,pageAreaInformation:null,hit:null}},e}(),n.PageLayout=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(o){function r(e,t,i){void 0===i&&(i=!1);var n=o.call(this,e,r.TYPE)||this;return n.pageLayout=t,n.isDefault=i,n}return __extends(r,o),r.TYPE="ProvidePageLayoutEvent",r}(n.MyCoReImageViewerEvent),n.ProvidePageLayoutEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(r){function a(e,t,i,n){void 0===n&&(n=null);var o=r.call(this,e,a.TYPE)||this;return o._pageId=t,o._onResolve=i,o.textContentURL=n,o}return __extends(a,r),a.TYPE="RequestPageEvent",a}(n.MyCoReImageViewerEvent),n.RequestPageEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i.pageLayout=t,i}return __extends(o,n),o.TYPE="PageLayoutChangedEvent",o}(n.MyCoReImageViewerEvent),n.PageLayoutChangedEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function e(){}return e.prototype.mouseDown=function(e,t){},e.prototype.mouseUp=function(e,t){},e.prototype.mouseClick=function(e,t){},e.prototype.mouseDoubleClick=function(e,t){},e.prototype.mouseMove=function(e,t){},e.prototype.mouseDrag=function(e,t,i,n){},e.prototype.scroll=function(e){},e.prototype.keydown=function(e){},e.prototype.keypress=function(e){},e.prototype.keyup=function(e){},e}(),n.DesktopInputAdapter=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i.listener=t,i}return __extends(o,n),o.TYPE="RequestDesktopInputEvent",o}(n.MyCoReImageViewerEvent),n.RequestDesktopInputEvent=o}(mycore||(mycore={})),function(e){var t,i,n;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=function(e,t,i,n,o,r,a){this.positions=e,this.middle=t,this.angle=i,this.distance=n,this.time=o,this.velocity=r,this.delta=a},(i.canvas||(i.canvas={})).TouchMove=n}(mycore||(mycore={})),function(e){var t,i,n;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=function(e,t,i,n,o,r,a,s,l,h,u,p,c){this.startTime=e,this.startMiddle=t,this.startAngle=i,this.startDistance=n,this.canvasStartPosition=o,this.canvasStartScale=r,this.canvasStartRotation=a,this.currentMove=s,this.lastMove=l,this.lastSession=h,this.touches=u,this.touchLeft=p,this.maxTouches=c},(i.canvas||(i.canvas={})).TouchSession=n}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function e(){}return e.prototype.touchStart=function(e){},e.prototype.touchMove=function(e){},e.prototype.touchEnd=function(e){},e}(),n.TouchInputAdapter=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i.listener=t,i}return __extends(o,n),o.TYPE="RequestTouchInputEvent",o}(n.MyCoReImageViewerEvent),n.RequestTouchInputEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(o){function r(e,t,i){var n=o.call(this,e,r.TYPE)||this;return n.zIndex=t,n.canvasPageLayer=i,n}return __extends(r,o),r.TYPE="AddCanvasPageLayerEvent",r}(n.MyCoReImageViewerEvent),n.AddCanvasPageLayerEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){void 0===t&&(t=!0);var i=n.call(this,e,o.TYPE)||this;return i.edit=t,i}return __extends(o,n),o.TYPE="TextEditEvent",o}(n.MyCoReImageViewerEvent),n.TextEditEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(t){function i(e){return t.call(this,e,i.TYPE)||this}return __extends(i,t),i.TYPE="RedrawEvent",i}(n.MyCoReImageViewerEvent),n.RedrawEvent=o}(mycore||(mycore={})),function(e){var t,n,i,o;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),i=n.canvas||(n.canvas={}),o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._paiCache=new MyCoReMap,e._rotation=0,e.maximalPageScale=4,e}return __extends(e,t),e.prototype.syncronizePages=function(){var t=this,e=this._pageController.viewport,i=this.getPageHeightWithSpace(),n=this._model.pageCount;this.correctViewport(),void 0!==this._horizontalScrollbar&&null!=this._horizontalScrollbar&&(this._horizontalScrollbar.areaSize=this._pageDimension.width,this._horizontalScrollbar.viewSize=this._pageController.viewport.size.width/this._pageController.viewport.scale,this._horizontalScrollbar.position=e.position.x-e.size.width/e.scale/2+this._pageDimension.width/2),void 0!==this._verticalScrollbar&&null!=this._verticalScrollbar&&(this._verticalScrollbar.areaSize=n*this.getPageHeightWithSpace(),this._verticalScrollbar.viewSize=this._pageController.viewport.size.height/this._pageController.viewport.scale,this._verticalScrollbar.position=e.position.y-e.size.height/e.scale/2);for(var o=e.size.height/e.scale,r=e.position.y-o/2,a=e.position.y+o/2,s=Math.floor(r/i),l=Math.ceil(a/i),h=this._insertedPages.slice(0),u=s;u<=l;u++)this._model.children.has(u)&&-1==h.indexOf(u)?h.push(u):0<u&&u<=this._model.pageCount&&this._pageLoader(u);h.forEach(function(e){t.updatePage(e)})},e.prototype.clear=function(){var t=this,e=this._pageController.getPages().slice(0);this._insertedPages.splice(0,this._insertedPages.length),e.forEach(function(e){t._pageController.removePage(e)})},e.prototype.fitToScreen=function(){var e=this._pageController.viewport;if(0!=e.size.width&&0!=e.size.height){var t=e.size,i=this.getRealPageDimension(this.getCurrentPage());e.scale=Math.min(t.width/i.width,t.height/i.height);var n=this.getImageMiddle(this.getCurrentPage());e.position=new Position2D(0,n.y)}},e.prototype.calculatePageAreaInformation=function(e){var t=this._model.children.get(e).size,i=new n.canvas.PageAreaInformation;return i.position=this.getImageMiddle(e),i.scale=Math.min(this._originalPageDimension.width/t.width,this._originalPageDimension.height/t.height),i.rotation=this._rotation,this._paiCache.set(e,i),i},e.prototype.checkShouldBeInserted=function(e){var t=this._pageController.viewport.asRectInArea(),i=this.getImageMiddle(e),n=new Rect(new Position2D(i.x-this._pageDimension.width/2,i.y-this._pageDimension.height/2),this._pageDimension),o=this.getCurrentOverview();return null!=t.getIntersection(n)||null!=o.getIntersection(n)},e.prototype.fitToWidth=function(e){void 0===e&&(e=!1);var t=this.getImageMiddle(this.getCurrentPage()),i=this.getRealPageDimension(this.getCurrentPage());this._pageController.viewport.scale=this._pageController.viewport.size.width/i.width;var n=t.y;if(e){var o=this._pageController.viewport,r=o.size.scale(1/o.scale);n=n-i.height/2+r.height/2}this._pageController.viewport.position=new Position2D(0,n)},e.prototype.getCurrentPage=function(){return void 0===this._pageController?0:Math.ceil(this._pageController.viewport.position.y/this.getPageHeightWithSpace())},e.prototype.jumpToPage=function(e){var t=this.getImageMiddle(e),i=new Rect(new Position2D(t.x-this._pageDimension.width/2,t.y-this._pageDimension.height/2),this._pageDimension);this._pageController.viewport.setRect(i)},e.prototype.getPageHeightWithSpace=function(){return this._pageDimension.height+this._pageDimension.height/10},e.prototype.getImageMiddle=function(e){var t=e*this.getPageHeightWithSpace()-this._pageDimension.height/2;return new Position2D(0,t)},e.prototype.scrollhandler=function(){var e=this._pageController.viewport,t=new Position2D(this._horizontalScrollbar.position,this._verticalScrollbar.position),i=t.x+e.size.width/e.scale/2-this._pageDimension.width/2;e.position=new Position2D(i,t.y+e.size.height/e.scale/2)},e.prototype.correctViewport=function(){var e=this._pageController.viewport,t=this.getCurrentPageScaling();if(-1!=t){var i=this._pageController.viewport.size.width/this._pageDimension.width,n=Math.min(this._pageController.viewport.size.height/(2*this._pageDimension.height),i);e.scale<n&&(e.stopAnimation(),e.scale=n),e.scale*t>this.maximalPageScale&&(e.stopAnimation(),e.scale=this.maximalPageScale/t)}var o=e.size.scale(1/e.scale),r=Math.ceil(e.asRectInArea().size.height/2),a=Math.ceil(this._model.pageCount*this.getPageHeightWithSpace()-Math.floor(e.asRectInArea().size.height/2)),s=Math.min(Math.max(e.position.y,r),a);if(o.width>this._pageDimension.width){var l=new Position2D(0,s);e.position.equals(l)||(e.position=l)}else{var h=-this._pageDimension.width/2+o.width/2,u=this._pageDimension.width/2-o.width/2,p=Math.max(h,Math.min(u,e.position.x));l=new Position2D(p,s),e.position.equals(l)||(e.position=l)}},e.prototype.rotate=function(e){this._rotation=e;var t=this.getCurrentPage();this._pageDimension=this._originalPageDimension.getRotated(e),this.clear(),this.syncronizePages(),this.jumpToPage(t)},e.prototype.getLabelKey=function(){return"singlePageLayout"},e.prototype.getCurrentOverview=function(){var e=this.getRealPageDimension(this.getCurrentPage()),t=this.getImageMiddle(this.getCurrentPage());return new Rect(new Position2D(t.x-e.width/2,t.y-e.height/2),e)},e.prototype.next=function(){var e=this.getCurrentPage(),t=Math.max(Math.min(e+1,this._model.pageCount),0),i=this._pageController.viewport.scale,n=this.getCurrentPositionInPage();this.jumpToPage(t),this._pageController.viewport.scale=i,this.setCurrentPositionInPage(n)},e.prototype.previous=function(){var e=this.getCurrentPage(),t=Math.max(Math.min(e-1,this._model.pageCount),0),i=this._pageController.viewport.scale,n=this.getCurrentPositionInPage();this.jumpToPage(t),this._pageController.viewport.scale=i,this.setCurrentPositionInPage(n)},e.prototype.getCurrentPageRotation=function(){return this._rotation},e.prototype.getCurrentPageZoom=function(){if(void 0!==this._pageController){var e=this.getCurrentPageScaling();return-1!==e?this._pageController.viewport.scale*e:this._pageController.viewport.scale}},e.prototype.setCurrentPageZoom=function(e){if(void 0!==this._pageController){var t=this.getCurrentPageScaling();this._pageController.viewport.scale=e/t}},e.prototype.getCurrentPageScaling=function(){if(void 0===this._model)return-1;var e=this.getCurrentPage();if(-1!=e&&this._model.children.has(e)){var t=this._model.children.get(e),i=this._pageController.getPageAreaInformation(t);if(void 0!==i)return i.scale}return-1},e.prototype.setCurrentPositionInPage=function(e){var t=this._pageController.viewport.asRectInArea(),i=this.getCurrentPage(),n=this.getImageMiddle(i),o=this._pageDimension,r=new Position2D(n.x-o.width/2,n.y-o.height/2);this._pageController.viewport.position=new Position2D(r.x+e.x+t.size.width/2,r.y+e.y+t.size.height/2)},e}(i.PageLayout),i.SinglePageLayout=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function e(e,t,i,n){void 0===n&&(n=300),this._viewport=e,this._zoomScale=t,this._duration=n,this._startScale=null,this._startPosition=null,this._targetScale=null,this._totalElapsedTime=0,this._targetScale=e.scale*this._zoomScale,this._startPosition=this._viewport.position,this._startScale=e.scale,this._position=void 0!==i&&null!=i?i:this._viewport.position.copy(),this._diff=new MoveVector(this._viewport.position.x-this._position.x,this._viewport.position.y-this._position.y).scale(this._startScale)}return e.prototype.updateAnimation=function(e){this._totalElapsedTime+=e;var t=(this._targetScale-this._startScale)*this._totalElapsedTime/this._duration+this._startScale;this._viewport.scale=t,this._viewport.position=this._position.move(this._diff.scale(1/t));var i=this._totalElapsedTime>=this._duration-e;return i&&(this._viewport.position=this._position.move(this._diff.scale(1/this._targetScale)),this._viewport.scale=this._targetScale),i},e.prototype.merge=function(e){this._startScale=this._viewport.scale,this._targetScale*=e,this._totalElapsedTime=0},e}(),n.ZoomAnimation=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function o(e,t){this._viewport=e,this._startVelocity=t,this._currentVelocity=this._startVelocity.scale(1/this._viewport.scale)}return o.prototype.updateAnimation=function(e){this._currentVelocity=this._currentVelocity.scale(1/(1+e/3*.01));var t=this._currentVelocity.x<o.MINIMUM_VELOCITY&&this._currentVelocity.x>-o.MINIMUM_VELOCITY&&this._currentVelocity.y<o.MINIMUM_VELOCITY&&this._currentVelocity.y>-o.MINIMUM_VELOCITY;if(!t){var i=this._viewport.position,n=new Position2D(i.x+this._currentVelocity.x*e,i.y+this._currentVelocity.y*e);this._viewport.position=n}return t},o.MINIMUM_VELOCITY=.05,o}(),n.VelocityScrollAnimation=o}(mycore||(mycore={})),function(e){var t,i;t=e.viewer||(e.viewer={}),function(e){var t=function(){function e(e,t,i){this._inputElement=e,this._viewport=t,this._handler=i,this._lastMouseSession=null,this.initMove(),this.initScale()}return e.prototype.initMove=function(){var i=this,n=jQuery(this._inputElement[0]);this._mouseMoveHandler=function(e){if(null!=i.getTarget(e)){var t=i.getMousePosition(n,e);i._handler.mouseMove(t,e)}},this._mouseDragHandler=function(e){if(null!=i.getTarget(e)){var t=i.getMousePosition(n,e);i._handler.mouseDrag(t,i._currentMouseSession.startPosition,i._currentMouseSession.startViewport,e)}},this._mouseDownHandler=function(e){if(null!=i.getTarget(e)){var t=i.getMousePosition(n,e);i._handler.mouseDown(t,e),i._currentMouseSession=i.createMouseSession(t,i._viewport.position.copy()),n.unbind("mousemove",i._mouseMoveHandler),n.bind("mousemove",i._mouseDragHandler),n.bind("mouseleave",i._mouseLeaveHandler)}},this._mouseLeaveHandler=function(e){i._mouseUpHandler(e)},this._mouseUpHandler=function(e){jQuery(e.target);var t=i.getMousePosition(n,e);i._handler.mouseUp(t,e),i.notNull(i._currentMouseSession)&&((new Date).valueOf()-i._currentMouseSession.downDate<250&&Math.abs(i._currentMouseSession.startPosition.x-t.x)<10&&Math.abs(i._currentMouseSession.startPosition.y-t.y)<10&&i._handler.mouseClick(t,e),i.notNull(i._lastMouseSession)&&i._currentMouseSession.downDate-i._lastMouseSession.downDate<500&&Math.abs(i._lastMouseSession.startPosition.x-t.x)<10&&Math.abs(i._lastMouseSession.startPosition.y-t.y)<10&&i._handler.mouseDoubleClick(t,e),n.unbind("mousemove",i._mouseDragHandler),n.unbind("mouseleave",i._mouseLeaveHandler),n.bind("mousemove",i._mouseMoveHandler),i._lastMouseSession=i._currentMouseSession,i._currentMouseSession=null)},n.bind("mousemove",this._mouseMoveHandler),n.bind("mousedown",this._mouseDownHandler),n.bind("mouseup",this._mouseUpHandler);var e=jQuery(document.body);e.keydown(function(e){i._handler.keydown(e)}),e.keyup(function(e){i._handler.keyup(e)}),e.keypress(function(e){i._handler.keypress(e)})},e.prototype.notNull=function(e){return void 0!==e&&null!=e},e.prototype.getTarget=function(e){var t=jQuery(e.target);return t.hasClass("overview")?null:t},e.prototype.getMousePosition=function(e,t){var i=(t.clientX+window.pageXOffset-e.offset().left)*window.devicePixelRatio,n=(t.clientY+window.pageYOffset-e.offset().top)*window.devicePixelRatio;return new Position2D(i,n)},e.prototype.clearRunning=function(){if(null!=this._currentMouseSession){var e=jQuery(this._inputElement[0]);e.unbind("mousemove",this._mouseDragHandler),e.bind("mousemove",this._mouseMoveHandler),this._lastMouseSession=this._currentMouseSession,this._handler.mouseUp(this._currentMouseSession.currentPosition,null),this._currentMouseSession=null}},e.prototype.initScale=function(){var t=this;viewerCrossBrowserWheel(this._inputElement[0],function(e){t._handler.scroll(e)})},e.prototype.updateOverview=function(e,t,i){this._overviewRect=e,this._overviewScale=t,this._overviewBounds=i},e.prototype.createMouseSession=function(e,t){return new i(e,t,e)},e}();e.DesktopInputDelegator=t;var i=function(e,t,i){this.startPosition=e,this.startViewport=t,this.currentPosition=i,this.downDate=(new Date).getTime()}}((i=t.widgets||(t.widgets={})).canvas||(i.canvas={}))}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function e(e,t){void 0===e&&(e=20),void 0===t&&(t=300),this._maxElements=e,this._maxTime=t,this._maxElementsOrig=this._maxElements,this._values=new Array}return e.prototype.add=function(e){if(0<this._values.length){var t=this._values.pop();this._values.push(t),5<=e.time-t.time&&this._values.push(e);var i=this._values.reverse();i.length=Math.min(i.length,this._maxElements),this._values=i.reverse()}else this._values.push(e)},e.prototype.getVelocity=function(){var e=this._values.pop();if(this._values.push(e),0==this._values.length)return new MoveVector(0,0);var t=null;for(var i in this._values){var n=this._values[i];if(!(Math.abs(n.time-e.time)>this._maxTime)){t=n;break}}var o=e.time-t.time,r=new MoveVector(t.middle.x-e.middle.x,t.middle.y-e.middle.y);return new MoveVector(r.x/o||0,r.y/o||0)},e}(),n.VelocityCalculationQueue=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.canvas||(i.canvas={}),o=function(){function e(e){var t=this;this._inputElement=e,this._idPointerMap=new MyCoReMap,this._handlerMap=new MyCoReMap,this._inputElement.addEventListener("pointerdown",function(e){"touch"==e.pointerType&&(e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),t._updatePointer(e.pointerId.toString(10),new Position2D(e.offsetX,e.offsetY)),t._fireEvent("touchstart"))}),this._inputElement.addEventListener("pointerup",function(e){"touch"==e.pointerType&&(e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),t._deletePointer(e.pointerId.toString(10)),t._fireEvent("touchend"))}),this._inputElement.addEventListener("pointermove",function(e){"touch"==e.pointerType&&(e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),t._updatePointer(e.pointerId.toString(10),new Position2D(e.offsetX,e.offsetY)),t._fireEvent("touchmove"))}),this._inputElement.addEventListener("pointercancel",function(e){"touch"==e.pointerType&&(e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),t._deletePointer(e.pointerId.toString(10)),t._fireEvent("touchend"))})}return e.prototype._deletePointer=function(e){this._idPointerMap.remove(e)},e.prototype._updatePointer=function(e,t){this._idPointerMap.set(e,t)},e.prototype._fireEvent=function(e){this._handlerMap.has(e)&&this._handlerMap.get(e)(this._createTouchEvent())},e.prototype._createTouchEvent=function(){return{preventDefault:function(){},targetTouches:this._createTouchesArray()}},e.prototype._createTouchesArray=function(){var t=new Array;return this._idPointerMap.values.forEach(function(e){return t.push({clientX:e.x,clientY:e.y,pageX:e.x,pageY:e.y})}),t},Object.defineProperty(e.prototype,"touchstart",{get:function(){return this._handlerMap.get("touchstart")},set:function(e){this._handlerMap.set("touchstart",e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"touchmove",{get:function(){return this._handlerMap.get("touchmove")},set:function(e){this._handlerMap.set("touchmove",e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"touchend",{get:function(){return this._handlerMap.get("touchend")},set:function(e){this._handlerMap.set("touchend",e)},enumerable:!0,configurable:!0}),e}(),n.TouchPolyfill=o}(mycore||(mycore={})),function(e){var t,i,u,n;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),u=i.canvas||(i.canvas={}),n=function(){function e(e,t,i){this._inputElement=e,this._viewport=t,this._handler=i,this.msGestureTarget=null,this.session=null,this.lastSession=null,this.listener=new Array,this.initTouch()}return e.prototype.createTouchSession=function(e,t,i,n,o,r,a){return void 0===o&&(o=this._viewport.position),void 0===r&&(r=this._viewport.scale),void 0===a&&(a=this._viewport.rotation),new u.TouchSession((new Date).valueOf(),e,t,i,o,r,a,null,null,n,0,!1,0)},e.prototype.initTouch=function(){var e=this._inputElement[0],l=this,h=new u.VelocityCalculationQueue,t=new u.TouchPolyfill(e),i=function(e){e.preventDefault(),null==this.session?(h=new u.VelocityCalculationQueue,this.session=l.createTouchSession(l.getMiddle(e.targetTouches),0,l.getDistance(e.targetTouches),this.lastSession),this.session.touches++,this.session.maxTouches=this.session.touches):(this.session.touches++,this.session.touches>this.session.maxTouches&&(this.session.maxTouches=this.session.touches),2==this.session.touches&&(this.session.startAngle=l.getAngle(e.targetTouches[0],e.targetTouches[1])),this.session.startMiddle=l.getMiddle(e.targetTouches),this.session.startDistance=l.getDistance(e.targetTouches)),l._handler.touchStart(this.session)},n=function(e){this.session.touches--,this.session.touchLeft=!0,0===this.session.touches&&(l._handler.touchEnd(this.session),this.session.lastSession=null,this.lastSession=this.session,this.session=null),e.preventDefault()},o=function(e){e.preventDefault();var t=l.getMiddle(e.targetTouches),i=l.getPositions(e.targetTouches),n=l.getDistance(e.targetTouches),o=0;2===this.session.touches&&(o=l.getAngle(e.targetTouches[0],e.targetTouches[1]));var r=null,a=null;a=null!=this.session.currentMove?(h.add(this.session.currentMove),r=h.getVelocity(),null!=this.session.lastMove?new MoveVector(this.session.lastMove.middle.x-this.session.currentMove.middle.x,this.session.lastMove.middle.y-this.session.currentMove.middle.y):new MoveVector(0,0)):(r=new MoveVector(0,0),new MoveVector(0,0));var s=new u.TouchMove(i,t,o,n,(new Date).valueOf(),r,a);this.session.lastMove=this.session.currentMove,this.session.currentMove=s,l._handler.touchMove(this.session)};this.addListener(e,"touchstart",i),this.addListener(e,"touchend",n),this.addListener(e,"touchmove",o),t.touchstart=i,t.touchmove=o,t.touchend=n},e.prototype.clearRunning=function(){null!=this.session&&(this._handler.touchEnd(this.session),this.session.lastSession=null,this.lastSession=this.session,this.session=null)},e.prototype.addListener=function(e,t,i){e.addEventListener(t,i),this.listener.push({surface:e,type:t,fn:i})},e.prototype.getPositions=function(e){for(var t=new Array,i=0;i<e.length;i++){var n=e[i];t.push(new Position2D(n.clientX*window.devicePixelRatio,n.clientY*window.devicePixelRatio))}return t},e.prototype.getAngle=function(e,t){var i=t.pageY*window.devicePixelRatio-e.pageY*window.devicePixelRatio,n=t.pageX*window.devicePixelRatio-e.pageX*window.devicePixelRatio;return 180*Math.atan2(i,n)/Math.PI},e.prototype.getMiddle=function(e){for(var t=0,i=0,n=0;n<e.length;n++){var o=e[n];t+=o.clientX*window.devicePixelRatio,i+=o.clientY*window.devicePixelRatio}return new Position2D(t/e.length,i/e.length)},e.prototype.getDistance=function(e){for(var t=0,i=0;i<e.length;i++){var n=e[i],o=e[i-1];void 0!==o&&null!=o&&(t+=Math.sqrt(Math.pow(n.clientX-o.clientX,2)+Math.pow(n.clientY-o.clientY,2)))}return t},e.prototype.getVelocity=function(e,t){return new MoveVector(Math.abs(t.x/e)||0,Math.abs(t.y/e)||0)},e.prototype.delete=function(){this.listener.forEach(function(e){e.surface.removeEventListener(e.type,e.fn)})},e}(),u.TouchInputDelegator=n}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i.viewport=t,i}return __extends(o,n),o.TYPE="ViewportInitializedEvent",o}(n.MyCoReImageViewerEvent),n.ViewportInitializedEvent=o}(mycore||(mycore={})),function(_){var w;(function(m){var t=_.viewer.components.events.RequestTextContentEvent,e=function(n){function r(e,t){var i=n.call(this)||this;return i._settings=e,i._container=t,i._pageLayout=null,i._pageController=new _.viewer.widgets.canvas.PageController(!0),i._hrefImageMap=new MyCoReMap,i._hrefPageMap=new MyCoReMap,i._orderImageMap=new MyCoReMap,i._orderPageMap=new MyCoReMap,i._hrefPageLoadingMap=new MyCoReMap,i._structureImages=null,i._languageModel=null,i._desktopDelegators=new Array,i._touchDelegators=new Array,i._permalinkState=null,i._imageView=new w.widgets.canvas.PageView(!0,!1),i._altoView=new w.widgets.canvas.PageView(!0,!0),i._componentContent=jQuery("<div></div>"),i._viewMode="imageView",i._layouts=new Array,i._rotation=0,i._startPage=null,i._layoutModel={children:i._orderPageMap,hrefImageMap:i._hrefImageMap,pageCount:1},i._pageLoader=function(e){i._orderImageMap.has(e)?i.loadPageIfNotPresent(i._orderImageMap.get(e).href,e):i.loadPageIfNotPresent(i._settings.filePath,e)},i.pageWidth=2480,i.pageHeight=3508,i}return __extends(r,n),r.prototype.init=function(){var i=this;if(this.isImageDoctype()){this.changeImage(this._settings.filePath,!1),this.trigger(new m.events.ComponentInitializedEvent(this)),this.trigger(new m.events.WaitForEvent(this,m.events.StructureModelLoadedEvent.TYPE)),this.trigger(new m.events.WaitForEvent(this,m.events.ShowContentEvent.TYPE)),this.trigger(new m.events.WaitForEvent(this,m.events.ProvideToolbarModelEvent.TYPE)),this.trigger(new m.events.ViewportInitializedEvent(this,this._pageController.viewport));var e=this._componentContent;e.css({position:"absolute",top:"0px",left:"0px",right:this._settings.mobile?"0px":"15px",bottom:"15px"}),this.initMainView();var t=Utils.getVar(this._settings,"canvas.overview.enabled",!0);this._settings.mobile||(t&&e.append(this._pageController._overview.container),this._pageController._overview.initEventHandler(),e=(e=(e=e.add(this._horizontalScrollbar.scrollbarElement)).add(this._verticalScrollbar.scrollbarElement)).add(this._toggleButton),this.initOverview(t)),jQuery(e).bind("iviewResize",function(){i._horizontalScrollbar.resized(),i._verticalScrollbar.resized(),i._pageController.update()}),this._pageController.viewport.positionProperty.addObserver({propertyChanged:function(e,t){i.update()}}),this._pageController.viewport.scaleProperty.addObserver({propertyChanged:function(e,t){}}),this.trigger(new m.events.ShowContentEvent(this,e,m.events.ShowContentEvent.DIRECTION_CENTER))}},r.prototype.isImageDoctype=function(){return"mets"===this._settings.doctype||"pdf"===this._settings.doctype||"manifest"===this._settings.doctype},r.prototype.initOverview=function(e){if(e){var t=this._pageController._overview.container,i=parseInt(Utils.getVar(this._settings,"canvas.overview.minVisibleSize",r.DEFAULT_CANVAS_OVERVIEW_MIN_VISIBLE_SIZE,function(e){return!isNaN(1*e)&&1<parseInt(e,10)}),10),n=this._toggleButton.children(".fas");this._container.width()<i?(jQuery(t).hide(),n.addClass(r.OVERVIEW_VISIBLE_ICON)):n.addClass(r.OVERVIEW_INVISIBLE_ICON),this._toggleButton.click(function(){jQuery(t).is(":visible")?(jQuery(t).hide(),n.addClass(r.OVERVIEW_VISIBLE_ICON),n.removeClass(r.OVERVIEW_INVISIBLE_ICON)):(jQuery(t).show(),n.addClass(r.OVERVIEW_INVISIBLE_ICON),n.removeClass(r.OVERVIEW_VISIBLE_ICON))})}else this._toggleButton.addClass("disabled")},r.prototype.initMainView=function(){var n=this;if(this.registerDesktopInputHandler(new o(this)),this.registerTouchInputHandler(new i(this)),this._settings.mobile||(this._horizontalScrollbar=new w.widgets.canvas.Scrollbar(!0),this._verticalScrollbar=new w.widgets.canvas.Scrollbar(!1),this._toggleButton=jQuery("<div class='overViewToggle'><div class=\"fas\"></div></div>"),this._pageController.viewport.sizeProperty.addObserver({propertyChanged:function(e,t){n._horizontalScrollbar.update(),n._verticalScrollbar.update()}}),this._horizontalScrollbar.scrollHandler=this._verticalScrollbar.scrollHandler=function(){n._pageLayout.scrollhandler()},this._pageController._overview=new w.widgets.canvas.Overview(this._pageController.viewport)),this._componentContent.append(this._imageView.container),this._imageView.container.addClass("mainView"),this._imageView.container.css({left:"0px",right:"0px"}),this._componentContent.addClass("grabbable"),this._altoView.container.addClass("secondView"),this._altoView.container.css({left:"50%",right:"0px"}),this._altoView.container.css({"border-left":"1px solid black"}),this._pageController.views.push(this._imageView),"pdf"==this._settings.doctype){var e=new w.widgets.canvas.TextRenderer(this._pageController.viewport,this._pageController.getPageArea(),this._imageView,function(e,i){n.trigger(new t(n,e.id,function(e,t){i(t)}))},function(e){n.changeImage(e,!0)});this._pageController.textRenderer=e}},r.prototype.setViewMode=function(e){var i=this,t=function(e){var t=i._pageController.views.indexOf(e);-1!=t&&i._pageController.views.splice(t,1),e.container.detach()},n=function(e){-1==i._pageController.views.indexOf(e)&&i._pageController.views.push(e),e.container.parent()!=i._componentContent&&i._componentContent.append(e.container)};"imageView"==(this._viewMode=e)?(this._imageView.container.css({left:"0px",right:"0px"}),t(this._altoView),n(this._imageView),this.setSelectableButtonEnabled(!1)):"mixedView"==e?(this._imageView.container.css({left:"0px",right:"50%"}),this._altoView.container.css({left:"50%",right:"0px"}),n(this._altoView),n(this._imageView),this.setSelectableButtonEnabled(!0)):"textView"==e?(this._altoView.container.css({left:"0px",right:"0px"}),t(this._imageView),n(this._altoView),this.setSelectableButtonEnabled(!0)):console.warn("unknown view mode: "+e),this._pageController.update(),this.updateToolbarLabel()},r.prototype.changeImage=function(e,t){if(this._currentImage!=e){this._currentImage=e;var i=this._hrefImageMap.get(e);t&&this._pageLayout.jumpToPage(i.order),this.trigger(new m.events.ImageChangedEvent(this,i))}this._settings.mobile&&this.trigger(new m.events.ShowContentEvent(this,jQuery(this._componentContent),m.events.ShowContentEvent.DIRECTION_CENTER))},r.prototype.fitViewportOverPage=function(){this._pageLayout.fitToScreen()},r.prototype.fitViewerportOverPageWidth=function(){this._pageLayout.fitToWidth()},Object.defineProperty(r.prototype,"handlesEvents",{get:function(){var e=[];return this.isImageDoctype()&&(e.push(_.viewer.widgets.toolbar.events.ButtonPressedEvent.TYPE),e.push(_.viewer.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE),e.push(_.viewer.components.events.ImageSelectedEvent.TYPE),e.push(m.events.StructureModelLoadedEvent.TYPE),e.push(m.events.RequestStateEvent.TYPE),e.push(m.events.RestoreStateEvent.TYPE),e.push(m.events.ShowContentEvent.TYPE),e.push(m.events.LanguageModelLoadedEvent.TYPE),e.push(m.events.ProvideToolbarModelEvent.TYPE),e.push(m.events.ProvidePageLayoutEvent.TYPE),e.push(m.events.RequestDesktopInputEvent.TYPE),e.push(m.events.RequestTouchInputEvent.TYPE),e.push(m.events.AddCanvasPageLayerEvent.TYPE),e.push(m.events.RedrawEvent.TYPE),e.push(m.events.TextEditEvent.TYPE)),e},enumerable:!0,configurable:!0}),r.prototype.previousImage=function(){this._pageLayout.previous(),this.update()},r.prototype.nextImage=function(){this._pageLayout.next(),this.update()},r.prototype.getPageController=function(){return this._pageController},r.prototype.getPageLayout=function(){return this._pageLayout},r.prototype.getRotation=function(){return this._rotation},r.prototype.setRotation=function(e){this._rotation=e},r.prototype.changePageLayout=function(e){if(null!=this._pageLayout){this._pageLayout.clear();var t=this._pageLayout.getCurrentPage()}this._pageLayout=e,isNaN(t)&&(t=1,this._layoutModel.pageCount=1),this._pageLayout.jumpToPage(t),this._pageLayout.rotate(this._rotation),this.update(),this.trigger(new m.events.PageLayoutChangedEvent(this,this._pageLayout))},r.prototype.loadPageIfNotPresent=function(e,t){var i=this;if(!(this._hrefPageMap.has(e)||this._hrefPageLoadingMap.has(e)&&this._hrefPageLoadingMap.get(e))){this._hrefPageLoadingMap.set(e,!0);var n=null;if(this._hrefImageMap.has(e)){var o=this._imageByHref(e).additionalHrefs;o.has(r.ALTO_TEXT_HREF)?n=o.get(r.ALTO_TEXT_HREF):o.has(r.PDF_TEXT_HREF)&&(n=o.get(r.PDF_TEXT_HREF))}this.trigger(new m.events.RequestPageEvent(this,e,function(e,t){i._hrefPageMap.set(e,t),i._hrefImageMap.has(e)?i._orderPageMap.set(i._hrefImageMap.get(e).order,t):i._orderPageMap.set(1,t),i.update()},n))}},r.prototype.restorePermalink=function(){var e=this._permalinkState;if(e.has("layout")){var t=e.get("layout"),i=this._layouts.filter(function(e){return e.getLabelKey()==t});1!=i.length?console.log("no matching layout found!"):this.changePageLayout(i[0])}if(e.has("page")){var n=+e.get("page");this._pageLayout.jumpToPage(n),this._startPage=n}if(e.has("rotation")){var o=+e.get("rotation");this._rotation=o,this._pageLayout.rotate(o)}e.has("scale")&&(this._pageController.viewport.scale=+e.get("scale")),e.has("x")&&e.has("y")&&this._pageLayout.setCurrentPositionInPage(new Position2D(+e.get("x"),+e.get("y"))),this._permalinkState=null},r.prototype.handle=function(e){var t=this;if(this.isImageDoctype()){if(e.type==m.events.ProvideToolbarModelEvent.TYPE){var i=e;this._rotateButton=i.model._rotateButton,this._layoutToolbarButton=i.model._layoutDropdownButton,this._toolbarModel=i.model,this._settings.mobile||("addViewSelectButton"in i.model||"addSelectionSwitchButton"in i.model)&&(this._enableAltoSpecificButtons=function(){"addViewSelectButton"in i.model&&(i.model.addViewSelectButton(),t._viewSelectButton=i.model.viewSelect),"addSelectionSwitchButton"in i.model&&(i.model.addSelectionSwitchButton(),t._selectionSwitchButton=i.model.selectionSwitchButton),t.updateToolbarLabel()})}if(e.type==m.events.LanguageModelLoadedEvent.TYPE){var n=e;this._languageModel=n.languageModel,this.updateToolbarLabel()}if(e.type==_.viewer.widgets.toolbar.events.ButtonPressedEvent.TYPE){var o=e;"PreviousImageButton"==o.button.id&&this.previousImage(),"NextImageButton"==o.button.id&&this.nextImage(),"ZoomInButton"==o.button.id&&this._pageController.viewport.startAnimation(new w.widgets.canvas.ZoomAnimation(this._pageController.viewport,2)),"ZoomOutButton"==o.button.id&&this._pageController.viewport.startAnimation(new w.widgets.canvas.ZoomAnimation(this._pageController.viewport,.5)),"ZoomWidthButton"==o.button.id&&this.fitViewerportOverPageWidth(),"ZoomFitButton"==o.button.id&&this.fitViewportOverPage(),"RotateButton"==o.button.id&&(o.button.disabled||(270==this._rotation?(this._rotation=0,this._pageLayout.rotate(0)):this._pageLayout.rotate(this._rotation+=90))),"selectionSwitchButton"==o.button.id&&(o.button.active?this.setAltoSelectable(!1):this.setAltoSelectable(!0))}if(e.type==m.events.ProvidePageLayoutEvent.TYPE){var r=e;this.addLayout(r.pageLayout),r.isDefault&&this.changePageLayout(r.pageLayout)}if(e.type==w.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE){var a=e;"LayoutDropdownButton"==a.button.id?this._layouts.filter(function(e){return e.getLabelKey()==a.childId}).forEach(function(e){t.changePageLayout(e),t.updateToolbarLabel()}):"viewSelect"==a.button.id&&(this.setViewMode(a.childId),this.updateToolbarLabel())}if(e.type==_.viewer.components.events.ImageSelectedEvent.TYPE){var s=e;this.changeImage(s.image.href,!0)}if(e.type==m.events.StructureModelLoadedEvent.TYPE){var l=e.structureModel;this._structureImages=l.imageList,"defaultPageDimension"in l&&(this.pageWidth=l.defaultPageDimension.width,this.pageHeight=l.defaultPageDimension.height),this._structureModelLoaded();var h="startPage"in l&&null==this._startPage;this.changeImage(h?l.startPage+"":this._currentImage,h),this.update()}if(e.type==m.events.RequestStateEvent.TYPE){var u=e,p=u.stateMap;if(u.deepState){var c=this._pageLayout.getCurrentPositionInPage();p.set("x",c.x.toString(10)),p.set("y",c.y.toString(10)),p.set("scale",this._pageController.viewport.scale.toString(10)),p.set("rotation",this._rotation.toString(10)),p.set("layout",this._pageLayout.getLabelKey())}p.set("page",this._orderImageMap.get(this._pageLayout.getCurrentPage()).href),p.set("derivate",this._settings.derivate)}if(e.type==m.events.RequestDesktopInputEvent.TYPE){var d=e;this.registerDesktopInputHandler(d.listener)}if(e.type==m.events.RequestTouchInputEvent.TYPE&&(d=e,this.registerTouchInputHandler(d.listener)),e.type==m.events.RestoreStateEvent.TYPE){var v=e;this._permalinkState=v.restoredState}if(e.type==m.events.AddCanvasPageLayerEvent.TYPE){var g=e;this._pageController.addCanvasPageLayer(g.zIndex,g.canvasPageLayer)}if(e.type==m.events.RedrawEvent.TYPE&&this._pageController.update(),e.type===m.events.TextEditEvent.TYPE){var f=e;f.component!==this&&(this.setAltoOnTop(f.edit),f.edit&&"imageView"==this._viewMode&&this.setViewMode("mixedView"))}}},r.prototype.setAltoOnTop=function(e){this.setAltoSelectable(!1),e?(this._altoView.container.addClass("altoTop"),this._selectionSwitchButton.disabled=!0):(this._altoView.container.removeClass("altoTop"),this._selectionSwitchButton.disabled=!1)},r.prototype.isAltoSelectable=function(){return null!=this._selectionSwitchButton&&this._selectionSwitchButton.active},r.prototype.setAltoSelectable=function(e){this._selectionSwitchButton.active=e,jQuery("[data-id='selectionSwitchButton']").blur(),this._altoView.container.removeClass("altoTop"),e?this._altoView.container.addClass("altoSelectable"):this._altoView.container.removeClass("altoSelectable"),viewerClearTextSelection()},r.prototype.setSelectableButtonEnabled=function(e){e?-1==this._toolbarModel._actionControllGroup.getComponents().indexOf(this._selectionSwitchButton)&&this._toolbarModel._actionControllGroup.addComponent(this._selectionSwitchButton):-1!=this._toolbarModel._actionControllGroup.getComponents().indexOf(this._selectionSwitchButton)&&this._toolbarModel._actionControllGroup.removeComponent(this._selectionSwitchButton)},r.prototype.addLayout=function(e){this._layouts.push(e),e.init(this._layoutModel,this._pageController,new Size2D(this.pageWidth,this.pageHeight),this._horizontalScrollbar,this._verticalScrollbar,this._pageLoader),this.synchronizeLayoutToolbarButton()},r.prototype.synchronizeLayoutToolbarButton=function(){var i=this,n=!1;this._layouts.forEach(function(e){var t=e.getLabelKey();0==i._layoutToolbarButton.children.filter(function(e){return e.id==t}).length&&(i._layoutToolbarButton.children.push({id:t,label:t}),n=!0)}),n&&(this._layoutToolbarButton.children=this._layoutToolbarButton.children,this.updateToolbarLabel())},r.prototype.updateToolbarLabel=function(){var t=this;null!=this._languageModel&&(null!=this._layoutToolbarButton&&(this._layoutToolbarButton.children.forEach(function(e){e.label=t._languageModel.getTranslation("layout."+e.id)}),this._layoutToolbarButton.children=this._layoutToolbarButton.children,null!=this._pageLayout&&(this._layoutToolbarButton.label=this._languageModel.getTranslation("layout."+this._pageLayout.getLabelKey()))),null!=this._viewSelectButton&&(this._viewSelectButton.label=this._languageModel.getTranslation("view."+this._viewMode),this._viewSelectButton.children.forEach(function(e){e.label=t._languageModel.getTranslation("view."+e.id)}),this._viewSelectButton.children=this._viewSelectButton.children))},r.prototype.update=function(){if(null!=this._pageLayout){var e=this._pageLayout.getCurrentPage();this._pageLayout.syncronizePages(),this._settings.mobile||(this._pageController._overview.overviewRect=this._pageLayout.getCurrentOverview()),void 0!==e&&this._orderImageMap.has(e)&&this.changeImage(this._orderImageMap.get(e).href,!1)}},r.prototype._structureModelLoaded=function(){var e=!1;for(var t in this._structureImages){var i=this._structureImages[t];this._hrefImageMap.set(i.href,i),this._orderImageMap.set(i.order,i),e=e||i.additionalHrefs.has("AltoHref")}if(this._orderPageMap.has(1)){var n=this._orderPageMap.get(1);this._orderPageMap.remove(1);var o=this._hrefImageMap.get(this._settings.filePath);this._orderPageMap.set(o.order,n)}this.initPageLayouts(),e&&!this._settings.mobile&&this._enableAltoSpecificButtons()},r.prototype.initPageLayouts=function(){var e,t=this._settings.filePath,i=this._pageLayout.getCurrentPositionInPage(),n=this._pageController.viewport.scale;if(this._pageController.viewport.stopAnimation(),this._desktopDelegators.forEach(function(e){return e.clearRunning()}),this._touchDelegators.forEach(function(e){return e.clearRunning()}),this._settings.mobile||(this._horizontalScrollbar.clearRunning(),this._verticalScrollbar.clearRunning()),this._pageLayout.clear(),this._layoutModel.pageCount=this._structureImages.length,this._hrefImageMap.has(t))e=this._hrefImageMap.get(t).order;else{var o=ViewerParameterMap.fromCurrentUrl();e=o.has("page")?parseInt(o.get("page")):1}if(null==this._pageLayout)throw"no default page layout found";this._pageLayout.jumpToPage(e),this._pageController.viewport.scale=n,this._pageLayout.setCurrentPositionInPage(i),this._pageController._updateSizeIfChanged(),Utils.getVar(this._settings,"canvas.startup.fitWidth",!1)?this._pageLayout.fitToWidth(!0):this._pageLayout.fitToScreen(),this.trigger(new m.events.WaitForEvent(this,m.events.RestoreStateEvent.TYPE)),null!=this._permalinkState&&this.restorePermalink();var r=this._orderImageMap.get(this._pageLayout.getCurrentPage());this.trigger(new m.events.ImageChangedEvent(this,r))},r.prototype._imageByHref=function(e){return this._hrefImageMap.get(e)},r.prototype.registerDesktopInputHandler=function(e){this._desktopDelegators.push(new w.widgets.canvas.DesktopInputDelegator(jQuery(this._imageView.container),this._pageController.viewport,e)),this._desktopDelegators.push(new w.widgets.canvas.DesktopInputDelegator(jQuery(this._altoView.container),this._pageController.viewport,e))},r.prototype.registerTouchInputHandler=function(e){this._touchDelegators.push(new w.widgets.canvas.TouchInputDelegator(jQuery(this._imageView.container),this._pageController.viewport,e)),this._touchDelegators.push(new w.widgets.canvas.TouchInputDelegator(jQuery(this._altoView.container),this._pageController.viewport,e))},r.ALTO_TEXT_HREF="AltoHref",r.PDF_TEXT_HREF="pdfText",r.DEFAULT_CANVAS_OVERVIEW_MIN_VISIBLE_SIZE="800",r.OVERVIEW_VISIBLE_ICON="fa-caret-up",r.OVERVIEW_INVISIBLE_ICON="fa-caret-down",r}(m.ViewerComponent);m.MyCoReImageScrollComponent=e;var i=function(i){function e(e){var t=i.call(this)||this;return t.component=e,t._touchAdditionalScaleMove=null,t._sessionStartRotation=0,t}return __extends(e,i),e.prototype.touchStart=function(e){this._touchAdditionalScaleMove=new MoveVector(0,0),this.component.getPageController().viewport.stopAnimation()},e.prototype.touchMove=function(e){var t=this.component.getPageController().viewport;if(!e.touchLeft){if(2==e.touches&&150<e.startDistance&&150<e.currentMove.distance){var i=e.currentMove.angle-e.startAngle,n=(720+(this._sessionStartRotation+i))%360,o=90*Math.round(n/90);o=360==o?0:o,this.component.getRotation()!=o&&(this.component.getPageLayout().rotate(o),this.component.setRotation(o))}if(0!=e.startDistance&&0!=e.currentMove.distance&&1<e.touches){var r=0;r=null==e.lastMove||0==e.lastMove.distance?e.startDistance:e.lastMove.distance;var a=e.currentMove.distance/r,s=t.getAbsolutePosition(e.currentMove.middle),l=new MoveVector(t.position.x-s.x,t.position.y-s.y).scale(a),h=s.move(l);this._touchAdditionalScaleMove=this._touchAdditionalScaleMove.move(new MoveVector(t.position.x-h.x,t.position.y-h.y)),t.scale*=a}var u=new MoveVector(-(e.currentMove.middle.x-e.startMiddle.x),-(e.currentMove.middle.y-e.startMiddle.y)),p=t.rotation,c=t.scale;t.position=e.canvasStartPosition.copy().scale(c).move(u.rotate(p)).scale(1/c).move(this._touchAdditionalScaleMove)}},e.prototype.touchEnd=function(e){var t=this.component.getPageController().viewport;if(null!=e.currentMove&&(0!=e.currentMove.velocity.x||0!=e.currentMove.velocity.y)){var i=new w.widgets.canvas.VelocityScrollAnimation(this.component.getPageController().viewport,e.currentMove.velocity);this.component.getPageController().viewport.startAnimation(i)}if(null!=e.lastSession)if(e.startTime-e.lastSession.startTime<200){var n=e.startMiddle,o=t.getAbsolutePosition(n);t.startAnimation(new w.widgets.canvas.ZoomAnimation(t,2,o,500))}else e.canvasStartPosition.equals(this.component.getPageController().viewport.position);this._sessionStartRotation=this.component.getRotation()},e}(w.widgets.canvas.TouchInputAdapter),o=function(i){function e(e){var t=i.call(this)||this;return t.component=e,t}return __extends(e,i),e.prototype.mouseDown=function(e,t){var i=this.component._componentContent;i.addClass("grab"),i.removeClass("grabbable")},e.prototype.mouseUp=function(e,t){var i=this.component._componentContent;i.addClass("grabbable"),i.removeClass("grab")},e.prototype.mouseDoubleClick=function(e){var t=this.component.getPageController().viewport,i=t.getAbsolutePosition(e);t.startAnimation(new w.widgets.canvas.ZoomAnimation(t,2,i))},e.prototype.mouseDrag=function(e,t,i){if(!this.component.isAltoSelectable()){var n=e.x-t.x,o=e.y-t.y,r=new MoveVector(-n,-o).rotate(this.component.getPageController().viewport.rotation);this.component.getPageController().viewport.position=i.scale(this.component.getPageController().viewport.scale).move(r).scale(1/this.component.getPageController().viewport.scale)}},e.prototype.scroll=function(e){var t="zoom"==ViewerParameterMap.fromCurrentUrl().get("iview2.scroll")?!e.altKey||e.ctrlKey:e.altKey||e.ctrlKey,i=this.component.getPageController().viewport;if(t){var n=Math.pow(.95,e.deltaY/10);if(void 0!==i.currentAnimation&&null!=i.currentAnimation)i.currentAnimation instanceof w.widgets.canvas.ZoomAnimation?i.currentAnimation.merge(n):console.log("dont know howto merge animations");else{var o=i.getAbsolutePosition(e.pos);i.startAnimation(new w.widgets.canvas.ZoomAnimation(i,n,o))}}else i.position=new Position2D(i.position.x+e.deltaX/i.scale,i.position.y+e.deltaY/i.scale)},e.prototype.keydown=function(e){switch(e.keyCode){case 33:this.component.previousImage();break;case 34:this.component.nextImage()}},e}(w.widgets.canvas.DesktopInputAdapter)})((w=_.viewer||(_.viewer={})).components||(w.components={}))}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(n){function o(e,t){var i=n.call(this,e,o.TYPE)||this;return i.layer=t,i}return __extends(o,n),o.TYPE="ProvideLayerEvent",o}(n.MyCoReImageViewerEvent),n.ProvideLayerEvent=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.layer||(i.layer={}),o=function(){function e(){this.onLayerAdd=Array(),this.onLayerRemove=Array(),this.currentPage=null,this.layerList=new Array}return e.prototype.addLayer=function(t){if(-1!=this.layerList.indexOf(t))throw"the layer "+t.getId()+" is already in model!";this.layerList.push(t),this.onLayerAdd.forEach(function(e){return e(t)})},e.prototype.removeLayer=function(t){var e=this.layerList.indexOf(t);if(-1==e)throw"the layer "+t.getId()+" is not present in model!";this.layerList.splice(e,1),this.onLayerRemove.forEach(function(e){return e(t)})},e.prototype.getLayerList=function(){return this.layerList.slice(0)},e}(),n.LayerDisplayModel=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.layer||(i.layer={}),o=function(){function o(e,t){this._container=e,this.languageResolver=t,this._layerIdViewMap=new MyCoReMap,this._layerIdCallbackMap=new MyCoReMap,this.model=new n.LayerDisplayModel,this.initializeView(),this.initializeModel()}return o.prototype.initializeView=function(){this._view=jQuery("<div></div>"),this._view.addClass("layer-view"),this._view.appendTo(this._container)},o.prototype.addLayerView=function(e){var t,i=e.getId();t=this._layerIdViewMap.has(i)?this._layerIdViewMap.get(i):this.createLayerView(e),this._view.append(t)},o.prototype.createLayerView=function(e){var t=e.getId(),i=this.languageResolver(e.getLabel()),n=jQuery("<div data-id='layer-"+t+"' class='layer'></div>");return jQuery('<div class="layer-heading '+o.REMOVE_EXCLUDE_CLASS+'">'+i+"</div>").appendTo(n),this._layerIdViewMap.set(t,n),n},o.prototype.removeLayerView=function(e){this.getLayerView(e.getId()).detach()},o.prototype.getLayerView=function(e){return this._layerIdViewMap.get(e)},o.prototype.cleanLayerView=function(e){this._layerIdViewMap.get(e).children().not("."+o.REMOVE_EXCLUDE_CLASS).detach()},o.prototype.initializeModel=function(){var t=this;this.model.onLayerAdd.push(function(e){t.addLayerView(e)}),this.model.onLayerRemove.push(function(e){t.removeLayerView(e)})},o.prototype.addLayer=function(e){this.model.addLayer(e),this.synchronizeView()},o.prototype.removeLayer=function(e){this.model.removeLayer(e),this.synchronizeView()},o.prototype.getLayer=function(){return this.model.getLayerList()},o.prototype.pageChanged=function(e){this.model.currentPage=e,this.synchronizeView()},o.prototype.synchronizeView=function(){var r=this;this.model.getLayerList().forEach(function(i){var n=i.getId();r.cleanLayerView(i.getId());var o=function(e,t){e&&r._layerIdCallbackMap.has(n)&&r._layerIdCallbackMap.get(n)==o&&(t.find(".popupTrigger").each(function(e,t){var i=jQuery(t);i.attr("data-placement","bottom"),i.popover({html:!0,content:function(){return i.find(".popupBox").html()}})}),r.getLayerView(i.getId()).append(t),r._layerIdCallbackMap.remove(n))};r._layerIdCallbackMap.has(n)&&r._layerIdCallbackMap.remove(n),r._layerIdCallbackMap.set(n,o),i.resolveLayer(r.model.currentPage,o)})},o.REMOVE_EXCLUDE_CLASS="rm-exclude",o}(),n.LayerDisplayController=o}(mycore||(mycore={})),function(d){var e,v,t;e=d.viewer||(d.viewer={}),v=e.components||(e.components={}),t=function(i){function c(e){var t=i.call(this)||this;return t._settings=e,t.toolbarButtonSync=Utils.synchronize([function(e){return e.toolbarButtonDisplayable()},function(e){return null==e.dropDownButton}],function(e){return e.initToolbarButton()}),t.layerSync=Utils.synchronize([function(e){return e.toolbarButtonInitialized()}],function(e){return e.synchronizeLayers()}),t.structureModel=null,t.languageModel=null,t.toolbarModel=null,t.dropDownButton=null,t.sidebarLabel=jQuery("<span>Ebenen</span>"),t.enabled="true"===Utils.getVar(t._settings,"text.enabled","true")&&1!=t._settings.mobile,t.showLayerOnStart=Utils.getVar(t._settings,"text.showOnStart",[]),t}return __extends(c,i),c.prototype.init=function(){var t=this;this.enabled&&(this.container=jQuery("<div></div>"),this.container.css({overflowY:"scroll",display:"block"}),this.container.addClass("tei"),this.container.addClass("layer-component"),this.container.bind("iviewResize",function(){t.updateContainerSize()}),this.layerDisplay=new e.widgets.layer.LayerDisplayController(this.container,function(e){return t.languageModel.getTranslation(e)}),this.layerList=new Array,this.layerIdLayerMap=new MyCoReMap,this.trigger(new v.events.WaitForEvent(this,v.events.StructureModelLoadedEvent.TYPE)),this.trigger(new v.events.WaitForEvent(this,v.events.LanguageModelLoadedEvent.TYPE)),this.trigger(new v.events.WaitForEvent(this,v.events.ImageChangedEvent.TYPE)))},c.prototype.updateContainerSize=function(){this.container.css({height:this.container.parent().height()-this.sidebarLabel.parent().outerHeight()+"px"});var e=this.container.width(),t=ViewerUserSettingStore.getInstance();50<e&&t.setValue(c.SIDEBAR_LAYER_SIZE,e.toString())},Object.defineProperty(c.prototype,"handlesEvents",{get:function(){var e=new Array;return this.enabled&&(e.push(v.events.StructureModelLoadedEvent.TYPE),e.push(v.events.ImageChangedEvent.TYPE),e.push(v.events.ShowContentEvent.TYPE),e.push(d.viewer.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE),e.push(v.events.LanguageModelLoadedEvent.TYPE),e.push(v.events.ProvideToolbarModelEvent.TYPE),e.push(v.events.ProvideLayerEvent.TYPE)),e},enumerable:!0,configurable:!0}),c.prototype.handle=function(e){var t=this;if(e.type==d.viewer.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE){var i=e;if(i.button.id==c.LAYER_DROPDOWN_ID){if(!this.layerIdLayerMap.has(i.childId))throw new ViewerError("Invalid button child pressed!");var n=i.childId;this.toggleTranscriptionContainer(n)}}if(e.type==v.events.ProvideLayerEvent.TYPE){var o=e;this.layerList.push(o.layer);var r,a=o.layer.getId();if(this.layerIdLayerMap.set(a,o.layer),this.toolbarButtonSync(this),this.layerSync(this),0<this.showLayerOnStart.length)if(-1!=(r=this.showLayerOnStart.indexOf(a))){var s;if(0!=this.layerDisplay.getLayer().length)if(-1!=(s=this.showLayerOnStart.indexOf(this.layerDisplay.getLayer()[0].getId()))&&s<r)return;this.toggleTranscriptionContainer(a,!0)}}if(e.type==v.events.ShowContentEvent.TYPE){var l=e;0==l.size&&l.containerDirection==v.events.ShowContentEvent.DIRECTION_EAST&&null!=this.dropDownButton&&(this.dropDownButton.children.forEach(function(e){delete e.icon}),this.dropDownButton.children=this.dropDownButton.children,this.layerDisplay.getLayer().forEach(function(e){t.layerDisplay.removeLayer(e)}))}if(e.type==v.events.StructureModelLoadedEvent.TYPE){var h=e;this.structureModel=h.structureModel,this.toolbarButtonSync(this)}if(e.type==v.events.ImageChangedEvent.TYPE){var u=e;void 0!==this.structureModel&&void 0!==u.image&&null!=u&&(this.currentHref=u.image.href,this.layerDisplay.pageChanged(this.currentHref))}if(e.type==v.events.LanguageModelLoadedEvent.TYPE&&(this.languageModel=e.languageModel,this.toolbarButtonSync(this)),e.type==v.events.ProvideToolbarModelEvent.TYPE){var p=e;this.toolbarModel=p.model,this.toolbarButtonSync(this)}},c.prototype.toggleTranscriptionContainer=function(e,t){var i=this;void 0===t&&(t=!1);var n=this.layerIdLayerMap.get(e);-1==this.layerDisplay.getLayer().indexOf(n)?this.layerDisplay.addLayer(n):this.layerDisplay.removeLayer(n),t&&this.layerDisplay.getLayer().forEach(function(e){n!=e&&i.layerDisplay.removeLayer(e)}),0<this.layerDisplay.getLayer().length?this.showContainer():this.hideContainer(),this.synchronizeLayers()},c.prototype.showContainer=function(){var e=ViewerUserSettingStore.getInstance(),t=e.hasValue(c.SIDEBAR_LAYER_SIZE),i=t?parseInt(e.getValue(c.SIDEBAR_LAYER_SIZE),10):null,n=this._settings.mobile?v.events.ShowContentEvent.DIRECTION_CENTER:v.events.ShowContentEvent.DIRECTION_EAST;this.trigger(new v.events.ShowContentEvent(this,this.container,n,t?i:400,this.sidebarLabel)),this.updateContainerSize()},c.prototype.hideContainer=function(){var e=this._settings.mobile?v.events.ShowContentEvent.DIRECTION_CENTER:v.events.ShowContentEvent.DIRECTION_EAST;this.trigger(new v.events.ShowContentEvent(this,null,e,0,null))},c.prototype.toolbarButtonInitialized=function(){return null!=this.dropDownButton},c.prototype.toolbarButtonDisplayable=function(){return null!=this.languageModel&&null!=this.toolbarModel&&0<this.layerList.length},c.prototype.initToolbarButton=function(){this.dropDownButton=new e.widgets.toolbar.ToolbarDropdownButton(c.LAYER_DROPDOWN_ID,this.languageModel.getTranslation("toolbar.layerButton"),[]),this.toolbarModel._actionControllGroup.addComponent(this.dropDownButton),this.layerSync(this)},c.prototype.synchronizeLayers=function(){var n=this;this.layerList.filter(function(t){return 0==n.dropDownButton.children.filter(function(e){return e.id==t.getId()}).length}).forEach(function(e){var t=n.languageModel.getTranslation(e.getLabel()),i={id:e.getId(),label:t};n.dropDownButton.children.push(i)}),this.dropDownButton.children.forEach(function(e){n.layerIdLayerMap.has(e.id)&&(-1!=n.layerDisplay.getLayer().indexOf(n.layerIdLayerMap.get(e.id))?e.icon="ok":"icon"in e&&delete e.icon)}),this.dropDownButton.children=this.dropDownButton.children},c.SIDEBAR_LAYER_SIZE="SIDEBAR_LAYER_SIZE",c.LAYER_DROPDOWN_ID="toolbar.LayerButton",c}(v.ViewerComponent),v.MyCoReLayerComponent=t}(mycore||(mycore={})),function(e){var t,o,i;t=e.viewer||(e.viewer={}),o=t.components||(t.components={}),i=function(t){function e(e){var i=t.call(this)||this;return i._settings=e,i._nextImageButton=null,i._previousImageButton=null,i._structureModel=null,i._currentImage=null,i._checkAndDisableSynchronize=Utils.synchronize([function(e){return null!=e._nextImageButton},function(e){return null!=e._previousImageButton},function(e){return null!=e._structureModel},function(e){return null!=e._currentImage}],function(e){var t=i._structureModel._imageList.indexOf(i._currentImage);i._previousImageButton.disabled=0==t,t==i._structureModel.imageList.length-1?i._nextImageButton.disabled=!0:i._nextImageButton.disabled=!1}),i}return __extends(e,t),e.prototype.init=function(){},Object.defineProperty(e.prototype,"handlesEvents",{get:function(){var e=new Array;return e.push(o.events.StructureModelLoadedEvent.TYPE),e.push(o.events.ImageChangedEvent.TYPE),e.push(o.events.ProvideToolbarModelEvent.TYPE),e},enumerable:!0,configurable:!0}),e.prototype.handle=function(e){if(e.type==o.events.ProvideToolbarModelEvent.TYPE){var t=e;this._nextImageButton=t.model._nextImageButton,this._previousImageButton=t.model._previousImageButton,null==this._structureModel&&(this._nextImageButton.disabled=!0,this._previousImageButton.disabled=!0),this._checkAndDisableSynchronize(this)}if(e.type==o.events.StructureModelLoadedEvent.TYPE){var i=e;this._structureModel=i.structureModel,this._nextImageButton.disabled=!1,this._previousImageButton.disabled=!1,this._checkAndDisableSynchronize(this)}if(e.type==o.events.ImageChangedEvent.TYPE){var n=e;null!=n.image&&(this._currentImage=n.image,this._checkAndDisableSynchronize(this))}},e}(o.ViewerComponent),o.MyCoReButtonChangeComponent=i}(mycore||(mycore={}));var mycore,IVIEW_COMPONENTS=VIEWER_COMPONENTS||[];!function(e){var r,t;r=e.viewer||(e.viewer={}),t=function(){function e(e,t){this._container=e,this._settings=t,this._initializing=!1,this._eventHandlerMap=new MyCoReMap,this._components=new Array,this._initializingEvents=new Array,this.initialize()}return Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),e.prototype.addComponent=function(e){var t=this;e.bind(function(e){t.eventTriggered(e)});var i=e.handlesEvents;if(void 0!==i&&null!=i&&i instanceof Array)for(var n in i.push(r.components.events.WaitForEvent.TYPE),i){var o=i[n];this._eventHandlerMap.has(o)||this._eventHandlerMap.set(o,new Array),this._eventHandlerMap.get(o).push(e)}else console.log(ViewerFormatString("The component {comp} doesnt have a valid handlesEvents!",{comp:e}));this._components.push(e),e.init()},e.prototype.eventTriggered=function(e){if(this._eventHandlerMap.has(e.type)){var t=this._eventHandlerMap.get(e.type);for(var i in t){t[i]._handle(e)}}},e.prototype.initialize=function(){for(var e in this._settings=r.MyCoReViewerSettings.normalize(this._settings),this._container.hasClass("mycoreViewer")||this._container.addClass("mycoreViewer"),IVIEW_COMPONENTS){var t=IVIEW_COMPONENTS[e];try{this.addComponent(new t(this._settings,this._container))}catch(e){console.log("Unable to add component"),console.log(e)}}},e}(),r.MyCoReViewer=t}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoReViewerContainerComponent),addViewerComponent(mycore.viewer.components.MyCoReI18NComponent),addViewerComponent(mycore.viewer.components.MyCoReImageOverviewComponent),addViewerComponent(mycore.viewer.components.MyCoReToolbarComponent),addViewerComponent(mycore.viewer.components.MyCoReImageScrollComponent),addViewerComponent(mycore.viewer.components.MyCoReChapterComponent),addViewerComponent(mycore.viewer.components.MyCoRePermalinkComponent),addViewerComponent(mycore.viewer.components.MyCoReLayerComponent),addViewerComponent(mycore.viewer.components.MyCoReButtonChangeComponent),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.modal||(i.modal={}),o=function(s){function e(e,t,i,n,o){void 0===o&&(o=document.body);var r=s.call(this,e,t,o)||this;r.modalHeader.children("h4").addClass("text-danger");var a=null!=n?"<img class='thumbnail error-image' src='"+n+"' />":"";return r.modalBody.append("<div class='error-image-holder'> "+a+" <span data-i18n='\" + text + \"'>"+i+"</span></div>"),r}return __extends(e,s),e}(n.IviewModalWindow),n.ViewerErrorModal=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.modal||(i.modal={}),o=function(r){function e(e,t,i,n){void 0===n&&(n=document.body);var o=r.call(this,e,t,n)||this;return o.modalHeader.children("h4").addClass("text-info"),o.modalBody.append("<p><span data-i18n='"+i+"'>"+i+"</span></p>"),o}return __extends(e,r),e}(n.IviewModalWindow),n.ViewerInfoModal=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.widgets||(t.widgets={}),n=i.modal||(i.modal={}),o=function(a){function e(e,t,i,n,o){void 0===o&&(o=document.body);var r=a.call(this,e,t,o)||this;return r.modalHeader.children("h4").addClass("text-info"),r.modalBody.append("<p><span data-i18n='"+i+"'>"+i+"</span></p>"),r.modalFooter.empty(),r.createButton(!0,n),r.createButton(!1,n),r}return __extends(e,a),e.prototype.createButton=function(e,t){var i=jQuery("<a data-i18n='modal."+(e?"yes":"no")+"'></a>");i.attr("type","button"),i.addClass("btn btn-secondary"),i.appendTo(this.modalFooter);var n=this;i.click(function(){t&&t(e),n.hide()})},e}(n.IviewModalWindow),n.ViewerConfirmModal=o}(mycore||(mycore={})),function(e){var t,i,n,o;t=e.viewer||(e.viewer={}),i=t.components||(t.components={}),n=i.events||(i.events={}),o=function(o){function r(e,t,i){var n=o.call(this,e,r.TYPE)||this;return n._pageId=t,n.abstractPage=i,n}return __extends(r,o),r.TYPE="PageLoadedEvent",r}(n.MyCoReImageViewerEvent),n.PageLoadedEvent=o}(mycore||(mycore={}));